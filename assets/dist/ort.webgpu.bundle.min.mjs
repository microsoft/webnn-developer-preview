/*!
 * ONNX Runtime Web v1.23.0-dev.20250911-930e64086c
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
var jr=Object.defineProperty;var qf=Object.getOwnPropertyDescriptor;var Xf=Object.getOwnPropertyNames;var Jf=Object.prototype.hasOwnProperty;var Yr=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(r,i)=>(typeof require<"u"?require:r)[i]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var F=(o,r)=>()=>(o&&(r=o(o=0)),r);var At=(o,r)=>{for(var i in r)jr(o,i,{get:r[i],enumerable:!0})},Zf=(o,r,i,f)=>{if(r&&typeof r=="object"||typeof r=="function")for(let u of Xf(r))!Jf.call(o,u)&&u!==i&&jr(o,u,{get:()=>r[u],enumerable:!(f=qf(r,u))||f.enumerable});return o};var zt=o=>Zf(jr({},"__esModule",{value:!0}),o);var Vt,Qe,et,Kf,La,qr=F(()=>{"use strict";Vt=new Map,Qe=[],et=(o,r,i)=>{if(r&&typeof r.init=="function"&&typeof r.createInferenceSessionHandler=="function"){let f=Vt.get(o);if(f===void 0)Vt.set(o,{backend:r,priority:i});else{if(f.priority>i)return;if(f.priority===i&&f.backend!==r)throw new Error(`cannot register backend "${o}" using priority ${i}`)}if(i>=0){let u=Qe.indexOf(o);u!==-1&&Qe.splice(u,1);for(let d=0;d<Qe.length;d++)if(Vt.get(Qe[d]).priority<=i){Qe.splice(d,0,o);return}Qe.push(o)}return}throw new TypeError("not a valid backend")},Kf=async o=>{let r=Vt.get(o);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let i=!!r.initPromise;try{return i||(r.initPromise=r.backend.init(o)),await r.initPromise,r.initialized=!0,r.backend}catch(f){return i||(r.error=`${f}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},La=async o=>{let r=o.executionProviders||[],i=r.map(y=>typeof y=="string"?y:y.name),f=i.length===0?Qe:i,u,d=[],p=new Set;for(let y of f){let w=await Kf(y);typeof w=="string"?d.push({name:y,err:w}):(u||(u=w),u===w&&p.add(y))}if(!u)throw new Error(`no available backend found. ERR: ${d.map(y=>`[${y.name}] ${y.err}`).join(", ")}`);for(let{name:y,err:w}of d)i.includes(y)&&console.warn(`removing requested execution provider "${y}" from session options because it is not available: ${w}`);let m=r.filter(y=>p.has(typeof y=="string"?y:y.name));return[u,new Proxy(o,{get:(y,w)=>w==="executionProviders"?m:Reflect.get(y,w)})]}});var Oa=F(()=>{"use strict";qr()});var Ba,Ma=F(()=>{"use strict";Ba="1.23.0"});var Ua,ue,Xr=F(()=>{"use strict";Ma();Ua="warning",ue={wasm:{},webgl:{},webgpu:{},versions:{common:Ba},set logLevel(o){if(o!==void 0){if(typeof o!="string"||["verbose","info","warning","error","fatal"].indexOf(o)===-1)throw new Error(`Unsupported logging level: ${o}`);Ua=o}},get logLevel(){return Ua}};Object.defineProperty(ue,"logLevel",{enumerable:!0})});var ee,Ca=F(()=>{"use strict";Xr();ee=ue});var Da,Pa,_a=F(()=>{"use strict";Da=(o,r)=>{let i=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);i.width=o.dims[3],i.height=o.dims[2];let f=i.getContext("2d");if(f!=null){let u,d;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(u=o.dims[2],d=o.dims[3]):(u=o.dims[3],d=o.dims[2]);let p=r?.format!==void 0?r.format:"RGB",m=r?.norm,y,w;m===void 0||m.mean===void 0?y=[255,255,255,255]:typeof m.mean=="number"?y=[m.mean,m.mean,m.mean,m.mean]:(y=[m.mean[0],m.mean[1],m.mean[2],0],m.mean[3]!==void 0&&(y[3]=m.mean[3])),m===void 0||m.bias===void 0?w=[0,0,0,0]:typeof m.bias=="number"?w=[m.bias,m.bias,m.bias,m.bias]:(w=[m.bias[0],m.bias[1],m.bias[2],0],m.bias[3]!==void 0&&(w[3]=m.bias[3]));let g=d*u,v=0,T=g,x=g*2,M=-1;p==="RGBA"?(v=0,T=g,x=g*2,M=g*3):p==="RGB"?(v=0,T=g,x=g*2):p==="RBG"&&(v=0,x=g,T=g*2);for(let W=0;W<d;W++)for(let j=0;j<u;j++){let U=(o.data[v++]-w[0])*y[0],B=(o.data[T++]-w[1])*y[1],X=(o.data[x++]-w[2])*y[2],_=M===-1?255:(o.data[M++]-w[3])*y[3];f.fillStyle="rgba("+U+","+B+","+X+","+_+")",f.fillRect(j,W,1,1)}if("toDataURL"in i)return i.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Pa=(o,r)=>{let i=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),f;if(i!=null){let u,d,p;r?.tensorLayout!==void 0&&r.tensorLayout==="NHWC"?(u=o.dims[2],d=o.dims[1],p=o.dims[3]):(u=o.dims[3],d=o.dims[2],p=o.dims[1]);let m=r!==void 0&&r.format!==void 0?r.format:"RGB",y=r?.norm,w,g;y===void 0||y.mean===void 0?w=[255,255,255,255]:typeof y.mean=="number"?w=[y.mean,y.mean,y.mean,y.mean]:(w=[y.mean[0],y.mean[1],y.mean[2],255],y.mean[3]!==void 0&&(w[3]=y.mean[3])),y===void 0||y.bias===void 0?g=[0,0,0,0]:typeof y.bias=="number"?g=[y.bias,y.bias,y.bias,y.bias]:(g=[y.bias[0],y.bias[1],y.bias[2],0],y.bias[3]!==void 0&&(g[3]=y.bias[3]));let v=d*u;if(r!==void 0&&(r.format!==void 0&&p===4&&r.format!=="RGBA"||p===3&&r.format!=="RGB"&&r.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let T=4,x=0,M=1,W=2,j=3,U=0,B=v,X=v*2,_=-1;m==="RGBA"?(U=0,B=v,X=v*2,_=v*3):m==="RGB"?(U=0,B=v,X=v*2):m==="RBG"&&(U=0,X=v,B=v*2),f=i.createImageData(u,d);for(let H=0;H<d*u;x+=T,M+=T,W+=T,j+=T,H++)f.data[x]=(o.data[U++]-g[0])*w[0],f.data[M]=(o.data[B++]-g[1])*w[1],f.data[W]=(o.data[X++]-g[2])*w[2],f.data[j]=_===-1?255:(o.data[_++]-g[3])*w[3]}else throw new Error("Can not access image data");return f}});var Jr,Ra,Wa,ka,Na,Fa,Ga=F(()=>{"use strict";Ht();Jr=(o,r)=>{if(o===void 0)throw new Error("Image buffer must be defined");if(r.height===void 0||r.width===void 0)throw new Error("Image height and width must be defined");if(r.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:i,width:f}=r,u=r.norm??{mean:255,bias:0},d,p;typeof u.mean=="number"?d=[u.mean,u.mean,u.mean,u.mean]:d=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?p=[u.bias,u.bias,u.bias,u.bias]:p=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let m=r.format!==void 0?r.format:"RGBA",y=r.tensorFormat!==void 0&&r.tensorFormat!==void 0?r.tensorFormat:"RGB",w=i*f,g=y==="RGBA"?new Float32Array(w*4):new Float32Array(w*3),v=4,T=0,x=1,M=2,W=3,j=0,U=w,B=w*2,X=-1;m==="RGB"&&(v=3,T=0,x=1,M=2,W=-1),y==="RGBA"?X=w*3:y==="RBG"?(j=0,B=w,U=w*2):y==="BGR"&&(B=0,U=w,j=w*2);for(let H=0;H<w;H++,T+=v,M+=v,x+=v,W+=v)g[j++]=(o[T]+p[0])/d[0],g[U++]=(o[x]+p[1])/d[1],g[B++]=(o[M]+p[2])/d[2],X!==-1&&W!==-1&&(g[X++]=(o[W]+p[3])/d[3]);return y==="RGBA"?new ce("float32",g,[1,4,i,f]):new ce("float32",g,[1,3,i,f])},Ra=async(o,r)=>{let i=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,f=typeof ImageData<"u"&&o instanceof ImageData,u=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,d=typeof o=="string",p,m=r??{},y=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},w=g=>typeof HTMLCanvasElement<"u"&&g instanceof HTMLCanvasElement||g instanceof OffscreenCanvas?g.getContext("2d"):null;if(i){let g=y();g.width=o.width,g.height=o.height;let v=w(g);if(v!=null){let T=o.height,x=o.width;if(r!==void 0&&r.resizedHeight!==void 0&&r.resizedWidth!==void 0&&(T=r.resizedHeight,x=r.resizedWidth),r!==void 0){if(m=r,r.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");m.tensorFormat="RGBA",m.height=T,m.width=x}else m.tensorFormat="RGBA",m.height=T,m.width=x;v.drawImage(o,0,0),p=v.getImageData(0,0,x,T).data}else throw new Error("Can not access image data")}else if(f){let g,v;if(r!==void 0&&r.resizedWidth!==void 0&&r.resizedHeight!==void 0?(g=r.resizedHeight,v=r.resizedWidth):(g=o.height,v=o.width),r!==void 0&&(m=r),m.format="RGBA",m.height=g,m.width=v,r!==void 0){let T=y();T.width=v,T.height=g;let x=w(T);if(x!=null)x.putImageData(o,0,0),p=x.getImageData(0,0,v,g).data;else throw new Error("Can not access image data")}else p=o.data}else if(u){if(r===void 0)throw new Error("Please provide image config with format for Imagebitmap");let g=y();g.width=o.width,g.height=o.height;let v=w(g);if(v!=null){let T=o.height,x=o.width;return v.drawImage(o,0,0,x,T),p=v.getImageData(0,0,x,T).data,m.height=T,m.width=x,Jr(p,m)}else throw new Error("Can not access image data")}else{if(d)return new Promise((g,v)=>{let T=y(),x=w(T);if(!o||!x)return v();let M=new Image;M.crossOrigin="Anonymous",M.src=o,M.onload=()=>{T.width=M.width,T.height=M.height,x.drawImage(M,0,0,T.width,T.height);let W=x.getImageData(0,0,T.width,T.height);m.height=T.height,m.width=T.width,g(Jr(W.data,m))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(p!==void 0)return Jr(p,m);throw new Error("Input data provided is not supported - aborted tensor creation")},Wa=(o,r)=>{let{width:i,height:f,download:u,dispose:d}=r,p=[1,f,i,4];return new ce({location:"texture",type:"float32",texture:o,dims:p,download:u,dispose:d})},ka=(o,r)=>{let{dataType:i,dims:f,download:u,dispose:d}=r;return new ce({location:"gpu-buffer",type:i??"float32",gpuBuffer:o,dims:f,download:u,dispose:d})},Na=(o,r)=>{let{dataType:i,dims:f,download:u,dispose:d}=r;return new ce({location:"ml-tensor",type:i??"float32",mlTensor:o,dims:f,download:u,dispose:d})},Fa=(o,r,i)=>new ce({location:"cpu-pinned",type:o,data:r,dims:i??[r.length]})});var tt,xt,$a,za,Va=F(()=>{"use strict";tt=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),xt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),$a=!1,za=()=>{if(!$a){$a=!0;let o=typeof BigInt64Array<"u"&&BigInt64Array.from,r=typeof BigUint64Array<"u"&&BigUint64Array.from,i=globalThis.Float16Array,f=typeof i<"u"&&i.from;o&&(tt.set("int64",BigInt64Array),xt.set(BigInt64Array,"int64")),r&&(tt.set("uint64",BigUint64Array),xt.set(BigUint64Array,"uint64")),f?(tt.set("float16",i),xt.set(i,"float16")):tt.set("float16",Uint16Array)}}});var Ha,ja,Ya=F(()=>{"use strict";Ht();Ha=o=>{let r=1;for(let i=0;i<o.length;i++){let f=o[i];if(typeof f!="number"||!Number.isSafeInteger(f))throw new TypeError(`dims[${i}] must be an integer, got: ${f}`);if(f<0)throw new RangeError(`dims[${i}] must be a non-negative integer, got: ${f}`);r*=f}return r},ja=(o,r)=>{switch(o.location){case"cpu":return new ce(o.type,o.data,r);case"cpu-pinned":return new ce({location:"cpu-pinned",data:o.data,type:o.type,dims:r});case"texture":return new ce({location:"texture",texture:o.texture,type:o.type,dims:r});case"gpu-buffer":return new ce({location:"gpu-buffer",gpuBuffer:o.gpuBuffer,type:o.type,dims:r});case"ml-tensor":return new ce({location:"ml-tensor",mlTensor:o.mlTensor,type:o.type,dims:r});default:throw new Error(`tensorReshape: tensor location ${o.location} is not supported`)}}});var ce,Ht=F(()=>{"use strict";_a();Ga();Va();Ya();ce=class{constructor(r,i,f){za();let u,d;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,u=r.type,d=r.dims,r.location){case"cpu-pinned":{let m=tt.get(u);if(!m)throw new TypeError(`unsupported type "${u}" to create tensor from pinned buffer`);if(!(r.data instanceof m))throw new TypeError(`buffer should be of type ${m.name}`);this.cpuData=r.data;break}case"texture":{if(u!=="float32")throw new TypeError(`unsupported type "${u}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(u!=="float32"&&u!=="float16"&&u!=="int32"&&u!=="int64"&&u!=="uint32"&&u!=="uint8"&&u!=="bool"&&u!=="uint4"&&u!=="int4")throw new TypeError(`unsupported type "${u}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(u!=="float32"&&u!=="float16"&&u!=="int32"&&u!=="int64"&&u!=="uint32"&&u!=="uint64"&&u!=="int8"&&u!=="uint8"&&u!=="bool"&&u!=="uint4"&&u!=="int4")throw new TypeError(`unsupported type "${u}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let m,y;if(typeof r=="string")if(u=r,y=f,r==="string"){if(!Array.isArray(i))throw new TypeError("A string tensor's data must be a string array.");m=i}else{let w=tt.get(r);if(w===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(i)){if(r==="float16"&&w===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${w.name} as data.`);r==="uint64"||r==="int64"?m=w.from(i,BigInt):m=w.from(i)}else if(i instanceof w)m=i;else if(i instanceof Uint8ClampedArray)if(r==="uint8")m=Uint8Array.from(i);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(r==="float16"&&i instanceof Uint16Array&&w!==Uint16Array)m=new globalThis.Float16Array(i.buffer,i.byteOffset,i.length);else throw new TypeError(`A ${u} tensor's data must be type of ${w}`)}else if(y=i,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let w=typeof r[0];if(w==="string")u="string",m=r;else if(w==="boolean")u="bool",m=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${w}.`)}else if(r instanceof Uint8ClampedArray)u="uint8",m=Uint8Array.from(r);else{let w=xt.get(r.constructor);if(w===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);u=w,m=r}if(y===void 0)y=[m.length];else if(!Array.isArray(y))throw new TypeError("A tensor's dims must be a number array");d=y,this.cpuData=m,this.dataLocation="cpu"}let p=Ha(d);if(this.cpuData&&p!==this.cpuData.length&&!((u==="uint4"||u==="int4")&&Math.ceil(p/2)===this.cpuData.length))throw new Error(`Tensor's size(${p}) does not match data length(${this.cpuData.length}).`);this.type=u,this.dims=d,this.size=p}static async fromImage(r,i){return Ra(r,i)}static fromTexture(r,i){return Wa(r,i)}static fromGpuBuffer(r,i){return ka(r,i)}static fromMLTensor(r,i){return Na(r,i)}static fromPinnedBuffer(r,i,f){return Fa(r,i,f)}toDataURL(r){return Da(this,r)}toImageData(r){return Pa(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let i=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=i,r&&this.disposer&&(this.disposer(),this.disposer=void 0),i}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return ja(this,r)}}});var Le,Zr=F(()=>{"use strict";Ht();Le=ce});var qa,Xa,rt,nt,$e,ze,Kr=F(()=>{"use strict";Xr();qa=(o,r)=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.timeStamp(`${o}::ORT::${r}`)},Xa=(o,r)=>{let i=new Error().stack?.split(/\r\n|\r|\n/g)||[],f=!1;for(let u=0;u<i.length;u++){if(f&&!i[u].includes("TRACE_FUNC")){let d=`FUNC_${o}::${i[u].trim().split(" ")[1]}`;r&&(d+=`::${r}`),qa("CPU",d);return}i[u].includes("TRACE_FUNC")&&(f=!0)}},rt=o=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||Xa("BEGIN",o)},nt=o=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||Xa("END",o)},$e=o=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.time(`ORT::${o}`)},ze=o=>{(typeof ue.trace>"u"?!ue.wasm.trace:!ue.trace)||console.timeEnd(`ORT::${o}`)}});var jt,Ja=F(()=>{"use strict";qr();Zr();Kr();jt=class o{constructor(r){this.handler=r}async run(r,i,f){rt(),$e("InferenceSession.run");let u={},d={};if(typeof r!="object"||r===null||r instanceof Le||Array.isArray(r))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let p=!0;if(typeof i=="object"){if(i===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(i instanceof Le)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(i)){if(i.length===0)throw new TypeError("'fetches' cannot be an empty array.");p=!1;for(let w of i){if(typeof w!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(w)===-1)throw new RangeError(`'fetches' contains invalid output name: ${w}.`);u[w]=null}if(typeof f=="object"&&f!==null)d=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else{let w=!1,g=Object.getOwnPropertyNames(i);for(let v of this.outputNames)if(g.indexOf(v)!==-1){let T=i[v];(T===null||T instanceof Le)&&(w=!0,p=!1,u[v]=T)}if(w){if(typeof f=="object"&&f!==null)d=f;else if(typeof f<"u")throw new TypeError("'options' must be an object.")}else d=i}}else if(typeof i<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let w of this.inputNames)if(typeof r[w]>"u")throw new Error(`input '${w}' is missing in 'feeds'.`);if(p)for(let w of this.outputNames)u[w]=null;let m=await this.handler.run(r,u,d),y={};for(let w in m)if(Object.hasOwnProperty.call(m,w)){let g=m[w];g instanceof Le?y[w]=g:y[w]=new Le(g.type,g.data,g.dims)}return ze("InferenceSession.run"),nt(),y}async release(){return this.handler.dispose()}static async create(r,i,f,u){rt(),$e("InferenceSession.create");let d,p={};if(typeof r=="string"){if(d=r,typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(d=r,typeof i=="object"&&i!==null)p=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer){let g=r,v=0,T=r.byteLength;if(typeof i=="object"&&i!==null)p=i;else if(typeof i=="number"){if(v=i,!Number.isSafeInteger(v))throw new RangeError("'byteOffset' must be an integer.");if(v<0||v>=g.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${g.byteLength}).`);if(T=r.byteLength-v,typeof f=="number"){if(T=f,!Number.isSafeInteger(T))throw new RangeError("'byteLength' must be an integer.");if(T<=0||v+T>g.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${g.byteLength-v}].`);if(typeof u=="object"&&u!==null)p=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof f<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof i<"u")throw new TypeError("'options' must be an object.");d=new Uint8Array(g,v,T)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[m,y]=await La(p),w=await m.createInferenceSessionHandler(d,y);return ze("InferenceSession.create"),nt(),new o(w)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}});var Qf,Za=F(()=>{"use strict";Ja();Qf=jt});var Ka=F(()=>{"use strict"});var Qa=F(()=>{"use strict"});var es=F(()=>{"use strict"});var ts=F(()=>{"use strict"});var Qr={};At(Qr,{InferenceSession:()=>Qf,TRACE:()=>qa,TRACE_EVENT_BEGIN:()=>$e,TRACE_EVENT_END:()=>ze,TRACE_FUNC_BEGIN:()=>rt,TRACE_FUNC_END:()=>nt,Tensor:()=>Le,env:()=>ee,registerBackend:()=>et});var Ve=F(()=>{"use strict";Oa();Ca();Za();Zr();Ka();Qa();Kr();es();ts()});var Yt=F(()=>{"use strict"});var as={};At(as,{default:()=>ec});var ns,os,ec,ss=F(()=>{"use strict";en();He();qt();ns="ort-wasm-proxy-worker",os=globalThis.self?.name===ns;os&&(self.onmessage=o=>{let{type:r,in:i}=o.data;try{switch(r){case"init-wasm":Xt(i.wasm).then(()=>{Jt(i).then(()=>{postMessage({type:r})},f=>{postMessage({type:r,err:f})})},f=>{postMessage({type:r,err:f})});break;case"init-ep":{let{epName:f,env:u}=i;Zt(u,f).then(()=>{postMessage({type:r})},d=>{postMessage({type:r,err:d})});break}case"copy-from":{let{buffer:f}=i,u=It(f);postMessage({type:r,out:u});break}case"create":{let{model:f,options:u}=i;Kt(f,u).then(d=>{postMessage({type:r,out:d})},d=>{postMessage({type:r,err:d})});break}case"release":Qt(i),postMessage({type:r});break;case"run":{let{sessionId:f,inputIndices:u,inputs:d,outputIndices:p,options:m}=i;er(f,u,d,p,new Array(p.length).fill(null),m).then(y=>{y.some(w=>w[3]!=="cpu")?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:y},rr([...d,...y]))},y=>{postMessage({type:r,err:y})});break}case"end-profiling":tr(i),postMessage({type:r});break;default:}}catch(f){postMessage({type:r,err:f})}});ec=os?null:o=>new Worker(o??we,{type:"module",name:ns})});var us={};At(us,{default:()=>tc});async function is(o={}){var r=o,i=typeof window=="object",f=typeof WorkerGlobalScope<"u",u=f&&self.name?.startsWith("em-pthread");r.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(r.Zc||(r.Zc=new Map)).set(e,t)},r.unmountExternalData=()=>{delete r.Zc};var d=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,Me:!0}).buffer.constructor;let p=()=>{let e=t=>(...n)=>{let s=Be;return n=t(...n),Be!=s?new Promise((a,c)=>{Or={resolve:a,reject:c}}):n};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])r[t]=e(r[t])})(),typeof jsepRunAsync<"u"&&(r._OrtRun=jsepRunAsync(r._OrtRun),r._OrtRunWithBinding=jsepRunAsync(r._OrtRunWithBinding)),p=void 0};r.asyncInit=()=>{p?.()};var m,y,w=(e,t)=>{throw t},g=import.meta.url,v="";if(i||f){try{v=new URL(".",g).href}catch{}f&&(y=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),m=async e=>{if(ne(e))return new Promise((n,s)=>{var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="arraybuffer",a.onload=()=>{a.status==200||a.status==0&&a.response?n(a.response):s(a.status)},a.onerror=s,a.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var T,x,M,W,j,U,B,X=console.log.bind(console),_=console.error.bind(console),H=X,V=_,re=!1,ne=e=>e.startsWith("file://");function l(){Se.buffer!=Y.buffer&&ke()}if(u){let e=function(t){try{var n=t.data,s=n.Vc;if(s==="load"){let a=[];self.onmessage=c=>a.push(c),B=()=>{postMessage({Vc:"loaded"});for(let c of a)e(c);self.onmessage=e};for(let c of n.le)r[c]&&!r[c].proxy||(r[c]=(...h)=>{postMessage({Vc:"callHandler",ke:c,args:h})},c=="print"&&(H=r[c]),c=="printErr"&&(V=r[c]));Se=n.Fe,ke(),U(n.Ge)}else if(s==="run"){(function(a){var c=(l(),S)[a+52>>>2>>>0];a=(l(),S)[a+56>>>2>>>0],Ro(c,c-a),D(c)})(n.Tc),$r(n.Tc,0,0,1,0,0),Tn(),Ir(n.Tc),ye||(bo(),ye=!0);try{Xs(n.se,n.dd)}catch(a){if(a!="unwind")throw a}}else n.target!=="setimmediate"&&(s==="checkMailbox"?ye&&Dt():s&&(V(`worker: received unknown command ${s}`),V(n)))}catch(a){throw Uo(),a}};var Ic=e,ye=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}var Se,Y,J,Ue,C,I,S,q,ae,$,se,yr=!1;function ke(){var e=Se.buffer;r.HEAP8=Y=new Int8Array(e),Ue=new Int16Array(e),r.HEAPU8=J=new Uint8Array(e),C=new Uint16Array(e),r.HEAP32=I=new Int32Array(e),r.HEAPU32=S=new Uint32Array(e),q=new Float32Array(e),ae=new Float64Array(e),$=new BigInt64Array(e),se=new BigUint64Array(e)}function Ye(){yr=!0,u?B():Ge.cc()}var ft,qe=0,he=null;function Ae(){if(--qe==0&&he){var e=he;he=null,e()}}function de(e){throw V(e="Aborted("+e+")"),re=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),j?.(e),e}function oe(){return{a:{ra:ff,g:Js,K:Zs,f:Ks,m:Qs,h:ei,ua:ti,b:ri,ea:ni,Ha:In,n:oi,fa:Mn,Xa:Un,$b:Cn,bc:Dn,Ya:Pn,Va:_n,Oa:Rn,Ua:Wn,pa:kn,ac:Nn,Zb:Fn,Wa:Gn,_b:$n,bb:ai,Ea:ii,Ub:ui,Sb:ci,Da:di,P:pi,I:mi,Tb:hi,ka:Ei,Vb:Si,Ra:Ai,Xb:xi,Ia:Ii,Pb:Li,Fa:Oi,Qa:Ir,_a:Bi,V:Di,s:ki,c:Sr,qb:Ni,y:Fi,N:Gi,C:$i,p:zi,t:Jn,rb:Jn,J:Vi,U:Hi,j:ji,u:Yi,r:qi,l:Xi,La:Ji,Ma:Zi,Na:Ki,Ja:eo,Ka:to,Rb:ro,db:eu,ab:nu,Y:ou,pb:au,la:su,$a:tu,X:iu,Za:uu,Yb:fu,G:Qi,gb:cu,_:lu,qa:kt,Wb:du,fb:pu,eb:mu,mb:Tu,F:vu,ta:Eu,sa:Su,ob:Au,Z:xu,x:Iu,lb:Lu,kb:Ou,nb:Bu,jb:Mu,ib:Uu,hb:Cu,Sa:fo,Ta:co,Ga:wr,ga:lo,oa:po,Pa:mo,ma:ho,Db:Hf,ya:kf,Eb:Vf,za:Wf,H:Bf,e:pf,o:lf,w:cf,B:Sf,Jb:Df,L:If,v:hf,Aa:_f,ca:Nf,ia:Cf,Fb:zf,Gb:$f,Hb:Pf,Ba:Uf,Kb:Mf,O:Lf,da:Rf,d:mf,A:yf,k:df,Cb:jf,q:bf,z:Ef,D:vf,E:wf,M:Af,Lb:Of,R:Ff,ja:xf,ba:Gf,Nb:Tf,Ob:gf,i:Pu,a:Se,cb:br,Bb:_u,ha:Ru,Q:Wu,na:ku,Ib:Nu,S:Fu,yb:Gu,zb:$u,va:zu,T:Vu,Ca:Hu,wa:ju,aa:Yu,wb:qu,Qb:Xu,W:Ju,sb:Zu,Ab:Ku,tb:Qu,ub:tf,vb:rf,$:nf,xa:of,xb:af,Mb:sf}}}class Z{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var xe=e=>{e.terminate(),e.onmessage=()=>{}},Ce=[],ct=e=>{Ne.length==0&&(En(),vn(Ne[0]));var t=Ne.pop();if(!t)return 6;gt.push(t),Xe[e.Tc]=t,t.Tc=e.Tc;var n={Vc:"run",se:e.qe,dd:e.dd,Tc:e.Tc};return t.postMessage(n,e.fe),0},te=0,Q=(e,t,...n)=>{for(var s=2*n.length,a=P(),c=$t(8*s),h=c>>>3,b=0;b<n.length;b++){var E=n[b];typeof E=="bigint"?((l(),$)[h+2*b>>>0]=1n,(l(),$)[h+2*b+1>>>0]=E):((l(),$)[h+2*b>>>0]=0n,(l(),ae)[h+2*b+1>>>0]=E)}return e=Co(e,0,s,c,t),D(a),e};function br(e){if(u)return Q(0,1,e);if(M=e,!(0<te)){for(var t of gt)xe(t);for(t of Ne)xe(t);Ne=[],gt=[],Xe={},re=!0}w(0,new Z(e))}function bn(e){if(u)return Q(1,0,e);wr(e)}var wr=e=>{if(M=e,u)throw bn(e),"unwind";br(e)},Ne=[],gt=[],wn=[],Xe={},gn=e=>{var t=e.Tc;delete Xe[t],Ne.push(e),gt.splice(gt.indexOf(e),1),e.Tc=0,Do(t)};function Tn(){wn.forEach(e=>e())}var vn=e=>new Promise(t=>{e.onmessage=a=>{var c=(a=a.data).Vc;if(a.$c&&a.$c!=Wr()){var h=Xe[a.$c];h?h.postMessage(a,a.fe):V(`Internal error! Worker sent a message "${c}" to target pthread ${a.$c}, but that thread no longer exists!`)}else c==="checkMailbox"?Dt():c==="spawnThread"?ct(a):c==="cleanupThread"?gn(Xe[a.te]):c==="loaded"?(e.loaded=!0,t(e)):a.target==="setimmediate"?e.postMessage(a):c==="callHandler"?r[a.ke](...a.args):c&&V(`worker sent an unknown command ${c}`)},e.onerror=a=>{throw V(`worker sent an error! ${a.filename}:${a.lineno}: ${a.message}`),a};var n,s=[];for(n of[])r.propertyIsEnumerable(n)&&s.push(n);e.postMessage({Vc:"load",le:s,Fe:Se,Ge:x})});function En(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});Ne.push(e)}var Xs=(e,t)=>{te=0,e=Hr(e,t),0<te?M=e:zr(e)},Ut=[],Ct=0,be=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function Js(e){var t=new gr(e>>>=0);return(l(),Y)[t.Uc+12>>>0]==0&&(Sn(t,!0),Ct--),An(t,!1),Ut.push(t),ko(e),Fo(e)}var lt=0,Zs=()=>{N(0,0);var e=Ut.pop();Wo(e.Ud),lt=0};function Sn(e,t){t=t?1:0,(l(),Y)[e.Uc+12>>>0]=t}function An(e,t){t=t?1:0,(l(),Y)[e.Uc+13>>>0]=t}class gr{constructor(t){this.Ud=t,this.Uc=t-24}}var Tr=e=>{var t=lt;if(!t)return St(0),0;var n=new gr(t);(l(),S)[n.Uc+16>>>2>>>0]=t;var s=(l(),S)[n.Uc+4>>>2>>>0];if(!s)return St(0),t;for(var a of e){if(a===0||a===s)break;if(No(a,s,n.Uc+16))return St(a),t}return St(s),t};function Ks(){return Tr([])}function Qs(e){return Tr([e>>>0])}function ei(e,t,n,s){return Tr([e>>>0,t>>>0,n>>>0,s>>>0])}var ti=()=>{var e=Ut.pop();e||de("no exception to throw");var t=e.Ud;throw(l(),Y)[e.Uc+13>>>0]==0&&(Ut.push(e),An(e,!0),Sn(e,!1),Ct++),lt=t};function ri(e,t,n){var s=new gr(e>>>=0);throw t>>>=0,n>>>=0,(l(),S)[s.Uc+16>>>2>>>0]=0,(l(),S)[s.Uc+4>>>2>>>0]=t,(l(),S)[s.Uc+8>>>2>>>0]=n,Ct++,lt=e}var ni=()=>Ct;function xn(e,t,n,s){return u?Q(2,1,e,t,n,s):In(e,t,n,s)}function In(e,t,n,s){if(e>>>=0,n>>>=0,s>>>=0,d===void 0)return 6;var a=[];return u&&a.length===0?xn(e,t>>>=0,n,s):(e={qe:n,Tc:e,dd:s,fe:a},u?(e.Vc="spawnThread",postMessage(e,a),0):ct(e))}function oi(e){throw lt||=e>>>0,lt}var Ln=typeof TextDecoder<"u"?new TextDecoder:void 0,On=(e,t,n,s)=>{if(n=t+n,s)return n;for(;e[t]&&!(t>=n);)++t;return t},Bn=(e,t=0,n,s)=>{if(16<(n=On(e,t>>>=0,n,s))-t&&e.buffer&&Ln)return Ln.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,n):e.slice(t,n));for(s="";t<n;){var a=e[t++];if(128&a){var c=63&e[t++];if((224&a)==192)s+=String.fromCharCode((31&a)<<6|c);else{var h=63&e[t++];65536>(a=(240&a)==224?(15&a)<<12|c<<6|h:(7&a)<<18|c<<12|h<<6|63&e[t++])?s+=String.fromCharCode(a):(a-=65536,s+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else s+=String.fromCharCode(a)}return s},dt=(e,t,n)=>(e>>>=0)?Bn((l(),J),e,t,n):"";function Mn(e,t,n){return u?Q(3,1,e,t,n):0}function Un(e,t){if(u)return Q(4,1,e,t)}function Cn(e,t){if(u)return Q(5,1,e,t)}function Dn(e,t,n){if(u)return Q(6,1,e,t,n)}function Pn(e,t,n){return u?Q(7,1,e,t,n):0}function _n(e,t){if(u)return Q(8,1,e,t)}function Rn(e,t,n){if(u)return Q(9,1,e,t,n)}function Wn(e,t,n,s){if(u)return Q(10,1,e,t,n,s)}function kn(e,t,n,s){if(u)return Q(11,1,e,t,n,s)}function Nn(e,t,n,s){if(u)return Q(12,1,e,t,n,s)}function Fn(e){if(u)return Q(13,1,e)}function Gn(e,t){if(u)return Q(14,1,e,t)}function $n(e,t,n){if(u)return Q(15,1,e,t,n)}var ai=()=>de(""),Oe=e=>{e>>>=0;for(var t="";;){var n=(l(),J)[e++>>>0];if(!n)return t;t+=String.fromCharCode(n)}},vr={},Er={},si={},pt=class extends Error{constructor(e){super(e),this.name="BindingError"}};function De(e,t,n={}){return function(s,a,c={}){var h=a.name;if(!s)throw new pt(`type "${h}" must have a positive integer typeid pointer`);if(Er.hasOwnProperty(s)){if(c.ne)return;throw new pt(`Cannot register type '${h}' twice`)}Er[s]=a,delete si[s],vr.hasOwnProperty(s)&&(a=vr[s],delete vr[s],a.forEach(b=>b()))}(e,t,n)}var zn=(e,t,n)=>{switch(t){case 1:return n?s=>(l(),Y)[s>>>0]:s=>(l(),J)[s>>>0];case 2:return n?s=>(l(),Ue)[s>>>1>>>0]:s=>(l(),C)[s>>>1>>>0];case 4:return n?s=>(l(),I)[s>>>2>>>0]:s=>(l(),S)[s>>>2>>>0];case 8:return n?s=>(l(),$)[s>>>3>>>0]:s=>(l(),se)[s>>>3>>>0];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function ii(e,t,n,s,a){e>>>=0,n>>>=0,t=Oe(t>>>0);let c=h=>h;if(s=s===0n){let h=8*n;c=b=>BigInt.asUintN(h,b),a=c(a)}De(e,{name:t,Rc:c,Xc:(h,b)=>(typeof b=="number"&&(b=BigInt(b)),b),Wc:zn(t,n,!s),Yc:null})}function ui(e,t,n,s){De(e>>>=0,{name:t=Oe(t>>>0),Rc:function(a){return!!a},Xc:function(a,c){return c?n:s},Wc:function(a){return this.Rc((l(),J)[a>>>0])},Yc:null})}var Vn=[],Je=[0,1,,1,null,1,!0,1,!1,1];function Sr(e){9<(e>>>=0)&&--Je[e+1]==0&&(Je[e]=void 0,Vn.push(e))}var ge=e=>{if(!e)throw new pt(`Cannot use deleted val. handle = ${e}`);return Je[e]},Ie=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=Vn.pop()||Je.length;return Je[t]=e,Je[t+1]=1,t}};function Ar(e){return this.Rc((l(),S)[e>>>2>>>0])}var fi={name:"emscripten::val",Rc:e=>{var t=ge(e);return Sr(e),t},Xc:(e,t)=>Ie(t),Wc:Ar,Yc:null};function ci(e){return De(e>>>0,fi)}var li=(e,t)=>{switch(t){case 4:return function(n){return this.Rc((l(),q)[n>>>2>>>0])};case 8:return function(n){return this.Rc((l(),ae)[n>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function di(e,t,n){n>>>=0,De(e>>>=0,{name:t=Oe(t>>>0),Rc:s=>s,Xc:(s,a)=>a,Wc:li(t,n),Yc:null})}function pi(e,t,n,s,a){e>>>=0,n>>>=0,t=Oe(t>>>0);let c=b=>b;if(s===0){var h=32-8*n;c=b=>b<<h>>>h,a=c(a)}De(e,{name:t,Rc:c,Xc:(b,E)=>E,Wc:zn(t,n,s!==0),Yc:null})}function mi(e,t,n){function s(c){var h=(l(),S)[c>>>2>>>0];return c=(l(),S)[c+4>>>2>>>0],new a((l(),Y).buffer,c,h)}var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];De(e>>>=0,{name:n=Oe(n>>>0),Rc:s,Wc:s},{ne:!0})}var Pe=(e,t,n)=>{var s=(l(),J);if(t>>>=0,0<n){var a=t;n=t+n-1;for(var c=0;c<e.length;++c){var h=e.codePointAt(c);if(127>=h){if(t>=n)break;s[t++>>>0]=h}else if(2047>=h){if(t+1>=n)break;s[t++>>>0]=192|h>>6,s[t++>>>0]=128|63&h}else if(65535>=h){if(t+2>=n)break;s[t++>>>0]=224|h>>12,s[t++>>>0]=128|h>>6&63,s[t++>>>0]=128|63&h}else{if(t+3>=n)break;s[t++>>>0]=240|h>>18,s[t++>>>0]=128|h>>12&63,s[t++>>>0]=128|h>>6&63,s[t++>>>0]=128|63&h,c++}}s[t>>>0]=0,e=t-a}else e=0;return e},_e=e=>{for(var t=0,n=0;n<e.length;++n){var s=e.charCodeAt(n);127>=s?t++:2047>=s?t+=2:55296<=s&&57343>=s?(t+=4,++n):t+=3}return t};function hi(e,t){De(e>>>=0,{name:t=Oe(t>>>0),Rc(n){var s=(l(),S)[n>>>2>>>0];return s=dt(n+4,s,!0),Te(n),s},Xc(n,s){s instanceof ArrayBuffer&&(s=new Uint8Array(s));var a=typeof s=="string";if(!(a||ArrayBuffer.isView(s)&&s.BYTES_PER_ELEMENT==1))throw new pt("Cannot pass non-string to std::string");var c=a?_e(s):s.length,h=ht(4+c+1),b=h+4;return(l(),S)[h>>>2>>>0]=c,a?Pe(s,b,c+1):(l(),J).set(s,b>>>0),n!==null&&n.push(Te,h),h},Wc:Ar,Yc(n){Te(n)}})}var Hn=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,yi=(e,t,n)=>{if(e>>>=1,16<(t=On((l(),C),e,t/2,n))-e&&Hn)return Hn.decode((l(),C).buffer instanceof ArrayBuffer?(l(),C).subarray(e>>>0,t>>>0):(l(),C).slice(e,t));for(n="";e<t;++e){var s=(l(),C)[e>>>0];n+=String.fromCharCode(s)}return n},bi=(e,t,n)=>{if(n??=2147483647,2>n)return 0;var s=t;n=(n-=2)<2*e.length?n/2:e.length;for(var a=0;a<n;++a){var c=e.charCodeAt(a);(l(),Ue)[t>>>1>>>0]=c,t+=2}return(l(),Ue)[t>>>1>>>0]=0,t-s},wi=e=>2*e.length,gi=(e,t,n)=>{var s="";e>>>=2;for(var a=0;!(a>=t/4);a++){var c=(l(),S)[e+a>>>0];if(!c&&!n)break;s+=String.fromCodePoint(c)}return s},Ti=(e,t,n)=>{if(t>>>=0,n??=2147483647,4>n)return 0;var s=t;n=s+n-4;for(var a=0;a<e.length;++a){var c=e.codePointAt(a);if(65535<c&&a++,(l(),I)[t>>>2>>>0]=c,(t+=4)+4>n)break}return(l(),I)[t>>>2>>>0]=0,t-s},vi=e=>{for(var t=0,n=0;n<e.length;++n)65535<e.codePointAt(n)&&n++,t+=4;return t};function Ei(e,t,n){if(e>>>=0,t>>>=0,n=Oe(n>>>=0),t===2)var s=yi,a=bi,c=wi;else s=gi,a=Ti,c=vi;De(e,{name:n,Rc:h=>{var b=(l(),S)[h>>>2>>>0];return b=s(h+4,b*t,!0),Te(h),b},Xc:(h,b)=>{if(typeof b!="string")throw new pt(`Cannot pass non-string to C++ string type ${n}`);var E=c(b),A=ht(4+E+t);return(l(),S)[A>>>2>>>0]=E/t,a(b,A+4,E+t),h!==null&&h.push(Te,A),A},Wc:Ar,Yc(h){Te(h)}})}function Si(e,t){De(e>>>=0,{oe:!0,name:t=Oe(t>>>0),Rc:()=>{},Xc:()=>{}})}function Ai(e){$r(e>>>0,!f,1,!i,131072,!1),Tn()}var xr=e=>{if(!re)try{if(e(),!(0<te))try{u?zr(M):wr(M)}catch(t){t instanceof Z||t=="unwind"||w(0,t)}}catch(t){t instanceof Z||t=="unwind"||w(0,t)}};function Ir(e){e>>>=0,typeof Atomics.Ee=="function"&&(Atomics.Ee((l(),I),e>>>2,e).value.then(Dt),e+=128,Atomics.store((l(),I),e>>>2,1))}var Dt=()=>{var e=Wr();e&&(Ir(e),xr(_o))};function xi(e,t){(e>>>=0)==t>>>0?setTimeout(Dt):u?postMessage({$c:e,Vc:"checkMailbox"}):(e=Xe[e])&&e.postMessage({Vc:"checkMailbox"})}var Pt=[];function Ii(e,t,n,s,a){for(t>>>=0,s/=2,Pt.length=s,n=a>>>0>>>3,a=0;a<s;a++)(l(),$)[n+2*a>>>0]?Pt[a]=(l(),$)[n+2*a+1>>>0]:Pt[a]=(l(),ae)[n+2*a+1>>>0];return(t?_r[t]:uf[e])(...Pt)}var Li=()=>{te=0};function Oi(e){e>>>=0,u?postMessage({Vc:"cleanupThread",te:e}):gn(Xe[e])}function Bi(e){}var _t=e=>{try{e()}catch(t){de(t)}};function Mi(e){var t=(...n)=>{Rt.push(e);try{return e(...n)}finally{re||(Rt.pop(),Be&&Fe===1&&Rt.length===0&&(Fe=0,te+=1,_t(Aa),typeof Fibers<"u"&&Fibers.Oe()))}};return qn.set(e,t),t}var Fe=0,Be=null,jn=0,Rt=[],Lr=new Map,Yn=new Map,qn=new Map,Ui=0,Or=null,Ci=[],Xn=e=>function(t){if(!re){if(Fe===0){var n=!1,s=!1;t((a=0)=>{if(!re&&(jn=a,n=!0,s)){Fe=2,_t(()=>xa(Be)),typeof MainLoop<"u"&&MainLoop.je&&MainLoop.resume(),a=!1;try{var c=function(){var E=(l(),I)[Be+8>>>2>>>0];return E=Yn.get(E),E=qn.get(E),--te,E()}()}catch(E){c=E,a=!0}var h=!1;if(!Be){var b=Or;b&&(Or=null,(a?b.reject:b.resolve)(c),h=!0)}if(a&&!h)throw c}}),s=!0,n||(Fe=1,Be=function(){var a=ht(65548),c=a+12;if((l(),S)[a>>>2>>>0]=c,(l(),S)[a+4>>>2>>>0]=c+65536,c=Rt[0],!Lr.has(c)){var h=Ui++;Lr.set(c,h),Yn.set(h,c)}return c=Lr.get(c),(l(),I)[a+8>>>2>>>0]=c,a}(),typeof MainLoop<"u"&&MainLoop.je&&MainLoop.pause(),_t(()=>Sa(Be)))}else Fe===2?(Fe=0,_t(Ia),Te(Be),Be=null,Ci.forEach(xr)):de(`invalid state: ${Fe}`);return jn}}(t=>{e().then(t)});function Di(e){return e>>>=0,Xn(async()=>{var t=await ge(e);return Ie(t)})}var Br=[],Pi=e=>{var t=Br.length;return Br.push(e),t},_i=(e,t)=>{for(var n=Array(e),s=0;s<e;++s){var a=s,c=(l(),S)[t+4*s>>>2>>>0],h=Er[c];if(h===void 0)throw e=`parameter ${s}`,c=yo(c),t=Oe(c),Te(c),new pt(`${e} has unknown type ${t}`);n[a]=h}return n},Ri=(e,t,n)=>{var s=[];return e=e(s,n),s.length&&((l(),S)[t>>>2>>>0]=Ie(s)),e},Wi={},Wt=e=>{var t=Wi[e];return t===void 0?Oe(e):t};function ki(e,t,n){var[s,...a]=_i(e,t>>>0);t=s.Xc.bind(s);var c=a.map(E=>E.Wc.bind(E));e--;var h={toValue:ge};switch(e=c.map((E,A)=>{var R=`argFromPtr${A}`;return h[R]=E,`${R}(args${A?"+"+8*A:""})`}),n){case 0:var b="toValue(handle)";break;case 2:b="new (toValue(handle))";break;case 3:b="";break;case 1:h.getStringOrSymbol=Wt,b="toValue(handle)[getStringOrSymbol(methodName)]"}return b+=`(${e})`,s.oe||(h.toReturnWire=t,h.emval_returnValue=Ri,b=`return emval_returnValue(toReturnWire, destructorsRef, ${b})`),b=`return function (handle, methodName, destructorsRef, args) {
  ${b}
  }`,n=new Function(Object.keys(h),b)(...Object.values(h)),b=`methodCaller<(${a.map(E=>E.name)}) => ${s.name}>`,Pi(Object.defineProperty(n,"name",{value:b}))}function Ni(e,t){return t>>>=0,(e=ge(e>>>0))==ge(t)}function Fi(e){return(e>>>=0)==0?Ie(globalThis):(e=Wt(e),Ie(globalThis[e]))}function Gi(e){return e=Wt(e>>>0),Ie(r[e])}function $i(e,t){return t>>>=0,e=ge(e>>>0),t=ge(t),Ie(e[t])}function zi(e){9<(e>>>=0)&&(Je[e+1]+=1)}function Jn(e,t,n,s,a){return Br[e>>>0](t>>>0,n>>>0,s>>>0,a>>>0)}function Vi(){return Ie([])}function Hi(e){e=ge(e>>>0);for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return Ie(t)}function ji(e){return Ie(Wt(e>>>0))}function Yi(){return Ie({})}function qi(e){for(var t=ge(e>>>=0);t.length;){var n=t.pop();t.pop()(n)}Sr(e)}function Xi(e,t,n){t>>>=0,n>>>=0,e=ge(e>>>0),t=ge(t),n=ge(n),e[t]=n}function Ji(e,t){e=be(e),t>>>=0,e=new Date(1e3*e),(l(),I)[t>>>2>>>0]=e.getUTCSeconds(),(l(),I)[t+4>>>2>>>0]=e.getUTCMinutes(),(l(),I)[t+8>>>2>>>0]=e.getUTCHours(),(l(),I)[t+12>>>2>>>0]=e.getUTCDate(),(l(),I)[t+16>>>2>>>0]=e.getUTCMonth(),(l(),I)[t+20>>>2>>>0]=e.getUTCFullYear()-1900,(l(),I)[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,(l(),I)[t+28>>>2>>>0]=e}var Zn=e=>e%4==0&&(e%100!=0||e%400==0),Kn=[0,31,60,91,121,152,182,213,244,274,305,335],Qn=[0,31,59,90,120,151,181,212,243,273,304,334];function Zi(e,t){e=be(e),t>>>=0,e=new Date(1e3*e),(l(),I)[t>>>2>>>0]=e.getSeconds(),(l(),I)[t+4>>>2>>>0]=e.getMinutes(),(l(),I)[t+8>>>2>>>0]=e.getHours(),(l(),I)[t+12>>>2>>>0]=e.getDate(),(l(),I)[t+16>>>2>>>0]=e.getMonth(),(l(),I)[t+20>>>2>>>0]=e.getFullYear()-1900,(l(),I)[t+24>>>2>>>0]=e.getDay();var n=(Zn(e.getFullYear())?Kn:Qn)[e.getMonth()]+e.getDate()-1|0;(l(),I)[t+28>>>2>>>0]=n,(l(),I)[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),n=new Date(e.getFullYear(),6,1).getTimezoneOffset();var s=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(n!=s&&e.getTimezoneOffset()==Math.min(s,n)),(l(),I)[t+32>>>2>>>0]=e}function Ki(e){e>>>=0;var t=new Date((l(),I)[e+20>>>2>>>0]+1900,(l(),I)[e+16>>>2>>>0],(l(),I)[e+12>>>2>>>0],(l(),I)[e+8>>>2>>>0],(l(),I)[e+4>>>2>>>0],(l(),I)[e>>>2>>>0],0),n=(l(),I)[e+32>>>2>>>0],s=t.getTimezoneOffset(),a=new Date(t.getFullYear(),6,1).getTimezoneOffset(),c=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(c,a);return 0>n?(l(),I)[e+32>>>2>>>0]=+(a!=c&&h==s):0<n!=(h==s)&&(a=Math.max(c,a),t.setTime(t.getTime()+6e4*((0<n?h:a)-s))),(l(),I)[e+24>>>2>>>0]=t.getDay(),n=(Zn(t.getFullYear())?Kn:Qn)[t.getMonth()]+t.getDate()-1|0,(l(),I)[e+28>>>2>>>0]=n,(l(),I)[e>>>2>>>0]=t.getSeconds(),(l(),I)[e+4>>>2>>>0]=t.getMinutes(),(l(),I)[e+8>>>2>>>0]=t.getHours(),(l(),I)[e+12>>>2>>>0]=t.getDate(),(l(),I)[e+16>>>2>>>0]=t.getMonth(),(l(),I)[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function eo(e,t,n,s,a,c,h){return u?Q(16,1,e,t,n,s,a,c,h):-52}function to(e,t,n,s,a,c){if(u)return Q(17,1,e,t,n,s,a,c)}var Tt={},Qi=()=>performance.timeOrigin+performance.now();function ro(e,t){if(u)return Q(18,1,e,t);if(Tt[e]&&(clearTimeout(Tt[e].id),delete Tt[e]),!t)return 0;var n=setTimeout(()=>{delete Tt[e],xr(()=>Po(e,performance.timeOrigin+performance.now()))},t);return Tt[e]={id:n,Ne:t},0}function eu(e,t,n,s){e>>>=0,t>>>=0,n>>>=0,s>>>=0;var a=new Date().getFullYear(),c=new Date(a,0,1).getTimezoneOffset();a=new Date(a,6,1).getTimezoneOffset();var h=Math.max(c,a);(l(),S)[e>>>2>>>0]=60*h,(l(),I)[t>>>2>>>0]=+(c!=a),e=(t=b=>{var E=Math.abs(b);return`UTC${0<=b?"-":"+"}${String(Math.floor(E/60)).padStart(2,"0")}${String(E%60).padStart(2,"0")}`})(c),t=t(a),a<c?(Pe(e,n,17),Pe(t,s,17)):(Pe(e,s,17),Pe(t,n,17))}var tu=()=>Date.now(),ru=1;function nu(e,t,n){if(n>>>=0,!(0<=e&&3>=e))return 28;if(e===0)e=Date.now();else{if(!ru)return 52;e=performance.timeOrigin+performance.now()}return e=Math.round(1e6*e),(l(),$)[n>>>3>>>0]=BigInt(e),0}var Mr=[],no=(e,t)=>{Mr.length=0;for(var n;n=(l(),J)[e++>>>0];){var s=n!=105;t+=(s&=n!=112)&&t%8?4:0,Mr.push(n==112?(l(),S)[t>>>2>>>0]:n==106?(l(),$)[t>>>3>>>0]:n==105?(l(),I)[t>>>2>>>0]:(l(),ae)[t>>>3>>>0]),t+=s?8:4}return Mr};function ou(e,t,n){return e>>>=0,t=no(t>>>0,n>>>0),_r[e](...t)}function au(e,t,n){return e>>>=0,t=no(t>>>0,n>>>0),_r[e](...t)}var su=()=>{};function iu(e,t){return V(dt(e>>>0,t>>>0))}var uu=()=>{throw te+=1,"unwind"};function fu(){return 4294901760}var cu=()=>1,lu=()=>navigator.hardwareConcurrency,Ze={},oo=e=>{var t=_e(e)+1,n=ht(t);return n&&Pe(e,n,t),n};function kt(e){if(!(2147483648&(e>>>=0)))return de("Cannot use emscripten_pc_get_function on native functions without -sUSE_OFFSET_CONVERTER"),0;if(!(e=Ze[e]))return 0;var t;if(t=/^\s+at (.*) \(.*\)$/.exec(e))e=t[1];else{if(!(t=/^(.+?)@/.exec(e)))return 0;e=t[1]}return Te(kt.ee??0),kt.ee=oo(e),kt.ee}function du(e){e>>>=0;var t=(l(),J).length;if(e<=t||4294901760<e)return!1;for(var n=1;4>=n;n*=2){var s=t*(1+.2/n);s=Math.min(s,e+100663296);e:{s=(Math.min(4294901760,65536*Math.ceil(Math.max(e,s)/65536))-Se.buffer.byteLength+65535)/65536|0;try{Se.grow(s),ke();var a=1;break e}catch{}a=void 0}if(a)return!0}return!1}var Nt=e=>{var t;if(t=/\bwasm-function\[\d+\]:(0x[0-9a-f]+)/.exec(e))return+t[1];if(/\bwasm-function\[(\d+)\]:(\d+)/.exec(e))de("Legacy backtrace format detected but -sUSE_OFFSET_CONVERTER not present.");else if(t=/:(\d+):\d+(?:\)|$)/.exec(e))return 2147483648|+t[1];return 0},ao=e=>{e.forEach(t=>{var n=Nt(t);n&&(Ze[n]=t)})};function pu(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),ao(e),Ze.de=Nt(e[3]),Ze.pe=e,Ze.de}function mu(e,t,n){if(e>>>=0,t>>>=0,Ze.de==e)var s=Ze.pe;else(s=Error().stack.toString().split(`
`))[0]=="Error"&&s.shift(),ao(s);for(var a=3;s[a]&&Nt(s[a])!=e;)++a;for(e=0;e<n&&s[e+a];++e)(l(),I)[t+4*e>>>2>>>0]=Nt(s[e+a]);return e}var Re=e=>{var t=_e(e)+1,n=$t(t);return Pe(e,n,t),n},Ur=[],pe=(e,t)=>{Ur[e>>>=0]=t},Me=[],Ft=[],vt=(e,t)=>{Ft[e]=new Promise(n=>t.finally(()=>n(e)))},O=e=>{if(e)return Ur[e>>>0]},Gt=(e,t,n)=>{(l(),S)[e>>>2>>>0]=t,(l(),S)[e+4>>>2>>>0]=n},so=e=>{var t=(l(),S)[e>>>2>>>0];return e=(l(),S)[e+4>>>2>>>0],dt(t,e)},We=e=>{var t=(l(),S)[e>>>2>>>0];return e=(l(),S)[e+4>>>2>>>0],t?dt(t,e):e===0?"":void 0},io=(e,t)=>{function n(a,c){a=e[a],(l(),I)[t+c>>>2>>>0]=a}function s(a,c){a=e[a],(l(),$)[t+c>>>3>>>0]=BigInt(a)}n("maxTextureDimension1D",4),n("maxTextureDimension2D",8),n("maxTextureDimension3D",12),n("maxTextureArrayLayers",16),n("maxBindGroups",20),n("maxBindGroupsPlusVertexBuffers",24),n("maxBindingsPerBindGroup",28),n("maxDynamicUniformBuffersPerPipelineLayout",32),n("maxDynamicStorageBuffersPerPipelineLayout",36),n("maxSampledTexturesPerShaderStage",40),n("maxSamplersPerShaderStage",44),n("maxStorageBuffersPerShaderStage",48),n("maxStorageTexturesPerShaderStage",52),n("maxUniformBuffersPerShaderStage",56),n("minUniformBufferOffsetAlignment",80),n("minStorageBufferOffsetAlignment",84),s("maxUniformBufferBindingSize",64),s("maxStorageBufferBindingSize",72),n("maxVertexBuffers",88),s("maxBufferSize",96),n("maxVertexAttributes",104),n("maxVertexBufferArrayStride",108),n("maxInterStageShaderVariables",112),n("maxColorAttachments",116),n("maxColorAttachmentBytesPerSample",120),n("maxComputeWorkgroupStorageSize",124),n("maxComputeInvocationsPerWorkgroup",128),n("maxComputeWorkgroupSizeX",132),n("maxComputeWorkgroupSizeY",136),n("maxComputeWorkgroupSizeZ",140),n("maxComputeWorkgroupsPerDimension",144),e.Le!==void 0&&n("maxImmediateSize",148)},hu=[,"validation","out-of-memory","internal"],yu=[,"compatibility","core"],Cr={1:"core-features-and-limits",2:"depth-clip-control",3:"depth32float-stencil8",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"timestamp-query",10:"indirect-first-instance",11:"shader-f16",12:"rg11b10ufloat-renderable",13:"bgra8unorm-storage",14:"float32-filterable",15:"float32-blendable",16:"clip-distances",17:"dual-source-blending",18:"subgroups",19:"texture-formats-tier1",20:"texture-formats-tier2",21:"primitive-index",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},bu=[,"low-power","high-performance"],wu=[,"occlusion","timestamp"],gu={undefined:1,unknown:1,destroyed:2};function Tu(e,t,n,s,a,c){t=be(t),n=be(n),s>>>=0,a>>>=0,c>>>=0,e=O(e>>>0);var h={};if(c){var b=(l(),S)[c+12>>>2>>>0];if(b){var E=(l(),S)[c+16>>>2>>>0];h.requiredFeatures=Array.from((l(),S).subarray(E>>>2>>>0,E+4*b>>>2>>>0),L=>Cr[L])}var A=(l(),S)[c+20>>>2>>>0];if(A){let L=function(ve,ie,Ke=!1){ie=A+ie,(ie=(l(),S)[ie>>>2>>>0])==4294967295||Ke&&ie==0||(R[ve]=ie)},fe=function(ve,ie){ie=A+ie;var Ke=(l(),S)[ie>>>2>>>0],Yf=(l(),S)[ie+4>>>2>>>0];Ke==4294967295&&Yf==4294967295||(R[ve]=4294967296*(l(),S)[ie+4>>>2>>>0]+(l(),S)[ie>>>2>>>0])};var k=L,K=fe,R={};L("maxTextureDimension1D",4),L("maxTextureDimension2D",8),L("maxTextureDimension3D",12),L("maxTextureArrayLayers",16),L("maxBindGroups",20),L("maxBindGroupsPlusVertexBuffers",24),L("maxDynamicUniformBuffersPerPipelineLayout",32),L("maxDynamicStorageBuffersPerPipelineLayout",36),L("maxSampledTexturesPerShaderStage",40),L("maxSamplersPerShaderStage",44),L("maxStorageBuffersPerShaderStage",48),L("maxStorageTexturesPerShaderStage",52),L("maxUniformBuffersPerShaderStage",56),L("minUniformBufferOffsetAlignment",80),L("minStorageBufferOffsetAlignment",84),fe("maxUniformBufferBindingSize",64),fe("maxStorageBufferBindingSize",72),L("maxVertexBuffers",88),fe("maxBufferSize",96),L("maxVertexAttributes",104),L("maxVertexBufferArrayStride",108),L("maxInterStageShaderVariables",112),L("maxColorAttachments",116),L("maxColorAttachmentBytesPerSample",120),L("maxComputeWorkgroupStorageSize",124),L("maxComputeInvocationsPerWorkgroup",128),L("maxComputeWorkgroupSizeX",132),L("maxComputeWorkgroupSizeY",136),L("maxComputeWorkgroupSizeZ",140),L("maxComputeWorkgroupsPerDimension",144),L("maxImmediateSize",148,!0),h.requiredLimits=R}(b=(l(),S)[c+24>>>2>>>0])&&(b={label:We(b+4)},h.defaultQueue=b),h.label=We(c+4)}te+=1,vt(t,e.requestDevice(h).then(L=>{--te,pe(a,L.queue),pe(s,L),n&&(te+=1,vt(n,L.lost.then(fe=>{--te,L.onuncapturederror=()=>{};var ve=P(),ie=Re(fe.message);kr(n,gu[fe.reason],ie),D(ve)}))),L.onuncapturederror=fe=>{var ve=5;fe.error instanceof GPUValidationError?ve=2:fe.error instanceof GPUOutOfMemoryError?ve=3:fe.error instanceof GPUInternalError&&(ve=4);var ie=P();fe=Re(fe.error.message),Mo(s,ve,fe),D(ie)},Gr(t,1,s,0)},L=>{--te;var fe=P();L=Re(L.message),Gr(t,3,s,L),n&&kr(n,4,L),D(fe)}))}function vu(e){var t=O(e>>>=0),n=Me[e];if(n){for(var s=0;s<n.length;++s)n[s]();delete Me[e]}t.destroy()}var mt=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";mt.ld||(mt.ld={}),mt.ld[e]||(mt.ld[e]=1,V(e))};function Eu(e,t,n){t>>>=0,n>>>=0;var s=O(e>>>=0);n===0&&mt(),n==4294967295&&(n=void 0);try{var a=s.getMappedRange(t,n)}catch{return 0}var c=Vr(16,a.byteLength);return(l(),J).set(new Uint8Array(a),c>>>0),Me[e].push(()=>Te(c)),c}function Su(e,t,n){t>>>=0,n>>>=0;var s=O(e>>>=0);n===0&&mt(),n==4294967295&&(n=void 0);try{var a=s.getMappedRange(t,n)}catch{return 0}var c=Vr(16,a.byteLength);return(l(),J).fill(0,c,a.byteLength),Me[e].push(()=>{new Uint8Array(a).set((l(),J).subarray(c>>>0,c+a.byteLength>>>0)),Te(c)}),c}function Au(e,t,n,s,a){e>>>=0,t=be(t),n=be(n),a>>>=0;var c=O(e);Me[e]=[],a==4294967295&&(a=void 0),te+=1,vt(t,c.mapAsync(n,s>>>0,a).then(()=>{--te,Nr(t,1,0)},h=>{--te,P();var b=Re(h.message);Nr(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,b),delete Me[e]}))}function xu(e){var t=O(e>>>=0),n=Me[e];if(n){for(var s=0;s<n.length;++s)n[s]();delete Me[e],t.unmap()}}function Iu(e){delete Ur[e>>>0]}function Lu(e,t,n){e>>>=0,t>>>=0,n>>>=0;var s=!!(l(),S)[t+32>>>2>>>0];t={label:We(t+4),usage:(l(),S)[t+16>>>2>>>0],size:4294967296*(l(),S)[t+28>>>2>>>0]+(l(),S)[t+24>>>2>>>0],mappedAtCreation:s},e=O(e);try{var a=e.createBuffer(t)}catch{return!1}return pe(n,a),s&&(Me[n]=[]),!0}function Ou(e,t,n){e>>>=0,t>>>=0,n>>>=0;var s=(l(),S)[t>>>2>>>0],a=(l(),S)[s+4>>>2>>>0];t={label:We(t+4),code:""},a===2&&(t.code=so(s+8)),pe(n,O(e).createShaderModule(t))}var Bu=e=>{(e=O(e)).onuncapturederror=null,e.destroy()};function Mu(e,t){t=be(t),e=O(e>>>0),te+=1,vt(t,e.popErrorScope().then(n=>{--te;var s=5;n?n instanceof GPUValidationError?s=2:n instanceof GPUOutOfMemoryError?s=3:n instanceof GPUInternalError&&(s=4):s=1;var a=P();n=n?Re(n.message):0,Fr(t,1,s,n),D(a)},n=>{--te;var s=P();n=Re(n.message),Fr(t,1,5,n),D(s)}))}function Uu(e,t,n,s){if(t=be(t),s>>>=0,n>>>=0){var a=(l(),S)[n+4>>>2>>>0];a={featureLevel:yu[a],powerPreference:bu[(l(),S)[n+8>>>2>>>0]],forceFallbackAdapter:!!(l(),S)[n+12>>>2>>>0]},(n=(l(),S)[n>>>2>>>0])!==0&&(l(),a.Qe=!!(l(),S)[n+8>>>2>>>0])}"gpu"in navigator?(te+=1,vt(t,navigator.gpu.requestAdapter(a).then(c=>{if(--te,c)pe(s,c),Et(t,1,s,0);else{c=P();var h=Re("WebGPU not available on this browser (requestAdapter returned null)");Et(t,3,s,h),D(c)}},c=>{--te;var h=P();c=Re(c.message),Et(t,4,s,c),D(h)}))):(n=P(),a=Re("WebGPU not available on this browser (navigator.gpu is not available)"),Et(t,3,s,a),D(n))}function Cu(e,t,n){return e>>>=0,t>>>=0,n>>>=0,Xn(async()=>{var s=[];if(n){var a=(l(),I)[n>>>2>>>0];s.length=t+1,s[t]=new Promise(b=>setTimeout(b,a,0))}else s.length=t;for(var c=0;c<t;++c){var h=4294967296*(l(),S)[e+8*c+4>>>2>>>0]+(l(),S)[e+8*c>>>2>>>0];if(!(h in Ft))return h;s[c]=Ft[h]}return s=await Promise.race(s),delete Ft[s],s})}var Dr,Pr={},uo=()=>{if(!Dr){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.language||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Pr)Pr[e]===void 0?delete t[e]:t[e]=Pr[e];var n=[];for(e in t)n.push(`${e}=${t[e]}`);Dr=n}return Dr};function fo(e,t){if(u)return Q(19,1,e,t);e>>>=0,t>>>=0;var n,s=0,a=0;for(n of uo()){var c=t+s;(l(),S)[e+a>>>2>>>0]=c,s+=Pe(n,c,1/0)+1,a+=4}return 0}function co(e,t){if(u)return Q(20,1,e,t);e>>>=0,t>>>=0;var n=uo();for(var s of((l(),S)[e>>>2>>>0]=n.length,e=0,n))e+=_e(s)+1;return(l(),S)[t>>>2>>>0]=e,0}function lo(e){return u?Q(21,1,e):52}function po(e,t,n,s){return u?Q(22,1,e,t,n,s):52}function mo(e,t,n,s){return u?Q(23,1,e,t,n,s):70}var Du=[null,[],[]];function ho(e,t,n,s){if(u)return Q(24,1,e,t,n,s);t>>>=0,n>>>=0,s>>>=0;for(var a=0,c=0;c<n;c++){var h=(l(),S)[t>>>2>>>0],b=(l(),S)[t+4>>>2>>>0];t+=8;for(var E=0;E<b;E++){var A=e,R=(l(),J)[h+E>>>0],k=Du[A];R===0||R===10?((A===1?H:V)(Bn(k)),k.length=0):k.push(R)}a+=b}return(l(),S)[s>>>2>>>0]=a,0}function Pu(e){return e>>>0}function _u(e,t){return io(O(e>>>0).limits,t>>>0),1}function Ru(e,t){return O(e>>>0).features.has(Cr[t])}function Wu(e){return BigInt(O(e>>>0).size)}function ku(e){return BigInt(O(e>>>0).usage)}function Nu(e,t){if(e>>>=0,t>>>=0){var n=We(t+4);n={label:n,timestampWrites:t=(t=(l(),S)[t+12>>>2>>>0])!==0?{querySet:O((l(),S)[t+4>>>2>>>0]),beginningOfPassWriteIndex:(l(),S)[t+8>>>2>>>0],endOfPassWriteIndex:(l(),S)[t+12>>>2>>>0]}:void 0}}return e=O(e),t=Ao(0),pe(t,e.beginComputePass(n)),t}function Fu(e,t,n,s,a,c){n=be(n),a=be(a),c=be(c),O(e>>>0).copyBufferToBuffer(O(t>>>0),n,O(s>>>0),a,c)}function Gu(e){e=O(e>>>0);var t=Eo(0);return pe(t,e.finish()),t}function $u(e,t,n,s,a,c){c=be(c),O(e>>>0).resolveQuerySet(O(t>>>0),n,s,O(a>>>0),c)}function zu(e,t,n,s){O(e>>>0).dispatchWorkgroups(t,n,s)}function Vu(e){O(e>>>0).end()}function Hu(e,t,n,s,a){s>>>=0,a>>>=0,e=O(e>>>0),n=O(n>>>0),s==0?e.setBindGroup(t,n):e.setBindGroup(t,n,(l(),S),a>>>2,s)}function ju(e,t){O(e>>>0).setPipeline(O(t>>>0))}function Yu(e,t,n){O(e>>>0).Pe(O(t>>>0),n)}function qu(e,t){e=O(e>>>0);var n=vo(0);return pe(n,e.getBindGroupLayout(t)),n}function Xu(e,t){e>>>=0;var n=We(4+(t>>>=0)),s=O((l(),S)[t+12>>>2>>>0]),a=(l(),S)[t+16>>>2>>>0];t=(l(),S)[t+20>>>2>>>0];for(var c=[],h=0;h<a;++h){var b=c,E=b.push,A=t+40*h,R=(l(),S)[A+8>>>2>>>0],k=(l(),S)[A+32>>>2>>>0],K=(l(),S)[A+36>>>2>>>0],L=(l(),S)[A+4>>>2>>>0];R?(k=A+24,(k=(l(),S)[k>>>2>>>0]+4294967296*(l(),I)[k+4>>>2>>>0])==-1&&(k=void 0),A={binding:L,resource:{buffer:O(R),offset:4294967296*(l(),S)[A+4+16>>>2>>>0]+(l(),S)[A+16>>>2>>>0],size:k}}):A=k?{binding:L,resource:O(k)}:{binding:L,resource:O(K)},E.call(b,A)}return n={label:n,layout:s,entries:c},e=O(e),s=To(0),pe(s,e.createBindGroup(n)),s}function Ju(e,t){var n;return e>>>=0,(t>>>=0)&&(n={label:We(t+4)}),e=O(e),t=So(0),pe(t,e.createCommandEncoder(n)),t}function Zu(e,t){e>>>=0;var n=t>>>0;t=We(n+4);var s=(s=(l(),S)[n+12>>>2>>>0])?O(s):"auto";if(n+=16){var a=O((l(),S)[n+4>>>2>>>0]),c=(l(),S)[n+16>>>2>>>0],h=(l(),S)[n+20>>>2>>>0];if(c){for(var b={},E=0;E<c;++E){var A=h+24*E;b[so(A+4)]=(l(),ae)[A+16>>>3>>>0]}c=b}else c=void 0;n={module:a,constants:c,entryPoint:We(n+8)}}else n=void 0;return t={label:t,layout:s,compute:n},e=O(e),s=xo(0),pe(s,e.createComputePipeline(t)),s}function Ku(e,t){e>>>=0,t>>>=0,t={type:wu[(l(),S)[t+12>>>2>>>0]],count:(l(),S)[t+16>>>2>>>0]},e=O(e);var n=Io(0);return pe(n,e.createQuerySet(t)),n}function Qu(e,t){e=O(e>>>0).adapterInfo,t>>>=0,(l(),I)[t+52>>>2>>>0]=e.subgroupMinSize,(l(),I)[t+56>>>2>>>0]=e.subgroupMaxSize;var n=oo(e.vendor+e.architecture+e.device+e.description),s=_e(e.vendor);return Gt(t+4,n,s),n+=s,s=_e(e.architecture),Gt(t+12,n,s),n+=s,s=_e(e.device),Gt(t+20,n,s),Gt(t+28,n+s,_e(e.description)),(l(),I)[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,(l(),I)[t+40>>>2>>>0]=e,(l(),I)[t+44>>>2>>>0]=0,(l(),I)[t+48>>>2>>>0]=0,1}var ef={"core-features-and-limits":1,"depth-clip-control":2,"depth32float-stencil8":3,"texture-compression-bc":4,"texture-compression-bc-sliced-3d":5,"texture-compression-etc2":6,"texture-compression-astc":7,"texture-compression-astc-sliced-3d":8,"timestamp-query":9,"indirect-first-instance":10,"shader-f16":11,"rg11b10ufloat-renderable":12,"bgra8unorm-storage":13,"float32-filterable":14,"float32-blendable":15,"clip-distances":16,"dual-source-blending":17,subgroups:18,"texture-formats-tier1":19,"texture-formats-tier2":20,"primitive-index":21,"chromium-experimental-unorm16-texture-formats":327692,"chromium-experimental-snorm16-texture-formats":327693,"chromium-experimental-multi-draw-indirect":327732};function tf(e,t){t>>>=0,e=O(e>>>0);var n=ht(4*e.features.size),s=0,a=0;e.features.forEach(c=>{0<=(c=ef[c])&&((l(),I)[n+s>>>2>>>0]=c,s+=4,a++)}),(l(),S)[t+4>>>2>>>0]=n,(l(),S)[t>>>2>>>0]=a}function rf(e,t){return io(O(e>>>0).limits,t>>>0),1}function nf(e,t){return O(e>>>0).features.has(Cr[t])}function of(e,t){O(e>>>0).pushErrorScope(hu[t])}function af(e,t,n){t>>>=0,n>>>=0,e=O(e>>>0),t=Array.from((l(),I).subarray(n>>>2>>>0,n+4*t>>>2>>>0),s=>O(s)),e.submit(t)}function sf(e,t,n,s,a){n=be(n),s>>>=0,a>>>=0,e=O(e>>>0),t=O(t>>>0),s=(l(),J).subarray(s>>>0,s+a>>>0),e.writeBuffer(t,n,s,0,a)}u||function(){for(var e=r.numThreads-1;e--;)En();Ce.push(()=>{qe++,function(t){u?t():Promise.all(Ne.map(vn)).then(t)}(()=>Ae())})}(),u||(Se=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),ke()),r.wasmBinary&&(T=r.wasmBinary),r.stackSave=()=>P(),r.stackRestore=e=>D(e),r.stackAlloc=e=>$t(e),r.setValue=function(e,t,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":(l(),Y)[e>>>0]=t;break;case"i16":(l(),Ue)[e>>>1>>>0]=t;break;case"i32":(l(),I)[e>>>2>>>0]=t;break;case"i64":(l(),$)[e>>>3>>>0]=BigInt(t);break;case"float":(l(),q)[e>>>2>>>0]=t;break;case"double":(l(),ae)[e>>>3>>>0]=t;break;case"*":(l(),S)[e>>>2>>>0]=t;break;default:de(`invalid type for setValue: ${n}`)}},r.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return(l(),Y)[e>>>0];case"i16":return(l(),Ue)[e>>>1>>>0];case"i32":return(l(),I)[e>>>2>>>0];case"i64":return(l(),$)[e>>>3>>>0];case"float":return(l(),q)[e>>>2>>>0];case"double":return(l(),ae)[e>>>3>>>0];case"*":return(l(),S)[e>>>2>>>0];default:de(`invalid type for getValue: ${t}`)}},r.UTF8ToString=dt,r.stringToUTF8=Pe,r.lengthBytesUTF8=_e;var uf=[br,bn,xn,Mn,Un,Cn,Dn,Pn,_n,Rn,Wn,kn,Nn,Fn,Gn,$n,eo,to,ro,fo,co,lo,po,mo,ho],_r={1064124:(e,t,n,s,a)=>{if(r===void 0||!r.Zc)return 1;if((e=dt(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=r.Zc.get(e)))return 2;if(t=Number(t>>>0),n=Number(n>>>0),s=Number(s>>>0),t+n>e.byteLength)return 3;try{let c=e.subarray(t,t+n);switch(a){case 0:(l(),J).set(c,s>>>0);break;case 1:r.ge?r.ge(s,c):r.Ke(s,c);break;default:return 4}return 0}catch{return 4}},1064948:(e,t,n)=>{r.ie(e,(l(),J).subarray(t>>>0,t+n>>>0))},1065012:()=>r.Ie(),1065054:e=>{r.he(e)},1065091:()=>typeof wasmOffsetConverter<"u"};function ff(){return typeof wasmOffsetConverter<"u"}var yo,bo,Rr,Wr,Te,ht,wo,go,To,vo,Eo,So,Ao,xo,Io,Lo,Oo,Bo,kr,Nr,Fr,Et,Gr,Mo,$r,Uo,Co,Do,zr,Po,_o,Vr,N,St,Ro,D,$t,P,Wo,ko,No,Fo,Go,Hr,$o,zo,Vo,Ho,jo,Yo,qo,Xo,Jo,Zo,Ko,Qo,ea,ta,ra,na,oa,aa,sa,ia,ua,fa,ca,la,da,pa,ma,ha,ya,ba,wa,ga,Ta,va,Ea,Sa,Aa,xa,Ia,Ge=await async function(){function e(s,a){var c=Ge=s.exports;s={};for(let[h,b]of Object.entries(c))typeof b=="function"?(c=Mi(b),s[h]=c):s[h]=b;return Ge=s,Ge=function(){var h=Ge,b=A=>R=>A(R)>>>0,E=A=>()=>A()>>>0;return(h=Object.assign({},h)).dc=b(h.dc),h.Gc=E(h.Gc),h.Ic=b(h.Ic),h.td=(A=>(R,k)=>A(R,k)>>>0)(h.td),h.yd=b(h.yd),h.zd=E(h.zd),h.Dd=b(h.Dd),h}(),wn.push(Ge.kd),x=a,yo=(a=Ge).dc,bo=a.ec,r._OrtInit=a.fc,r._OrtGetLastError=a.gc,r._OrtCreateSessionOptions=a.hc,r._OrtAppendExecutionProvider=a.ic,r._OrtAddFreeDimensionOverride=a.jc,r._OrtAddSessionConfigEntry=a.kc,r._OrtReleaseSessionOptions=a.lc,r._OrtCreateSession=a.mc,r._OrtReleaseSession=a.nc,r._OrtGetInputOutputCount=a.oc,r._OrtGetInputOutputMetadata=a.pc,r._OrtFree=a.qc,r._OrtCreateTensor=a.rc,r._OrtGetTensorData=a.sc,r._OrtReleaseTensor=a.tc,r._OrtCreateRunOptions=a.uc,r._OrtAddRunConfigEntry=a.vc,r._OrtReleaseRunOptions=a.wc,r._OrtCreateBinding=a.xc,r._OrtBindInput=a.yc,r._OrtBindOutput=a.zc,r._OrtClearBoundOutputs=a.Ac,r._OrtReleaseBinding=a.Bc,r._OrtRunWithBinding=a.Cc,r._OrtRun=a.Dc,r._OrtEndProfiling=a.Ec,r._OrtGetWebGpuDevice=Rr=a.Fc,Wr=a.Gc,r._free=Te=a.Hc,r._malloc=ht=a.Ic,r._wgpuBufferRelease=wo=a.Jc,r._wgpuCreateInstance=go=a.Kc,To=a.Lc,vo=a.Mc,Eo=a.Nc,So=a.Oc,Ao=a.Pc,xo=a.Qc,Io=a.Sc,Lo=a.ad,Oo=a.bd,Bo=a.cd,kr=a.ed,Nr=a.fd,Fr=a.gd,Et=a.hd,Gr=a.id,Mo=a.jd,$r=a.md,Uo=a.nd,Co=a.od,Do=a.pd,zr=a.qd,Po=a.rd,_o=a.sd,Vr=a.td,N=a.ud,St=a.vd,Ro=a.wd,D=a.xd,$t=a.yd,P=a.zd,Wo=a.Ad,ko=a.Bd,No=a.Cd,Fo=a.Dd,Go=a.Ed,Hr=a.Fd,$o=a.Gd,zo=a.Hd,Vo=a.Id,Ho=a.Jd,jo=a.Kd,Yo=a.Ld,qo=a.Md,Xo=a.Nd,Jo=a.Od,Zo=a.Pd,Ko=a.Qd,Qo=a.Rd,ea=a.Sd,ta=a.Td,ra=a.Vd,na=a.Wd,oa=a.Xd,aa=a.Yd,sa=a.Zd,ia=a.$d,ua=a.ae,fa=a.be,ca=a.ce,la=a.me,da=a.re,pa=a.ue,ma=a.ve,ha=a.we,ya=a.xe,ba=a.ye,wa=a.ze,ga=a.Ae,Ta=a.Be,va=a.Ce,Ea=a.De,Sa=a.cf,Aa=a.df,xa=a.ef,Ia=a.ff,Ae(),Ge}qe++;var t,n=oe();return r.instantiateWasm?new Promise(s=>{r.instantiateWasm(n,(a,c)=>{s(e(a,c))})}):u?new Promise(s=>{U=a=>{var c=new WebAssembly.Instance(a,oe());s(e(c,a))}}):(ft??=r.locateFile?r.locateFile?r.locateFile("ort-wasm-simd-threaded.asyncify.wasm",v):v+"ort-wasm-simd-threaded.asyncify.wasm":new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href,t=await async function(s){var a=ft;if(!T&&typeof WebAssembly.instantiateStreaming=="function"&&!ne(a))try{var c=fetch(a,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(c,s)}catch(h){V(`wasm streaming compile failed: ${h}`),V("falling back to ArrayBuffer instantiation")}return async function(h,b){try{var E=await async function(A){if(!T)try{var R=await m(A);return new Uint8Array(R)}catch{}if(A==ft&&T)A=new Uint8Array(T);else{if(!y)throw"both async and sync fetching of the wasm failed";A=y(A)}return A}(h);return await WebAssembly.instantiate(E,b)}catch(A){V(`failed to asynchronously prepare wasm: ${A}`),de(A)}}(a,s)}(n),e(t.instance,t.module))}();function cf(e,t,n,s){var a=P();try{return Yo(e,t,n,s)}catch(c){if(D(a),c!==c+0)throw c;N(1,0)}}function lf(e,t,n){var s=P();try{return jo(e,t,n)}catch(a){if(D(s),a!==a+0)throw a;N(1,0)}}function df(e,t,n){var s=P();try{Go(e,t,n)}catch(a){if(D(s),a!==a+0)throw a;N(1,0)}}function pf(e,t){var n=P();try{return Hr(e,t)}catch(s){if(D(n),s!==s+0)throw s;N(1,0)}}function mf(e){var t=P();try{$o(e)}catch(n){if(D(t),n!==n+0)throw n;N(1,0)}}function hf(e,t,n,s,a,c,h){var b=P();try{return Ho(e,t,n,s,a,c,h)}catch(E){if(D(b),E!==E+0)throw E;N(1,0)}}function yf(e,t){var n=P();try{Jo(e,t)}catch(s){if(D(n),s!==s+0)throw s;N(1,0)}}function bf(e,t,n,s){var a=P();try{Xo(e,t,n,s)}catch(c){if(D(a),c!==c+0)throw c;N(1,0)}}function wf(e,t,n,s,a,c,h){var b=P();try{Ko(e,t,n,s,a,c,h)}catch(E){if(D(b),E!==E+0)throw E;N(1,0)}}function gf(e,t,n,s,a,c,h){var b=P();try{Qo(e,t,n,s,a,c,h)}catch(E){if(D(b),E!==E+0)throw E;N(1,0)}}function Tf(e,t,n,s,a,c,h,b){var E=P();try{ia(e,t,n,s,a,c,h,b)}catch(A){if(D(E),A!==A+0)throw A;N(1,0)}}function vf(e,t,n,s,a,c){var h=P();try{zo(e,t,n,s,a,c)}catch(b){if(D(h),b!==b+0)throw b;N(1,0)}}function Ef(e,t,n,s,a){var c=P();try{Vo(e,t,n,s,a)}catch(h){if(D(c),h!==h+0)throw h;N(1,0)}}function Sf(e,t,n,s,a){var c=P();try{return Zo(e,t,n,s,a)}catch(h){if(D(c),h!==h+0)throw h;N(1,0)}}function Af(e,t,n,s,a,c,h,b){var E=P();try{ua(e,t,n,s,a,c,h,b)}catch(A){if(D(E),A!==A+0)throw A;N(1,0)}}function xf(e,t,n,s,a,c,h,b,E,A,R,k){var K=P();try{ea(e,t,n,s,a,c,h,b,E,A,R,k)}catch(L){if(D(K),L!==L+0)throw L;N(1,0)}}function If(e,t,n,s,a,c){var h=P();try{return fa(e,t,n,s,a,c)}catch(b){if(D(h),b!==b+0)throw b;N(1,0)}}function Lf(e,t,n){var s=P();try{return na(e,t,n)}catch(a){if(D(s),a!==a+0)throw a;return N(1,0),0n}}function Of(e,t,n,s,a,c,h,b,E){var A=P();try{qo(e,t,n,s,a,c,h,b,E)}catch(R){if(D(A),R!==R+0)throw R;N(1,0)}}function Bf(e){var t=P();try{return aa(e)}catch(n){if(D(t),n!==n+0)throw n;N(1,0)}}function Mf(e,t){var n=P();try{return Ea(e,t)}catch(s){if(D(n),s!==s+0)throw s;return N(1,0),0n}}function Uf(e){var t=P();try{return ta(e)}catch(n){if(D(t),n!==n+0)throw n;return N(1,0),0n}}function Cf(e,t,n,s,a,c){var h=P();try{return pa(e,t,n,s,a,c)}catch(b){if(D(h),b!==b+0)throw b;N(1,0)}}function Df(e,t,n,s,a,c){var h=P();try{return ma(e,t,n,s,a,c)}catch(b){if(D(h),b!==b+0)throw b;N(1,0)}}function Pf(e,t,n){var s=P();try{return ha(e,t,n)}catch(a){if(D(s),a!==a+0)throw a;N(1,0)}}function _f(e,t,n,s,a,c,h,b){var E=P();try{return ca(e,t,n,s,a,c,h,b)}catch(A){if(D(E),A!==A+0)throw A;N(1,0)}}function Rf(e,t,n,s,a){var c=P();try{return ya(e,t,n,s,a)}catch(h){if(D(c),h!==h+0)throw h;return N(1,0),0n}}function Wf(e,t,n,s){var a=P();try{return ba(e,t,n,s)}catch(c){if(D(a),c!==c+0)throw c;N(1,0)}}function kf(e,t,n,s){var a=P();try{return wa(e,t,n,s)}catch(c){if(D(a),c!==c+0)throw c;N(1,0)}}function Nf(e,t,n,s,a,c,h,b,E,A,R,k){var K=P();try{return ga(e,t,n,s,a,c,h,b,E,A,R,k)}catch(L){if(D(K),L!==L+0)throw L;N(1,0)}}function Ff(e,t,n,s,a,c,h,b,E,A,R){var k=P();try{la(e,t,n,s,a,c,h,b,E,A,R)}catch(K){if(D(k),K!==K+0)throw K;N(1,0)}}function Gf(e,t,n,s,a,c,h,b,E,A,R,k,K,L,fe,ve){var ie=P();try{da(e,t,n,s,a,c,h,b,E,A,R,k,K,L,fe,ve)}catch(Ke){if(D(ie),Ke!==Ke+0)throw Ke;N(1,0)}}function $f(e,t,n,s){var a=P();try{return Ta(e,t,n,s)}catch(c){if(D(a),c!==c+0)throw c;N(1,0)}}function zf(e,t,n,s,a){var c=P();try{return va(e,t,n,s,a)}catch(h){if(D(c),h!==h+0)throw h;N(1,0)}}function Vf(e,t,n){var s=P();try{return ra(e,t,n)}catch(a){if(D(s),a!==a+0)throw a;N(1,0)}}function Hf(e,t,n){var s=P();try{return oa(e,t,n)}catch(a){if(D(s),a!==a+0)throw a;N(1,0)}}function jf(e,t,n,s){var a=P();try{sa(e,t,n,s)}catch(c){if(D(a),c!==c+0)throw c;N(1,0)}}return function e(){if(0<qe)he=e;else if(u)W?.(r),Ye();else{for(;0<Ce.length;)Ce.shift()(r);0<qe?he=e:(r.calledRun=!0,re||(Ye(),W?.(r)))}}(),r.PTR_SIZE=4,r.webgpuInit=e=>{let t=new WeakMap,n,s,a=1;r.webgpuRegisterDevice=b=>{if(s!==void 0)throw Error("another WebGPU EP inference session is being created.");if(b){var E=t.get(b);if(!E){let A=((R,k=0)=>{var K=Bo(k);return k=Oo(k,K),pe(K,R.queue),pe(k,R),k})(b,E=go(0));E=[a++,E,A],t.set(b,E)}return n=b,s=E[0],E}n=void 0,s=0};let c=new Map;r.webgpuOnCreateSession=b=>{if(s!==void 0){var E=s;if(s=void 0,b){let A=Rr(E);c.set(b,A),E===0&&e(n??O(A))}n=void 0}},r.webgpuOnReleaseSession=b=>{c.delete(b)};let h=Symbol("gpuBufferMetadata");r.webgpuRegisterBuffer=(b,E,A)=>{if(A)return b[h]=[A,NaN],A;if(A=b[h])return A[1]++,A[0];if((E=c.get(E))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return E=((R,k=0)=>(R.mapState!="pending"||de(),k=Lo(k,R.mapState=="mapped"?3:1),pe(k,R),R.mapState=="mapped"&&(Me[k]=[]),k))(b,E),b[h]=[E,1],E},r.webgpuUnregisterBuffer=b=>{let E=b[h];if(!E)throw Error("Buffer is not registered");E[1]--,E[1]===0&&(wo(E[0]),delete b[h])},r.webgpuGetBuffer=b=>O(b),r.webgpuCreateDownloader=(b,E,A)=>{if((A=c.get(A))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let R=O(A),k=16*Math.ceil(Number(E)/16);return async()=>{let K=R.createBuffer({size:k,usage:9});try{let L=R.createCommandEncoder();return L.copyBufferToBuffer(b,0,K,0,k),R.queue.submit([L.finish()]),await K.mapAsync(GPUMapMode.READ),K.getMappedRange().slice(0,E)}finally{K.destroy()}}},r.ge=(b,E)=>{var A=E.buffer;let R=E.byteOffset,k=E.byteLength;if(E=16*Math.ceil(Number(k)/16),b=O(b),!n){var K=Rr(s);n=O(K)}let L=(K=n.createBuffer({mappedAtCreation:!0,size:E,usage:6})).getMappedRange();new Uint8Array(L).set(new Uint8Array(A,R,k)),K.unmap(),(A=n.createCommandEncoder()).copyBufferToBuffer(K,0,b,0,E),n.queue.submit([A.finish()]),K.destroy()}},r.webnnInit=e=>{let t=e[0];[r.Ie,r.he,r.webnnEnsureTensor,r.ie,r.webnnDownloadTensor,r.He,r.webnnEnableTraceEvent]=e.slice(1),r.webnnReleaseTensorId=r.he,r.webnnUploadTensor=r.ie,r.webnnRegisterMLContext=r.He,r.webnnOnRunStart=n=>t.onRunStart(n),r.webnnOnRunEnd=t.onRunEnd.bind(t),r.webnnOnReleaseSession=n=>{t.onReleaseSession(n)},r.webnnCreateMLTensorDownloader=(n,s)=>t.createMLTensorDownloader(n,s),r.webnnRegisterMLTensor=(n,s,a,c)=>t.registerMLTensor(n,s,a,c),r.webnnCreateMLContext=n=>t.createMLContext(n),r.webnnRegisterMLConstant=(n,s,a,c,h,b)=>t.registerMLConstant(n,s,a,c,h,r.Zc,b),r.webnnRegisterGraphInput=t.registerGraphInput.bind(t),r.webnnIsGraphInput=t.isGraphInput.bind(t),r.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),r.webnnIsGraphOutput=t.isGraphOutput.bind(t),r.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),r.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},yr?r:new Promise((e,t)=>{W=e,j=t})}var tc,rc,fs=F(()=>{"use strict";tc=is,rc=globalThis.self?.name?.startsWith("em-pthread");rc&&is()});var ds,rn,nc,we,ps,tn,oc,ac,ms,sc,cs,hs,ls,ys,qt=F(()=>{"use strict";Yt();ds=typeof location>"u"?void 0:location.origin,rn=import.meta.url>"file:"&&import.meta.url<"file;",nc=()=>{if(!!1){if(rn){let o=URL;return new URL(new o("ort.webgpu.bundle.min.mjs",import.meta.url).href,ds).href}return import.meta.url}},we=nc(),ps=()=>{if(we&&!we.startsWith("blob:"))return we.substring(0,we.lastIndexOf("/")+1)},tn=(o,r)=>{try{let i=r??we;return(i?new URL(o,i):new URL(o)).origin===ds}catch{return!1}},oc=(o,r)=>{let i=r??we;try{return(i?new URL(o,i):new URL(o)).href}catch{return}},ac=(o,r)=>`${r??"./"}${o}`,ms=async o=>{let i=await(await fetch(o,{credentials:"same-origin"})).blob();return URL.createObjectURL(i)},sc=async o=>(await import(/*webpackIgnore:true*/o)).default,cs=(ss(),zt(as)).default,hs=async()=>{if(!we)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(tn(we))return[void 0,cs()];let o=await ms(we);return[o,cs(o)]},ls=(fs(),zt(us)).default,ys=async(o,r,i,f)=>{let u=ls&&!(o||r);if(u)if(we)u=tn(we);else if(f&&!i)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,ls];{let d="ort-wasm-simd-threaded.asyncify.mjs",p=o??oc(d,r),m=!!1&&i&&p&&!tn(p,r),y=m?await ms(p):p??ac(d,r);return[m?y:void 0,await sc(y)]}}});var nn,on,nr,bs,ic,uc,fc,Xt,z,He=F(()=>{"use strict";qt();on=!1,nr=!1,bs=!1,ic=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},uc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},fc=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Xt=async o=>{if(on)return Promise.resolve();if(nr)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(bs)throw new Error("previous call to 'initializeWebAssembly()' failed.");nr=!0;let r=o.initTimeout,i=o.numThreads;if(o.simd!==!1){if(o.simd==="relaxed"){if(!fc())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!uc())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let f=ic();i>1&&!f&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),o.numThreads=i=1);let u=o.wasmPaths,d=typeof u=="string"?u:void 0,p=u?.mjs,m=p?.href??p,y=u?.wasm,w=y?.href??y,g=o.wasmBinary,[v,T]=await ys(m,d,i>1,!!g||!!w),x=!1,M=[];if(r>0&&M.push(new Promise(W=>{setTimeout(()=>{x=!0,W()},r)})),M.push(new Promise((W,j)=>{let U={numThreads:i};if(g)U.wasmBinary=g;else if(w||d)U.locateFile=B=>w??d+B;else if(m&&m.indexOf("blob:")!==0)U.locateFile=B=>new URL(B,m).href;else if(v){let B=ps();B&&(U.locateFile=X=>B+X)}T(U).then(B=>{nr=!1,on=!0,nn=B,W(),v&&URL.revokeObjectURL(v)},B=>{nr=!1,bs=!0,j(B)})})),await Promise.race(M),x)throw new Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},z=()=>{if(on&&nn)return nn;throw new Error("WebAssembly is not initialized yet.")}});var me,Lt,G,or=F(()=>{"use strict";He();me=(o,r)=>{let i=z(),f=i.lengthBytesUTF8(o)+1,u=i._malloc(f);return i.stringToUTF8(o,u,f),r.push(u),u},Lt=(o,r,i,f)=>{if(typeof o=="object"&&o!==null){if(i.has(o))throw new Error("Circular reference in options");i.add(o)}Object.entries(o).forEach(([u,d])=>{let p=r?r+u:u;if(typeof d=="object")Lt(d,p+".",i,f);else if(typeof d=="string"||typeof d=="number")f(p,d.toString());else if(typeof d=="boolean")f(p,d?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof d}`)})},G=o=>{let r=z(),i=r.stackSave();try{let f=r.PTR_SIZE,u=r.stackAlloc(2*f);r._OrtGetLastError(u,u+f);let d=Number(r.getValue(u,f===4?"i32":"i64")),p=r.getValue(u+f,"*"),m=p?r.UTF8ToString(p):"";throw new Error(`${o} ERROR_CODE: ${d}, ERROR_MESSAGE: ${m}`)}finally{r.stackRestore(i)}}});var ws,gs=F(()=>{"use strict";He();or();ws=o=>{let r=z(),i=0,f=[],u=o||{};try{if(o?.logSeverityLevel===void 0)u.logSeverityLevel=2;else if(typeof o.logSeverityLevel!="number"||!Number.isInteger(o.logSeverityLevel)||o.logSeverityLevel<0||o.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${o.logSeverityLevel}`);if(o?.logVerbosityLevel===void 0)u.logVerbosityLevel=0;else if(typeof o.logVerbosityLevel!="number"||!Number.isInteger(o.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${o.logVerbosityLevel}`);o?.terminate===void 0&&(u.terminate=!1);let d=0;return o?.tag!==void 0&&(d=me(o.tag,f)),i=r._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,d),i===0&&G("Can't create run options."),o?.extra!==void 0&&Lt(o.extra,"",new WeakSet,(p,m)=>{let y=me(p,f),w=me(m,f);r._OrtAddRunConfigEntry(i,y,w)!==0&&G(`Can't set a run config entry: ${p} - ${m}.`)}),[i,f]}catch(d){throw i!==0&&r._OrtReleaseRunOptions(i),f.forEach(p=>r._free(p)),d}}});var cc,lc,dc,sn,an,pc,Ts,vs=F(()=>{"use strict";He();or();cc=o=>{switch(o){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${o}`)}},lc=o=>{switch(o){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${o}`)}},dc=o=>{o.extra||(o.extra={}),o.extra.session||(o.extra.session={});let r=o.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),o.executionProviders&&o.executionProviders.some(i=>(typeof i=="string"?i:i.name)==="webgpu")&&(o.enableMemPattern=!1)},sn=(o,r,i,f)=>{let u=me(r,f),d=me(i,f);z()._OrtAddSessionConfigEntry(o,u,d)!==0&&G(`Can't set a session config entry: ${r} - ${i}.`)},an=(o,r,i,f)=>{let u=me(r,f),d=me(i,f);o.push([u,d])},pc=async(o,r,i)=>{for(let f of r){let u=typeof f=="string"?f:f.name,d=[];switch(u){case"webnn":if(u="WEBNN",typeof f!="string"){let v=f?.deviceType;v&&sn(o,"deviceType",v,i)}break;case"webgpu":{u="WebGPU";let g;if(typeof f!="string"){let T=f;if(T.device)if(typeof GPUDevice<"u"&&T.device instanceof GPUDevice)g=T.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let v=z().webgpuRegisterDevice(g);if(v){let[T,x,M]=v;an(d,"deviceId",T.toString(),i),an(d,"webgpuInstance",x.toString(),i),an(d,"webgpuDevice",M.toString(),i)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${u}`)}let p=me(u,i),m=d.length,y=0,w=0;if(m>0){y=z()._malloc(m*z().PTR_SIZE),i.push(y),w=z()._malloc(m*z().PTR_SIZE),i.push(w);for(let g=0;g<m;g++)z().setValue(y+g*z().PTR_SIZE,d[g][0],"*"),z().setValue(w+g*z().PTR_SIZE,d[g][1],"*")}await z()._OrtAppendExecutionProvider(o,p,y,w,m)!==0&&G(`Can't append execution provider: ${u}.`)}},Ts=async o=>{let r=z(),i=0,f=[],u=o||{};dc(u);try{let d=cc(u.graphOptimizationLevel??"all"),p=lc(u.executionMode??"sequential"),m=typeof u.logId=="string"?me(u.logId,f):0,y=u.logSeverityLevel??2;if(!Number.isInteger(y)||y<0||y>4)throw new Error(`log severity level is not valid: ${y}`);let w=u.logVerbosityLevel??0;if(!Number.isInteger(w)||w<0||w>4)throw new Error(`log verbosity level is not valid: ${w}`);let g=typeof u.optimizedModelFilePath=="string"?me(u.optimizedModelFilePath,f):0;if(i=r._OrtCreateSessionOptions(d,!!u.enableCpuMemArena,!!u.enableMemPattern,p,!!u.enableProfiling,0,m,y,w,g),i===0&&G("Can't create session options."),u.executionProviders&&await pc(i,u.executionProviders,f),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);sn(i,"enableGraphCapture",u.enableGraphCapture.toString(),f)}if(u.freeDimensionOverrides)for(let[v,T]of Object.entries(u.freeDimensionOverrides)){if(typeof v!="string")throw new Error(`free dimension override name must be a string: ${v}`);if(typeof T!="number"||!Number.isInteger(T)||T<0)throw new Error(`free dimension override value must be a non-negative integer: ${T}`);let x=me(v,f);r._OrtAddFreeDimensionOverride(i,x,T)!==0&&G(`Can't set a free dimension override: ${v} - ${T}.`)}return u.extra!==void 0&&Lt(u.extra,"",new WeakSet,(v,T)=>{sn(i,v,T,f)}),[i,f]}catch(d){throw i!==0&&r._OrtReleaseSessionOptions(i)!==0&&G("Can't release session options."),f.forEach(p=>r._free(p)),d}}});var je,ar,yt,at,Ot,sr,ir,un,st=F(()=>{"use strict";je=o=>{switch(o){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${o}`)}},ar=o=>{switch(o){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${o}`)}},yt=(o,r)=>{let i=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][o],f=typeof r=="number"?r:r.reduce((u,d)=>u*d,1);return i>0?Math.ceil(f*i):void 0},at=o=>{switch(o){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${o}`)}},Ot=o=>{switch(o){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${o}`)}},sr=o=>o==="float32"||o==="float16"||o==="int32"||o==="int64"||o==="uint32"||o==="uint8"||o==="bool"||o==="uint4"||o==="int4",ir=o=>o==="float32"||o==="float16"||o==="int32"||o==="int64"||o==="uint32"||o==="uint64"||o==="int8"||o==="uint8"||o==="bool"||o==="uint4"||o==="int4",un=o=>{switch(o){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${o}`)}}});var Bt,fn=F(()=>{"use strict";Yt();Bt=async o=>{if(typeof o=="string")if(!1)try{let{readFile:r}=Yr("node:fs/promises");return new Uint8Array(await r(o))}catch(r){if(r.code==="ERR_FS_FILE_TOO_LARGE"){let{createReadStream:i}=Yr("node:fs"),f=i(o),u=[];for await(let d of f)u.push(d);return new Uint8Array(Buffer.concat(u))}throw r}else{let r=await fetch(o);if(!r.ok)throw new Error(`failed to load external data file: ${o}`);let i=r.headers.get("Content-Length"),f=i?parseInt(i,10):0;if(f<1073741824)return new Uint8Array(await r.arrayBuffer());{if(!r.body)throw new Error(`failed to load external data file: ${o}, no response body.`);let u=r.body.getReader(),d;try{d=new ArrayBuffer(f)}catch(m){if(m instanceof RangeError){let y=Math.ceil(f/65536);d=new WebAssembly.Memory({initial:y,maximum:y}).buffer}else throw m}let p=0;for(;;){let{done:m,value:y}=await u.read();if(m)break;let w=y.byteLength;new Uint8Array(d,p,w).set(y),p+=w}return new Uint8Array(d,0,f)}}else return o instanceof Blob?new Uint8Array(await o.arrayBuffer()):o instanceof Uint8Array?o:new Uint8Array(o)}});var Es,Ss=F(()=>{"use strict";st();Es=(o,r)=>new(at(r))(o)});var mc,hc,As,xs,Is,yc,le,cn=F(()=>{"use strict";st();mc=["V","I","W","E","F"],hc=(o,r)=>{console.log(`[${mc[o]},${new Date().toISOString()}]${r}`)},Is=(o,r)=>{As=o,xs=r},yc=(o,r)=>{let i=Ot(o),f=Ot(As);i>=f&&hc(i,typeof r=="function"?r():r)},le=(...o)=>{xs&&yc(...o)}});var Os,dn,Bs,bc,Ls,wc,Ms,ur,fr,ln,Us,Cs=F(()=>{"use strict";st();cn();Os=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),dn=(o,r)=>{if(r==="int32")return o;let i=Os.get(r);if(!i)throw new Error(`WebNN backend does not support data type: ${r}`);let f=i/8;if(o.byteLength%f!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${f}.`);let u=o.byteLength/f,d=new(at(r))(o.buffer,o.byteOffset,u);switch(r){case"int64":case"uint64":{let p=new Int32Array(u);for(let m=0;m<u;m++){let y=d[m];if(y>2147483647n||y<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");p[m]=Number(y)}return new Uint8Array(p.buffer)}case"int8":case"uint8":case"uint32":{if(r==="uint32"&&d.some(m=>m>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let p=Int32Array.from(d,Number);return new Uint8Array(p.buffer)}default:throw new Error(`Unsupported data conversion from ${r} to 'int32'`)}},Bs=(o,r)=>{if(r==="int32")return o;if(o.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let i=o.byteLength/4,f=new Int32Array(o.buffer,o.byteOffset,i);switch(r){case"int64":{let u=BigInt64Array.from(f,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(f.some(d=>d<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(f,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(f.some(d=>d<-128||d>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(f,Number);return new Uint8Array(u.buffer)}case"uint8":{if(f.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(f,Number)}case"uint32":{if(f.some(d=>d<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(f,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${r}`)}},bc=1,Ls=()=>bc++,wc=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ms=(o,r)=>{let i=Os.get(o);if(!i)throw new Error(`WebNN backend does not support data type: ${o}`);return r.length>0?Math.ceil(r.reduce((f,u)=>f*u)*i/8):0},ur=class{constructor(r){this.isDataConverted=!1;let{sessionId:i,context:f,tensor:u,dataType:d,shape:p,fallbackDataType:m}=r;this.sessionId=i,this.mlContext=f,this.mlTensor=u,this.dataType=d,this.tensorShape=p,this.fallbackDataType=m}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ms(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(r){this.mlContext.writeTensor(this.mlTensor,r)}async read(r){if(this.fallbackDataType){let i=await this.mlContext.readTensor(this.mlTensor),f=Bs(new Uint8Array(i),this.dataType);if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(f);return}else return f.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(r,i,f){return this.mlContext===r&&this.dataType===i&&this.tensorShape.length===f.length&&this.tensorShape.every((u,d)=>u===f[d])}setIsDataConverted(r){this.isDataConverted=r}},fr=class{constructor(r,i){this.tensorManager=r;this.wrapper=i}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(r,i,f,u){let d=this.tensorManager.getMLContext(r),p=this.tensorManager.getMLOpSupportLimits(r),m;if(!p?.input.dataTypes.includes(i)){if(m=wc.get(i),!m||p?.input.dataTypes.includes(m))throw new Error(`WebNN backend does not support data type: ${i}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${i} to ${m}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(d,i,f))return this.wrapper.tensor;if(u){if(this.wrapper.byteLength!==Ms(i,f))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let y=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(r,i,f,y,!0,!0,m),u&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(r){let i=r;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")i=dn(r,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(r.byteLength===this.wrapper.byteLength){this.wrapper.write(i);return}else le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(i):this.activeUpload=new Uint8Array(i)}async download(r){if(this.activeUpload){let i=this.wrapper?.isDataConverted?Bs(this.activeUpload,this.wrapper?.type):this.activeUpload;if(r){r instanceof ArrayBuffer?new Uint8Array(r).set(i):new Uint8Array(r.buffer,r.byteOffset,r.byteLength).set(i);return}else return i.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return r?this.wrapper.read(r):this.wrapper.read()}},ln=class{constructor(r){this.backend=r;this.tensorTrackersById=new Map;this.freeTensors=[];this.externalTensors=new Set}getMLContext(r){let i=this.backend.getMLContext(r);if(!i)throw new Error("MLContext not found for session.");return i}getMLOpSupportLimits(r){return this.backend.getMLOpSupportLimits(r)}reserveTensorId(){let r=Ls();return this.tensorTrackersById.set(r,new fr(this)),r}releaseTensorId(r){let i=this.tensorTrackersById.get(r);i&&(this.tensorTrackersById.delete(r),i.tensorWrapper&&this.releaseTensor(i.tensorWrapper))}async ensureTensor(r,i,f,u,d){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${i}, dataType: ${f}, shape: ${u}, copyOld: ${d}}`);let p=this.tensorTrackersById.get(i);if(!p)throw new Error("Tensor not found.");return p.ensureTensor(r,f,u,d)}upload(r,i){let f=this.tensorTrackersById.get(r);if(!f)throw new Error("Tensor not found.");f.upload(i)}async download(r,i){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${r}, dstBuffer: ${i?.byteLength}}`);let f=this.tensorTrackersById.get(r);if(!f)throw new Error("Tensor not found.");return f.download(i)}releaseTensorsForSession(r){for(let i of this.freeTensors)i.sessionId===r&&i.destroy();this.freeTensors=this.freeTensors.filter(i=>i.sessionId!==r)}registerTensor(r,i,f,u){let d=this.getMLContext(r),p=Ls(),m=new ur({sessionId:r,context:d,tensor:i,dataType:f,shape:u});return this.tensorTrackersById.set(p,new fr(this,m)),this.externalTensors.add(m),p}async getCachedTensor(r,i,f,u,d,p,m){let y=this.getMLContext(r);for(let[g,v]of this.freeTensors.entries())if(v.canReuseTensor(y,i,f)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${i}, ${m?`fallbackDataType: ${m},`:""} shape: ${f}`);let T=this.freeTensors.splice(g,1)[0];return T.sessionId=r,T}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${i}, ${m?`fallbackDataType: ${m},`:""} shape: ${f}}`);let w=await y.createTensor({dataType:m??i,shape:f,dimensions:f,usage:u,writable:d,readable:p});return new ur({sessionId:r,context:y,tensor:w,dataType:i,shape:f,fallbackDataType:m})}releaseTensor(r){this.externalTensors.has(r)&&this.externalTensors.delete(r),this.freeTensors.push(r)}},Us=(...o)=>new ln(...o)});var Ds={};At(Ds,{WebNNBackend:()=>pn});var cr,gc,pn,Ps=F(()=>{"use strict";st();He();Ss();Cs();cn();cr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),gc=(o,r)=>{if(o===r)return!0;if(o===void 0||r===void 0)return!1;let i=Object.keys(o).sort(),f=Object.keys(r).sort();return i.length===f.length&&i.every((u,d)=>u===f[d]&&o[u]===r[u])},pn=class{constructor(r){this.tensorManager=Us(this);this.mlContextBySessionId=new Map;this.sessionIdsByMLContext=new Map;this.mlContextCache=[];this.sessionGraphInputs=new Map;this.sessionGraphOutputs=new Map;this.temporaryGraphInputs=[];this.temporaryGraphOutputs=[];this.temporarySessionTensorIds=new Map;this.mlOpSupportLimitsBySessionId=new Map;Is(r.logLevel,!!r.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(r){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${r}}`),this.activeSessionId=r}onRunEnd(r){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${r}}`);let i=this.temporarySessionTensorIds.get(r);if(i){for(let f of i)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${f}}`),this.tensorManager.releaseTensorId(f);this.temporarySessionTensorIds.delete(r),this.activeSessionId=void 0}}async createMLContext(r){if(r instanceof GPUDevice){let f=this.mlContextCache.findIndex(u=>u.gpuDevice===r);if(f!==-1)return this.mlContextCache[f].mlContext;{let u=await navigator.ml.createContext(r);return this.mlContextCache.push({gpuDevice:r,mlContext:u}),u}}else if(r===void 0){let f=this.mlContextCache.findIndex(u=>u.options===void 0&&u.gpuDevice===void 0);if(f!==-1)return this.mlContextCache[f].mlContext;{let u=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:u}),u}}let i=this.mlContextCache.findIndex(f=>gc(f.options,r));if(i!==-1)return this.mlContextCache[i].mlContext;{let f=await navigator.ml.createContext(r);return this.mlContextCache.push({options:r,mlContext:f}),f}}registerMLContext(r,i){this.mlContextBySessionId.set(r,i);let f=this.sessionIdsByMLContext.get(i);f||(f=new Set,this.sessionIdsByMLContext.set(i,f)),f.add(r),this.mlOpSupportLimitsBySessionId.has(r)||this.mlOpSupportLimitsBySessionId.set(r,i.opSupportLimits()),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(r,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(r,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(r){this.sessionGraphInputs.delete(r),this.sessionGraphOutputs.delete(r);let i=this.mlContextBySessionId.get(r);if(!i)return;this.tensorManager.releaseTensorsForSession(r),this.mlContextBySessionId.delete(r),this.mlOpSupportLimitsBySessionId.delete(r);let f=this.sessionIdsByMLContext.get(i);if(f.delete(r),f.size===0){this.sessionIdsByMLContext.delete(i);let u=this.mlContextCache.findIndex(d=>d.mlContext===i);u!==-1&&this.mlContextCache.splice(u,1)}}getMLContext(r){return this.mlContextBySessionId.get(r)}getMLOpSupportLimits(r){return this.mlOpSupportLimitsBySessionId.get(r)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(r){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r)}async ensureTensor(r,i,f,u,d){let p=cr.get(f);if(!p)throw new Error(`Unsupported ONNX data type: ${f}`);return this.tensorManager.ensureTensor(r??this.currentSessionId,i,p,u,d)}async createTemporaryTensor(r,i,f){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${i}, shape: ${f}}`);let u=cr.get(i);if(!u)throw new Error(`Unsupported ONNX data type: ${i}`);let d=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(r,d,u,f,!1);let p=this.temporarySessionTensorIds.get(r);return p?p.push(d):this.temporarySessionTensorIds.set(r,[d]),d}uploadTensor(r,i){if(!z().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${r}, data: ${i.byteLength}}`),this.tensorManager.upload(r,i)}async downloadTensor(r,i){return this.tensorManager.download(r,i)}createMLTensorDownloader(r,i){return async()=>{let f=await this.tensorManager.download(r);return Es(f,i)}}registerMLTensor(r,i,f,u){let d=cr.get(f);if(!d)throw new Error(`Unsupported ONNX data type: ${f}`);let p=this.tensorManager.registerTensor(r,i,d,u);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${i}, dataType: ${d}, dimensions: ${u}} -> {tensorId: ${p}}`),p}registerMLConstant(r,i,f,u,d,p,m=!1){if(!p)throw new Error("External mounted files are not available.");let y=r;r.startsWith("./")&&(y=r.substring(2));let w=p.get(y);if(!w)throw new Error(`File with name ${y} not found in preloaded files.`);if(i+f>w.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let g=w.slice(i,i+f).buffer,v;switch(d.dataType){case"float32":v=new Float32Array(g);break;case"float16":v=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(g):new Uint16Array(g);break;case"int32":v=new Int32Array(g);break;case"uint32":v=new Uint32Array(g);break;case"int64":if(m){let T=dn(new Uint8Array(g),"int64");v=new Int32Array(T.buffer),d.dataType="int32"}else v=new BigInt64Array(g);break;case"uint64":v=new BigUint64Array(g);break;case"int8":v=new Int8Array(g);break;case"int4":case"uint4":case"uint8":v=new Uint8Array(g);break;default:throw new Error(`Unsupported data type: ${d.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${d.dataType}, shape: ${d.shape}}} ${m?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),u.constant(d,v)}registerGraphInput(r){this.temporaryGraphInputs.push(r)}registerGraphOutput(r){this.temporaryGraphOutputs.push(r)}isGraphInput(r,i){let f=this.sessionGraphInputs.get(r);return f?f.includes(i):!1}isGraphOutput(r,i){let f=this.sessionGraphOutputs.get(r);return f?f.includes(i):!1}isGraphInputOutputTypeSupported(r,i,f=!0){let u=cr.get(je(i)),d=this.mlOpSupportLimitsBySessionId.get(r);return typeof u>"u"?!1:f?!!d?.input.dataTypes.includes(u):!!d?.output.dataTypes.includes(u)}flush(){}}});var Tc,Jt,Zt,it,vc,_s,It,Kt,Qt,Rs,er,tr,rr,en=F(()=>{"use strict";Ve();gs();vs();st();He();or();fn();Tc=(o,r)=>{z()._OrtInit(o,r)!==0&&G("Can't initialize onnxruntime.")},Jt=async o=>{Tc(o.wasm.numThreads,Ot(o.logLevel))},Zt=async(o,r)=>{z().asyncInit?.();let i=o.webgpu.adapter;if(r==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(i){if(typeof i.limits!="object"||typeof i.features!="object"||typeof i.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let f=o.webgpu.powerPreference;if(f!==void 0&&f!=="low-power"&&f!=="high-performance")throw new Error(`Invalid powerPreference setting: "${f}"`);let u=o.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(i=await navigator.gpu.requestAdapter({powerPreference:f,forceFallbackAdapter:u}),!i)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(r==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(r==="webgpu"&&z().webgpuInit(f=>{o.webgpu.device=f}),r==="webnn"){let f=new(Ps(),zt(Ds)).WebNNBackend(o);z().webnnInit([f,()=>f.reserveTensorId(),u=>f.releaseTensorId(u),async(u,d,p,m,y)=>f.ensureTensor(u,d,p,m,y),(u,d)=>{f.uploadTensor(u,d)},async(u,d)=>f.downloadTensor(u,d),(u,d)=>f.registerMLContext(u,d),!!o.trace])}},it=new Map,vc=o=>{let r=z(),i=r.stackSave();try{let f=r.PTR_SIZE,u=r.stackAlloc(2*f);r._OrtGetInputOutputCount(o,u,u+f)!==0&&G("Can't get session input/output count.");let p=f===4?"i32":"i64";return[Number(r.getValue(u,p)),Number(r.getValue(u+f,p))]}finally{r.stackRestore(i)}},_s=(o,r)=>{let i=z(),f=i.stackSave(),u=0;try{let d=i.PTR_SIZE,p=i.stackAlloc(2*d);i._OrtGetInputOutputMetadata(o,r,p,p+d)!==0&&G("Can't get session input/output metadata.");let y=Number(i.getValue(p,"*"));u=Number(i.getValue(p+d,"*"));let w=i.HEAP32[u/4];if(w===0)return[y,0];let g=i.HEAPU32[u/4+1],v=[];for(let T=0;T<g;T++){let x=Number(i.getValue(u+8+T*d,"*"));v.push(x!==0?i.UTF8ToString(x):Number(i.getValue(u+8+(T+g)*d,"*")))}return[y,w,v]}finally{i.stackRestore(f),u!==0&&i._OrtFree(u)}},It=o=>{let r=z(),i=r._malloc(o.byteLength);if(i===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${o.byteLength}.`);return r.HEAPU8.set(o,i),[i,o.byteLength]},Kt=async(o,r)=>{let i,f,u=z();Array.isArray(o)?[i,f]=o:o.buffer===u.HEAPU8.buffer?[i,f]=[o.byteOffset,o.byteLength]:[i,f]=It(o);let d=0,p=0,m=0,y=[],w=[],g=[];try{if([p,y]=await Ts(r),r?.externalData&&u.mountExternalData){let _=[];for(let H of r.externalData){let V=typeof H=="string"?H:H.path;_.push(Bt(typeof H=="string"?H:H.data).then(re=>{u.mountExternalData(V,re)}))}await Promise.all(_)}for(let _ of r?.executionProviders??[])if((typeof _=="string"?_:_.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof _!="string"){let V=_,re=V?.context,ne=V?.gpuDevice,l=V?.deviceType,ye=V?.powerPreference;re?u.currentContext=re:ne?u.currentContext=await u.webnnCreateMLContext(ne):u.currentContext=await u.webnnCreateMLContext({deviceType:l,powerPreference:ye})}else u.currentContext=await u.webnnCreateMLContext();break}d=await u._OrtCreateSession(i,f,p),u.webgpuOnCreateSession?.(d),d===0&&G("Can't create a session."),u.jsepOnCreateSession?.(),u.currentContext&&(u.webnnRegisterMLContext(d,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[v,T]=vc(d),x=!!r?.enableGraphCapture,M=[],W=[],j=[],U=[],B=[];for(let _=0;_<v;_++){let[H,V,re]=_s(d,_);H===0&&G("Can't get an input name."),w.push(H);let ne=u.UTF8ToString(H);M.push(ne),j.push(V===0?{name:ne,isTensor:!1}:{name:ne,isTensor:!0,type:ar(V),shape:re})}for(let _=0;_<T;_++){let[H,V,re]=_s(d,_+v);H===0&&G("Can't get an output name."),g.push(H);let ne=u.UTF8ToString(H);W.push(ne),U.push(V===0?{name:ne,isTensor:!1}:{name:ne,isTensor:!0,type:ar(V),shape:re});{if(x&&r?.preferredOutputLocation===void 0){B.push("gpu-buffer");continue}let l=typeof r?.preferredOutputLocation=="string"?r.preferredOutputLocation:r?.preferredOutputLocation?.[ne]??"cpu",ye=u.webnnIsGraphOutput;if(l==="cpu"&&ye&&ye(d,ne)){B.push("ml-tensor-cpu-output");continue}if(l!=="cpu"&&l!=="cpu-pinned"&&l!=="gpu-buffer"&&l!=="ml-tensor")throw new Error(`Not supported preferred output location: ${l}.`);if(x&&l!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${l}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);B.push(l)}}let X=null;return B.some(_=>_==="gpu-buffer"||_==="ml-tensor"||_==="ml-tensor-cpu-output")&&(m=u._OrtCreateBinding(d),m===0&&G("Can't create IO binding."),X={handle:m,outputPreferredLocations:B,outputPreferredLocationsEncoded:B.map(_=>_==="ml-tensor-cpu-output"?"ml-tensor":_).map(_=>un(_))}),it.set(d,[d,w,g,X,x,!1]),[d,M,W,j,U]}catch(v){throw w.forEach(T=>u._OrtFree(T)),g.forEach(T=>u._OrtFree(T)),m!==0&&u._OrtReleaseBinding(m)!==0&&G("Can't release IO binding."),d!==0&&u._OrtReleaseSession(d)!==0&&G("Can't release session."),v}finally{u._free(i),p!==0&&u._OrtReleaseSessionOptions(p)!==0&&G("Can't release session options."),y.forEach(v=>u._free(v)),u.unmountExternalData?.()}},Qt=o=>{let r=z(),i=it.get(o);if(!i)throw new Error(`cannot release session. invalid session id: ${o}`);let[f,u,d,p,m]=i;p&&(m&&r._OrtClearBoundOutputs(p.handle)!==0&&G("Can't clear bound outputs."),r._OrtReleaseBinding(p.handle)!==0&&G("Can't release IO binding.")),r.jsepOnReleaseSession?.(o),r.webnnOnReleaseSession?.(o),r.webgpuOnReleaseSession?.(o),u.forEach(y=>r._OrtFree(y)),d.forEach(y=>r._OrtFree(y)),r._OrtReleaseSession(f)!==0&&G("Can't release session."),it.delete(o)},Rs=async(o,r,i,f,u,d,p=!1)=>{if(!o){r.push(0);return}let m=z(),y=m.PTR_SIZE,w=o[0],g=o[1],v=o[3],T=v,x,M;if(w==="string"&&(v==="gpu-buffer"||v==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(p&&v!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${d} when enableGraphCapture is true.`);if(v==="gpu-buffer"){let U=o[2].gpuBuffer;M=yt(je(w),g);{let B=m.webgpuRegisterBuffer;if(!B)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');x=B(U,f)}}else if(v==="ml-tensor"){let U=o[2].mlTensor;M=yt(je(w),g);let B=m.webnnRegisterMLTensor;if(!B)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');x=B(f,U,je(w),g)}else{let U=o[2];if(Array.isArray(U)){M=y*U.length,x=m._malloc(M),i.push(x);for(let B=0;B<U.length;B++){if(typeof U[B]!="string")throw new TypeError(`tensor data at index ${B} is not a string`);m.setValue(x+B*y,me(U[B],i),"*")}}else{let B=m.webnnIsGraphInput,X=m.webnnIsGraphOutput;if(w!=="string"&&B&&X){let _=m.UTF8ToString(u);if(B(f,_)||X(f,_)){let H=je(w);M=yt(H,g),T="ml-tensor";let V=m.webnnCreateTemporaryTensor,re=m.webnnUploadTensor;if(!V||!re)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let ne=await V(f,H,g);re(ne,new Uint8Array(U.buffer,U.byteOffset,U.byteLength)),x=ne}else M=U.byteLength,x=m._malloc(M),i.push(x),m.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,M),x)}else M=U.byteLength,x=m._malloc(M),i.push(x),m.HEAPU8.set(new Uint8Array(U.buffer,U.byteOffset,M),x)}}let W=m.stackSave(),j=m.stackAlloc(4*g.length);try{g.forEach((B,X)=>m.setValue(j+X*y,B,y===4?"i32":"i64"));let U=m._OrtCreateTensor(je(w),x,M,j,g.length,un(T));U===0&&G(`Can't create tensor for input/output. session=${f}, index=${d}.`),r.push(U)}finally{m.stackRestore(W)}},er=async(o,r,i,f,u,d)=>{let p=z(),m=p.PTR_SIZE,y=it.get(o);if(!y)throw new Error(`cannot run inference. invalid session id: ${o}`);let w=y[0],g=y[1],v=y[2],T=y[3],x=y[4],M=y[5],W=r.length,j=f.length,U=0,B=[],X=[],_=[],H=[],V=[],re=p.stackSave(),ne=p.stackAlloc(W*m),l=p.stackAlloc(W*m),ye=p.stackAlloc(j*m),Se=p.stackAlloc(j*m);try{[U,B]=ws(d),$e("wasm prepareInputOutputTensor");for(let C=0;C<W;C++)await Rs(i[C],X,H,o,g[r[C]],r[C],x);for(let C=0;C<j;C++)await Rs(u[C],_,H,o,v[f[C]],W+f[C],x);ze("wasm prepareInputOutputTensor");for(let C=0;C<W;C++)p.setValue(ne+C*m,X[C],"*"),p.setValue(l+C*m,g[r[C]],"*");for(let C=0;C<j;C++)p.setValue(ye+C*m,_[C],"*"),p.setValue(Se+C*m,v[f[C]],"*");if(T&&!M){let{handle:C,outputPreferredLocations:I,outputPreferredLocationsEncoded:S}=T;if(g.length!==W)throw new Error(`input count from feeds (${W}) is expected to be always equal to model's input count (${g.length}).`);$e("wasm bindInputsOutputs");for(let q=0;q<W;q++){let ae=r[q];await p._OrtBindInput(C,g[ae],X[q])!==0&&G(`Can't bind input[${q}] for session=${o}.`)}for(let q=0;q<j;q++){let ae=f[q];u[q]?.[3]?(V.push(_[q]),p._OrtBindOutput(C,v[ae],_[q],0)!==0&&G(`Can't bind pre-allocated output[${q}] for session=${o}.`)):p._OrtBindOutput(C,v[ae],0,S[ae])!==0&&G(`Can't bind output[${q}] to ${I[q]} for session=${o}.`)}ze("wasm bindInputsOutputs"),it.set(o,[w,g,v,T,x,!0])}p.jsepOnRunStart?.(w),p.webnnOnRunStart?.(w);let Y;T?Y=await p._OrtRunWithBinding(w,T.handle,j,ye,U):Y=await p._OrtRun(w,l,ne,W,Se,j,ye,U),Y!==0&&G("failed to call OrtRun().");let J=[],Ue=[];$e("wasm ProcessOutputTensor");for(let C=0;C<j;C++){let I=Number(p.getValue(ye+C*m,"*"));if(I===_[C]||V.includes(_[C])){J.push(u[C]),I!==_[C]&&p._OrtReleaseTensor(I)!==0&&G("Can't release tensor.");continue}let S=p.stackSave(),q=p.stackAlloc(4*m),ae=!1,$,se=0;try{p._OrtGetTensorData(I,q,q+m,q+2*m,q+3*m)!==0&&G(`Can't access output tensor data on index ${C}.`);let ke=m===4?"i32":"i64",Ye=Number(p.getValue(q,ke));se=p.getValue(q+m,"*");let ft=p.getValue(q+m*2,"*"),qe=Number(p.getValue(q+m*3,ke)),he=[];for(let oe=0;oe<qe;oe++)he.push(Number(p.getValue(ft+oe*m,ke)));p._OrtFree(ft)!==0&&G("Can't free memory for tensor dims.");let Ae=he.reduce((oe,Z)=>oe*Z,1);$=ar(Ye);let de=T?.outputPreferredLocations[f[C]];if($==="string"){if(de==="gpu-buffer"||de==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let oe=[];for(let Z=0;Z<Ae;Z++){let xe=p.getValue(se+Z*m,"*"),Ce=p.getValue(se+(Z+1)*m,"*"),ct=Z===Ae-1?void 0:Ce-xe;oe.push(p.UTF8ToString(xe,ct))}J.push([$,he,oe,"cpu"])}else if(de==="gpu-buffer"&&Ae>0){let oe=p.webgpuGetBuffer;if(!oe)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let Z=oe(se),xe=yt(Ye,Ae);if(xe===void 0||!sr($))throw new Error(`Unsupported data type: ${$}`);ae=!0;{p.webgpuRegisterBuffer(Z,o,se);let Ce=p.webgpuCreateDownloader(Z,xe,o);J.push([$,he,{gpuBuffer:Z,download:async()=>{let ct=await Ce();return new(at($))(ct)},dispose:()=>{p._OrtReleaseTensor(I)!==0&&G("Can't release tensor.")}},"gpu-buffer"])}}else if(de==="ml-tensor"&&Ae>0){let oe=p.webnnEnsureTensor,Z=p.webnnIsGraphInputOutputTypeSupported;if(!oe||!Z)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(yt(Ye,Ae)===void 0||!ir($))throw new Error(`Unsupported data type: ${$}`);if(!Z(o,$,!1))throw new Error(`preferredLocation "ml-tensor" for ${$} output is not supported by current WebNN Context.`);let Ce=await oe(o,se,Ye,he,!1);ae=!0,J.push([$,he,{mlTensor:Ce,download:p.webnnCreateMLTensorDownloader(se,$),dispose:()=>{p.webnnReleaseTensorId(se),p._OrtReleaseTensor(I)}},"ml-tensor"])}else if(de==="ml-tensor-cpu-output"&&Ae>0){let oe=p.webnnCreateMLTensorDownloader(se,$)(),Z=J.length;ae=!0,Ue.push((async()=>{let xe=[Z,await oe];return p.webnnReleaseTensorId(se),p._OrtReleaseTensor(I),xe})()),J.push([$,he,[],"cpu"])}else{let oe=at($),Z=new oe(Ae);new Uint8Array(Z.buffer,Z.byteOffset,Z.byteLength).set(p.HEAPU8.subarray(se,se+Z.byteLength)),J.push([$,he,Z,"cpu"])}}finally{p.stackRestore(S),$==="string"&&se&&p._free(se),ae||p._OrtReleaseTensor(I)}}T&&!x&&(p._OrtClearBoundOutputs(T.handle)!==0&&G("Can't clear bound outputs."),it.set(o,[w,g,v,T,x,!1]));for(let[C,I]of await Promise.all(Ue))J[C][2]=I;return ze("wasm ProcessOutputTensor"),J}finally{p.webnnOnRunEnd?.(w),p.stackRestore(re),i.forEach(Y=>{Y&&Y[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Y[2].gpuBuffer)}),u.forEach(Y=>{Y&&Y[3]==="gpu-buffer"&&p.webgpuUnregisterBuffer(Y[2].gpuBuffer)}),X.forEach(Y=>p._OrtReleaseTensor(Y)),_.forEach(Y=>p._OrtReleaseTensor(Y)),H.forEach(Y=>p._free(Y)),U!==0&&p._OrtReleaseRunOptions(U),B.forEach(Y=>p._free(Y))}},tr=o=>{let r=z(),i=it.get(o);if(!i)throw new Error("invalid session id");let f=i[0],u=r._OrtEndProfiling(f);u===0&&G("Can't get an profile file name."),r._OrtFree(u)},rr=o=>{let r=[];for(let i of o){let f=i[2];!Array.isArray(f)&&"buffer"in f&&r.push(f.buffer)}return r}});var ut,Ee,Mt,dr,pr,lr,mn,hn,bt,wt,Sc,Ws,ks,Ns,Fs,Gs,$s,zs,yn=F(()=>{"use strict";Ve();en();He();qt();ut=()=>!!ee.wasm.proxy&&typeof document<"u",Mt=!1,dr=!1,pr=!1,hn=new Map,bt=(o,r)=>{let i=hn.get(o);i?i.push(r):hn.set(o,[r])},wt=()=>{if(Mt||!dr||pr||!Ee)throw new Error("worker not ready")},Sc=o=>{switch(o.data.type){case"init-wasm":Mt=!1,o.data.err?(pr=!0,mn[1](o.data.err)):(dr=!0,mn[0]()),lr&&(URL.revokeObjectURL(lr),lr=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=hn.get(o.data.type);o.data.err?r.shift()[1](o.data.err):r.shift()[0](o.data.out);break}default:}},Ws=async()=>{if(!dr){if(Mt)throw new Error("multiple calls to 'initWasm()' detected.");if(pr)throw new Error("previous call to 'initWasm()' failed.");if(Mt=!0,ut())return new Promise((o,r)=>{Ee?.terminate(),hs().then(([i,f])=>{try{Ee=f,Ee.onerror=d=>r(d),Ee.onmessage=Sc,mn=[o,r];let u={type:"init-wasm",in:ee};!u.in.wasm.wasmPaths&&(i||rn)&&(u.in.wasm.wasmPaths={wasm:new URL("ort-wasm-simd-threaded.asyncify.wasm",import.meta.url).href}),Ee.postMessage(u),lr=i}catch(u){r(u)}},r)});try{await Xt(ee.wasm),await Jt(ee),dr=!0}catch(o){throw pr=!0,o}finally{Mt=!1}}},ks=async o=>{if(ut())return wt(),new Promise((r,i)=>{bt("init-ep",[r,i]);let f={type:"init-ep",in:{epName:o,env:ee}};Ee.postMessage(f)});await Zt(ee,o)},Ns=async o=>ut()?(wt(),new Promise((r,i)=>{bt("copy-from",[r,i]);let f={type:"copy-from",in:{buffer:o}};Ee.postMessage(f,[o.buffer])})):It(o),Fs=async(o,r)=>{if(ut()){if(r?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return wt(),new Promise((i,f)=>{bt("create",[i,f]);let u={type:"create",in:{model:o,options:{...r}}},d=[];o instanceof Uint8Array&&d.push(o.buffer),Ee.postMessage(u,d)})}else return Kt(o,r)},Gs=async o=>{if(ut())return wt(),new Promise((r,i)=>{bt("release",[r,i]);let f={type:"release",in:o};Ee.postMessage(f)});Qt(o)},$s=async(o,r,i,f,u,d)=>{if(ut()){if(i.some(p=>p[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(p=>p))throw new Error("pre-allocated output tensor is not supported for proxy.");return wt(),new Promise((p,m)=>{bt("run",[p,m]);let y=i,w={type:"run",in:{sessionId:o,inputIndices:r,inputs:y,outputIndices:f,options:d}};Ee.postMessage(w,rr(y))})}else return er(o,r,i,f,u,d)},zs=async o=>{if(ut())return wt(),new Promise((r,i)=>{bt("end-profiling",[r,i]);let f={type:"end-profiling",in:o};Ee.postMessage(f)});tr(o)}});var Vs,Ac,mr,Hs=F(()=>{"use strict";Ve();yn();st();Yt();fn();Vs=(o,r)=>{switch(o.location){case"cpu":return[o.type,o.dims,o.data,"cpu"];case"gpu-buffer":return[o.type,o.dims,{gpuBuffer:o.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[o.type,o.dims,{mlTensor:o.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${o.location} for ${r()}`)}},Ac=o=>{switch(o[3]){case"cpu":return new Le(o[0],o[2],o[1]);case"gpu-buffer":{let r=o[0];if(!sr(r))throw new Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:i,download:f,dispose:u}=o[2];return Le.fromGpuBuffer(i,{dataType:r,dims:o[1],download:f,dispose:u})}case"ml-tensor":{let r=o[0];if(!ir(r))throw new Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:i,download:f,dispose:u}=o[2];return Le.fromMLTensor(i,{dataType:r,dims:o[1],download:f,dispose:u})}default:throw new Error(`invalid data location: ${o[3]}`)}},mr=class{async fetchModelAndCopyToWasmMemory(r){return Ns(await Bt(r))}async loadModel(r,i){rt();let f;typeof r=="string"?f=await this.fetchModelAndCopyToWasmMemory(r):f=r,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Fs(f,i),nt()}async dispose(){return Gs(this.sessionId)}async run(r,i,f){rt();let u=[],d=[];Object.entries(r).forEach(T=>{let x=T[0],M=T[1],W=this.inputNames.indexOf(x);if(W===-1)throw new Error(`invalid input '${x}'`);u.push(M),d.push(W)});let p=[],m=[];Object.entries(i).forEach(T=>{let x=T[0],M=T[1],W=this.outputNames.indexOf(x);if(W===-1)throw new Error(`invalid output '${x}'`);p.push(M),m.push(W)});let y=u.map((T,x)=>Vs(T,()=>`input "${this.inputNames[d[x]]}"`)),w=p.map((T,x)=>T?Vs(T,()=>`output "${this.outputNames[m[x]]}"`):null),g=await $s(this.sessionId,d,y,m,w,f),v={};for(let T=0;T<g.length;T++)v[this.outputNames[m[T]]]=p[T]??Ac(g[T]);return nt(),v}startProfiling(){}endProfiling(){zs(this.sessionId)}}});var Ys={};At(Ys,{OnnxruntimeWebAssemblyBackend:()=>hr,initializeFlags:()=>js,wasmBackend:()=>xc});var js,hr,xc,qs=F(()=>{"use strict";Ve();yn();Hs();js=()=>{(typeof ee.wasm.initTimeout!="number"||ee.wasm.initTimeout<0)&&(ee.wasm.initTimeout=0);let o=ee.wasm.simd;if(typeof o!="boolean"&&o!==void 0&&o!=="fixed"&&o!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${o}". Reset it to \`false\` and ignore SIMD feature checking.`),ee.wasm.simd=!1),typeof ee.wasm.proxy!="boolean"&&(ee.wasm.proxy=!1),typeof ee.wasm.trace!="boolean"&&(ee.wasm.trace=!1),typeof ee.wasm.numThreads!="number"||!Number.isInteger(ee.wasm.numThreads)||ee.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)ee.wasm.numThreads=1;else{let r=typeof navigator>"u"?Yr("node:os").cpus().length:navigator.hardwareConcurrency;ee.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},hr=class{async init(r){js(),await Ws(),await ks(r)}async createInferenceSessionHandler(r,i){let f=new mr;return await f.loadModel(r,i),f}},xc=new hr});Ve();Ve();Ve();var rs="1.23.0";var Ad=Qr;{let o=(qs(),zt(Ys)).wasmBackend;et("webgpu",o,5),et("webnn",o,5),et("cpu",o,10),et("wasm",o,10)}Object.defineProperty(ee.versions,"web",{value:rs,enumerable:!0});export{Qf as InferenceSession,qa as TRACE,$e as TRACE_EVENT_BEGIN,ze as TRACE_EVENT_END,rt as TRACE_FUNC_BEGIN,nt as TRACE_FUNC_END,Le as Tensor,Ad as default,ee as env,et as registerBackend};
//# sourceMappingURL=ort.webgpu.bundle.min.mjs.map
