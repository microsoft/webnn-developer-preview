/*!
 * ONNX Runtime Web v1.18.0
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */
"use strict";var Ke=Object.defineProperty;var Jr=Object.getOwnPropertyDescriptor;var Kr=Object.getOwnPropertyNames;var Zr=Object.prototype.hasOwnProperty;var C=(r,e)=>()=>(r&&(e=r(r=0)),e);var Qr=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),xe=(r,e)=>{for(var t in e)Ke(r,t,{get:e[t],enumerable:!0})},en=(r,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Kr(e))!Zr.call(r,o)&&o!==t&&Ke(r,o,{get:()=>e[o],enumerable:!(a=Jr(e,o))||a.enumerable});return r};var Re=r=>en(Ke({},"__esModule",{value:!0}),r);var Le,me,ge,tn,Fe,Me=C(()=>{"use strict";Le=new Map,me=[],ge=(r,e,t)=>{if(e&&typeof e.init=="function"&&typeof e.createInferenceSessionHandler=="function"){let a=Le.get(r);if(a===void 0)Le.set(r,{backend:e,priority:t});else{if(a.priority>t)return;if(a.priority===t&&a.backend!==e)throw new Error(`cannot register backend "${r}" using priority ${t}`)}if(t>=0){let o=me.indexOf(r);o!==-1&&me.splice(o,1);for(let d=0;d<me.length;d++)if(Le.get(me[d]).priority<=t){me.splice(d,0,r);return}me.push(r)}return}throw new TypeError("not a valid backend")},tn=async r=>{let e=Le.get(r);if(!e)return"backend not found.";if(e.initialized)return e.backend;if(e.aborted)return e.error;{let t=!!e.initPromise;try{return t||(e.initPromise=e.backend.init(r)),await e.initPromise,e.initialized=!0,e.backend}catch(a){return t||(e.error=`${a}`,e.aborted=!0),e.error}finally{delete e.initPromise}}},Fe=async r=>{let e=r.executionProviders||[],t=e.map(f=>typeof f=="string"?f:f.name),a=t.length===0?me:t,o,d=[],u=new Set;for(let f of a){let c=await tn(f);typeof c=="string"?d.push({name:f,err:c}):(o||(o=c),o===c&&u.add(f))}if(!o)throw new Error(`no available backend found. ERR: ${d.map(f=>`[${f.name}] ${f.err}`).join(", ")}`);for(let{name:f,err:c}of d)t.includes(f)&&console.warn(`removing requested execution provider "${f}" from session options because it is not available: ${c}`);let l=e.filter(f=>u.has(typeof f=="string"?f:f.name));return[o,new Proxy(r,{get:(f,c)=>c==="executionProviders"?l:Reflect.get(f,c)})]}});var Bt=C(()=>{"use strict";Me()});var Ct,_t=C(()=>{"use strict";Ct="1.18.0"});var Dt,J,Ze=C(()=>{"use strict";_t();Dt="warning",J={wasm:{},webgl:{},webgpu:{},versions:{common:Ct},set logLevel(r){if(r!==void 0){if(typeof r!="string"||["verbose","info","warning","error","fatal"].indexOf(r)===-1)throw new Error(`Unsupported logging level: ${r}`);Dt=r}},get logLevel(){return Dt}};Object.defineProperty(J,"logLevel",{enumerable:!0})});var D,Ut=C(()=>{"use strict";Ze();D=J});var Rt,Lt,Ft=C(()=>{"use strict";Rt=(r,e)=>{let t=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=r.dims[3],t.height=r.dims[2];let a=t.getContext("2d");if(a!=null){let o,d;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(o=r.dims[2],d=r.dims[3]):(o=r.dims[3],d=r.dims[2]);let u=e?.format!==void 0?e.format:"RGB",l=e?.norm,f,c;l===void 0||l.mean===void 0?f=[255,255,255,255]:typeof l.mean=="number"?f=[l.mean,l.mean,l.mean,l.mean]:(f=[l.mean[0],l.mean[1],l.mean[2],0],l.mean[3]!==void 0&&(f[3]=l.mean[3])),l===void 0||l.bias===void 0?c=[0,0,0,0]:typeof l.bias=="number"?c=[l.bias,l.bias,l.bias,l.bias]:(c=[l.bias[0],l.bias[1],l.bias[2],0],l.bias[3]!==void 0&&(c[3]=l.bias[3]));let w=d*o,h=0,y=w,b=w*2,E=-1;u==="RGBA"?(h=0,y=w,b=w*2,E=w*3):u==="RGB"?(h=0,y=w,b=w*2):u==="RBG"&&(h=0,b=w,y=w*2);for(let O=0;O<d;O++)for(let A=0;A<o;A++){let L=(r.data[h++]-c[0])*f[0],x=(r.data[y++]-c[1])*f[1],P=(r.data[b++]-c[2])*f[2],k=E===-1?255:(r.data[E++]-c[3])*f[3];a.fillStyle="rgba("+L+","+x+","+P+","+k+")",a.fillRect(A,O,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Lt=(r,e)=>{let t=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),a;if(t!=null){let o,d,u;e?.tensorLayout!==void 0&&e.tensorLayout==="NHWC"?(o=r.dims[2],d=r.dims[1],u=r.dims[3]):(o=r.dims[3],d=r.dims[2],u=r.dims[1]);let l=e!==void 0&&e.format!==void 0?e.format:"RGB",f=e?.norm,c,w;f===void 0||f.mean===void 0?c=[255,255,255,255]:typeof f.mean=="number"?c=[f.mean,f.mean,f.mean,f.mean]:(c=[f.mean[0],f.mean[1],f.mean[2],255],f.mean[3]!==void 0&&(c[3]=f.mean[3])),f===void 0||f.bias===void 0?w=[0,0,0,0]:typeof f.bias=="number"?w=[f.bias,f.bias,f.bias,f.bias]:(w=[f.bias[0],f.bias[1],f.bias[2],0],f.bias[3]!==void 0&&(w[3]=f.bias[3]));let h=d*o;if(e!==void 0&&(e.format!==void 0&&u===4&&e.format!=="RGBA"||u===3&&e.format!=="RGB"&&e.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let y=4,b=0,E=1,O=2,A=3,L=0,x=h,P=h*2,k=-1;l==="RGBA"?(L=0,x=h,P=h*2,k=h*3):l==="RGB"?(L=0,x=h,P=h*2):l==="RBG"&&(L=0,P=h,x=h*2),a=t.createImageData(o,d);for(let H=0;H<d*o;b+=y,E+=y,O+=y,A+=y,H++)a.data[b]=(r.data[L++]-w[0])*c[0],a.data[E]=(r.data[x++]-w[1])*c[1],a.data[O]=(r.data[P++]-w[2])*c[2],a.data[A]=k===-1?255:(r.data[k++]-w[3])*c[3]}else throw new Error("Can not access image data");return a}});var Qe,Mt,kt,Nt,Wt,Gt=C(()=>{"use strict";ke();Qe=(r,e)=>{if(r===void 0)throw new Error("Image buffer must be defined");if(e.height===void 0||e.width===void 0)throw new Error("Image height and width must be defined");if(e.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:t,width:a}=e,o=e.norm??{mean:255,bias:0},d,u;typeof o.mean=="number"?d=[o.mean,o.mean,o.mean,o.mean]:d=[o.mean[0],o.mean[1],o.mean[2],o.mean[3]??255],typeof o.bias=="number"?u=[o.bias,o.bias,o.bias,o.bias]:u=[o.bias[0],o.bias[1],o.bias[2],o.bias[3]??0];let l=e.format!==void 0?e.format:"RGBA",f=e.tensorFormat!==void 0&&e.tensorFormat!==void 0?e.tensorFormat:"RGB",c=t*a,w=f==="RGBA"?new Float32Array(c*4):new Float32Array(c*3),h=4,y=0,b=1,E=2,O=3,A=0,L=c,x=c*2,P=-1;l==="RGB"&&(h=3,y=0,b=1,E=2,O=-1),f==="RGBA"?P=c*3:f==="RBG"?(A=0,x=c,L=c*2):f==="BGR"&&(x=0,L=c,A=c*2);for(let H=0;H<c;H++,y+=h,E+=h,b+=h,O+=h)w[A++]=(r[y]+u[0])/d[0],w[L++]=(r[b]+u[1])/d[1],w[x++]=(r[E]+u[2])/d[2],P!==-1&&O!==-1&&(w[P++]=(r[O]+u[3])/d[3]);return f==="RGBA"?new q("float32",w,[1,4,t,a]):new q("float32",w,[1,3,t,a])},Mt=async(r,e)=>{let t=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,a=typeof ImageData<"u"&&r instanceof ImageData,o=typeof ImageBitmap<"u"&&r instanceof ImageBitmap,d=typeof r=="string",u,l=e??{},f=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},c=w=>w instanceof HTMLCanvasElement||w instanceof OffscreenCanvas?w.getContext("2d"):null;if(t){let w=f();w.width=r.width,w.height=r.height;let h=c(w);if(h!=null){let y=r.height,b=r.width;if(e!==void 0&&e.resizedHeight!==void 0&&e.resizedWidth!==void 0&&(y=e.resizedHeight,b=e.resizedWidth),e!==void 0){if(l=e,e.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");l.tensorFormat="RGBA",l.height=y,l.width=b}else l.tensorFormat="RGBA",l.height=y,l.width=b;h.drawImage(r,0,0),u=h.getImageData(0,0,b,y).data}else throw new Error("Can not access image data")}else if(a){let w,h;if(e!==void 0&&e.resizedWidth!==void 0&&e.resizedHeight!==void 0?(w=e.resizedHeight,h=e.resizedWidth):(w=r.height,h=r.width),e!==void 0&&(l=e),l.format="RGBA",l.height=w,l.width=h,e!==void 0){let y=f();y.width=h,y.height=w;let b=c(y);if(b!=null)b.putImageData(r,0,0),u=b.getImageData(0,0,h,w).data;else throw new Error("Can not access image data")}else u=r.data}else if(o){if(e===void 0)throw new Error("Please provide image config with format for Imagebitmap");let w=f();w.width=r.width,w.height=r.height;let h=c(w);if(h!=null){let y=r.height,b=r.width;return h.drawImage(r,0,0,b,y),u=h.getImageData(0,0,b,y).data,l.height=y,l.width=b,Qe(u,l)}else throw new Error("Can not access image data")}else{if(d)return new Promise((w,h)=>{let y=f(),b=c(y);if(!r||!b)return h();let E=new Image;E.crossOrigin="Anonymous",E.src=r,E.onload=()=>{y.width=E.width,y.height=E.height,b.drawImage(E,0,0,y.width,y.height);let O=b.getImageData(0,0,y.width,y.height);l.height=y.height,l.width=y.width,w(Qe(O.data,l))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(u!==void 0)return Qe(u,l);throw new Error("Input data provided is not supported - aborted tensor creation")},kt=(r,e)=>{let{width:t,height:a,download:o,dispose:d}=e,u=[1,a,t,4];return new q({location:"texture",type:"float32",texture:r,dims:u,download:o,dispose:d})},Nt=(r,e)=>{let{dataType:t,dims:a,download:o,dispose:d}=e;return new q({location:"gpu-buffer",type:t??"float32",gpuBuffer:r,dims:a,download:o,dispose:d})},Wt=(r,e,t)=>new q({location:"cpu-pinned",type:r,data:e,dims:t??[e.length]})});var he,Ie,$t,Ht,zt=C(()=>{"use strict";he=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array]]),Ie=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),$t=!1,Ht=()=>{if(!$t){$t=!0;let r=typeof BigInt64Array<"u"&&BigInt64Array.from,e=typeof BigUint64Array<"u"&&BigUint64Array.from,t=typeof Float16Array<"u"&&Float16Array.from;r&&(he.set("int64",BigInt64Array),Ie.set(BigInt64Array,"int64")),e&&(he.set("uint64",BigUint64Array),Ie.set(BigUint64Array,"uint64")),t?(he.set("float16",Float16Array),Ie.set(Float16Array,"float16")):he.set("float16",Uint16Array)}}});var jt,Yt,qt=C(()=>{"use strict";ke();jt=r=>{let e=1;for(let t=0;t<r.length;t++){let a=r[t];if(typeof a!="number"||!Number.isSafeInteger(a))throw new TypeError(`dims[${t}] must be an integer, got: ${a}`);if(a<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${a}`);e*=a}return e},Yt=(r,e)=>{switch(r.location){case"cpu":return new q(r.type,r.data,e);case"cpu-pinned":return new q({location:"cpu-pinned",data:r.data,type:r.type,dims:e});case"texture":return new q({location:"texture",texture:r.texture,type:r.type,dims:e});case"gpu-buffer":return new q({location:"gpu-buffer",gpuBuffer:r.gpuBuffer,type:r.type,dims:e});default:throw new Error(`tensorReshape: tensor location ${r.location} is not supported`)}}});var q,ke=C(()=>{"use strict";Ft();Gt();zt();qt();q=class{constructor(e,t,a){Ht();let o,d;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,o=e.type,d=e.dims,e.location){case"cpu-pinned":{let l=he.get(o);if(!l)throw new TypeError(`unsupported type "${o}" to create tensor from pinned buffer`);if(!(e.data instanceof l))throw new TypeError(`buffer should be of type ${l.name}`);this.cpuData=e.data;break}case"texture":{if(o!=="float32")throw new TypeError(`unsupported type "${o}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(o!=="float32"&&o!=="float16"&&o!=="int32"&&o!=="int64"&&o!=="uint32"&&o!=="uint8"&&o!=="bool")throw new TypeError(`unsupported type "${o}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let l,f;if(typeof e=="string")if(o=e,f=a,e==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");l=t}else{let c=he.get(e);if(c===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(t)){if(e==="float16"&&c===Uint16Array)throw new TypeError("Creating a float16 tensor from number array is not supported. Please use Uint16Array as data.");e==="uint64"||e==="int64"?l=c.from(t,BigInt):l=c.from(t)}else if(t instanceof c)l=t;else throw new TypeError(`A ${o} tensor's data must be type of ${c}`)}else if(f=t,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let c=typeof e[0];if(c==="string")o="string",l=e;else if(c==="boolean")o="bool",l=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${c}.`)}else{let c=Ie.get(e.constructor);if(c===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);o=c,l=e}if(f===void 0)f=[l.length];else if(!Array.isArray(f))throw new TypeError("A tensor's dims must be a number array");d=f,this.cpuData=l,this.dataLocation="cpu"}let u=jt(d);if(this.cpuData&&u!==this.cpuData.length)throw new Error(`Tensor's size(${u}) does not match data length(${this.cpuData.length}).`);this.type=o,this.dims=d,this.size=u}static async fromImage(e,t){return Mt(e,t)}static fromTexture(e,t){return kt(e,t)}static fromGpuBuffer(e,t){return Nt(e,t)}static fromPinnedBuffer(e,t,a){return Wt(e,t,a)}toDataURL(e){return Rt(this,e)}toImageData(e){return Lt(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,e&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Yt(this,e)}}});var W,Ne=C(()=>{"use strict";ke();W=q});var et,Vt,fe,le,tt=C(()=>{"use strict";Ze();et=(r,e)=>{(typeof J.trace>"u"?!J.wasm.trace:!J.trace)||console.timeStamp(`${r}::ORT::${e}`)},Vt=(r,e)=>{let t=new Error().stack?.split(/\r\n|\r|\n/g)||[],a=!1;for(let o=0;o<t.length;o++){if(a&&!t[o].includes("TRACE_FUNC")){let d=`FUNC_${r}::${t[o].trim().split(" ")[1]}`;e&&(d+=`::${e}`),et("CPU",d);return}t[o].includes("TRACE_FUNC")&&(a=!0)}},fe=r=>{(typeof J.trace>"u"?!J.wasm.trace:!J.trace)||Vt("BEGIN",r)},le=r=>{(typeof J.trace>"u"?!J.wasm.trace:!J.trace)||Vt("END",r)}});var We,Xt=C(()=>{"use strict";Me();Ne();tt();We=class r{constructor(e){this.handler=e}async run(e,t,a){fe();let o={},d={};if(typeof e!="object"||e===null||e instanceof W||Array.isArray(e))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let u=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof W)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("'fetches' cannot be an empty array.");u=!1;for(let c of t){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);o[c]=null}if(typeof a=="object"&&a!==null)d=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,w=Object.getOwnPropertyNames(t);for(let h of this.outputNames)if(w.indexOf(h)!==-1){let y=t[h];(y===null||y instanceof W)&&(c=!0,u=!1,o[h]=y)}if(c){if(typeof a=="object"&&a!==null)d=a;else if(typeof a<"u")throw new TypeError("'options' must be an object.")}else d=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of this.inputNames)if(typeof e[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(u)for(let c of this.outputNames)o[c]=null;let l=await this.handler.run(e,o,d),f={};for(let c in l)if(Object.hasOwnProperty.call(l,c)){let w=l[c];w instanceof W?f[c]=w:f[c]=new W(w.type,w.data,w.dims)}return le(),f}async release(){return this.handler.dispose()}static async create(e,t,a,o){fe();let d,u={};if(typeof e=="string"){if(d=e,typeof t=="object"&&t!==null)u=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof Uint8Array){if(d=e,typeof t=="object"&&t!==null)u=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer){let w=e,h=0,y=e.byteLength;if(typeof t=="object"&&t!==null)u=t;else if(typeof t=="number"){if(h=t,!Number.isSafeInteger(h))throw new RangeError("'byteOffset' must be an integer.");if(h<0||h>=w.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${w.byteLength}).`);if(y=e.byteLength-h,typeof a=="number"){if(y=a,!Number.isSafeInteger(y))throw new RangeError("'byteLength' must be an integer.");if(y<=0||h+y>w.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${w.byteLength-h}].`);if(typeof o=="object"&&o!==null)u=o;else if(typeof o<"u")throw new TypeError("'options' must be an object.")}else if(typeof a<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof t<"u")throw new TypeError("'options' must be an object.");d=new Uint8Array(w,h,y)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[l,f]=await Fe(u),c=await l.createInferenceSessionHandler(d,f);return le(),new r(c)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}}});var Jt,Kt=C(()=>{"use strict";Xt();Jt=We});var Zt=C(()=>{"use strict"});var Qt=C(()=>{"use strict"});var er=C(()=>{"use strict"});var tr=C(()=>{"use strict"});var rn,Ge,rr=C(()=>{"use strict";Me();Ne();rn="Training backend could not be resolved. Make sure you're using the correct configuration & WebAssembly files.",Ge=class r{constructor(e,t,a){this.handler=e,this.hasOptimizerModel=t,this.hasEvalModel=a}get trainingInputNames(){return this.handler.inputNames}get trainingOutputNames(){return this.handler.outputNames}get evalInputNames(){if(this.hasEvalModel)return this.handler.evalInputNames;throw new Error("This training session has no evalModel loaded.")}get evalOutputNames(){if(this.hasEvalModel)return this.handler.evalOutputNames;throw new Error("This training session has no evalModel loaded.")}static async create(e,t){let a=e.evalModel||"",o=e.optimizerModel||"",d=t||{},[u,l]=await Fe(d);if(u.createTrainingSessionHandler){let f=await u.createTrainingSessionHandler(e.checkpointState,e.trainModel,a,o,l);return new r(f,!!e.optimizerModel,!!e.evalModel)}else throw new Error(rn)}typeNarrowingForRunStep(e,t,a,o,d){let u={},l={};if(typeof a!="object"||a===null||a instanceof W||Array.isArray(a))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let f=!0;if(typeof o=="object"){if(o===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(o instanceof W)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(o)){if(o.length===0)throw new TypeError("'fetches' cannot be an empty array.");f=!1;for(let c of o){if(typeof c!="string")throw new TypeError("'fetches' must be a string array or an object.");if(t.indexOf(c)===-1)throw new RangeError(`'fetches' contains invalid output name: ${c}.`);u[c]=null}if(typeof d=="object"&&d!==null)l=d;else if(typeof d<"u")throw new TypeError("'options' must be an object.")}else{let c=!1,w=Object.getOwnPropertyNames(o);for(let h of t)if(w.indexOf(h)!==-1){let y=o[h];(y===null||y instanceof W)&&(c=!0,f=!1,u[h]=y)}if(c){if(typeof d=="object"&&d!==null)l=d;else if(typeof d<"u")throw new TypeError("'options' must be an object.")}else l=o}}else if(typeof o<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let c of e)if(typeof a[c]>"u")throw new Error(`input '${c}' is missing in 'feeds'.`);if(f)for(let c of t)u[c]=null;return[u,l]}convertHandlerReturnTypeToMapOfTensors(e){let t={};for(let a in e)if(Object.hasOwnProperty.call(e,a)){let o=e[a];o instanceof W?t[a]=o:t[a]=new W(o.type,o.data,o.dims)}return t}async lazyResetGrad(){await this.handler.lazyResetGrad()}async runTrainStep(e,t,a){let[o,d]=this.typeNarrowingForRunStep(this.trainingInputNames,this.trainingOutputNames,e,t,a),u=await this.handler.runTrainStep(e,o,d);return this.convertHandlerReturnTypeToMapOfTensors(u)}async runOptimizerStep(e){if(this.hasOptimizerModel)await this.handler.runOptimizerStep(e||{});else throw new Error("This TrainingSession has no OptimizerModel loaded.")}async runEvalStep(e,t,a){if(this.hasEvalModel){let[o,d]=this.typeNarrowingForRunStep(this.evalInputNames,this.evalOutputNames,e,t,a),u=await this.handler.runEvalStep(e,o,d);return this.convertHandlerReturnTypeToMapOfTensors(u)}else throw new Error("This TrainingSession has no EvalModel loaded.")}async getParametersSize(e=!0){return this.handler.getParametersSize(e)}async loadParametersBuffer(e,t=!0){let a=await this.getParametersSize(t);if(e.length!==4*a)throw new Error("Size of the buffer passed into loadParametersBuffer must match the number of parameters in the model. Please use getParametersSize method to check.");return this.handler.loadParametersBuffer(e,t)}async getContiguousParameters(e=!0){return this.handler.getContiguousParameters(e)}async release(){return this.handler.dispose()}}});var nr,or=C(()=>{"use strict";rr();nr=Ge});var rt={};xe(rt,{InferenceSession:()=>Jt,TRACE:()=>et,TRACE_FUNC_BEGIN:()=>fe,TRACE_FUNC_END:()=>le,Tensor:()=>W,TrainingSession:()=>nr,env:()=>D,registerBackend:()=>ge});var ye=C(()=>{"use strict";Bt();Ut();Kt();Ne();Zt();Qt();tt();er();tr();or()});var ir={};xe(ir,{createReadStream:()=>ar,readFile:()=>nn,readFileSync:()=>on});var nn,on,ar,ur=C(()=>{nn=void 0,on=void 0,ar=void 0});var fr={};xe(fr,{join:()=>sn});var sn,lr=C(()=>{sn=void 0});var pr=Qr((dr,nt)=>{"use strict";var cr=(()=>{var r=typeof document<"u"?document.currentScript?.src:void 0;return typeof __filename<"u"&&(r||=__filename),function(e={}){var t=e,a,o,d=new Promise((n,s)=>{a=n,o=s}),u=Object.assign({},t),l="./this.program",f=typeof window=="object",c=typeof importScripts=="function",w=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",h="",y,b,E;if(w){var O=(ur(),Re(ir)),A=(lr(),Re(fr));h=c?A.dirname(h)+"/":__dirname+"/",y=(n,s)=>(n=Z(n)?new URL(n):A.normalize(n),O.readFileSync(n,s?void 0:"utf8")),E=n=>(n=y(n,!0),n.buffer||(n=new Uint8Array(n)),n),b=(n,s,i,m=!0)=>{n=Z(n)?new URL(n):A.normalize(n),O.readFile(n,m?void 0:"utf8",(g,v)=>{g?i(g):s(m?v.buffer:v)})},!t.thisProgram&&1<process.argv.length&&(l=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2)}else(f||c)&&(c?h=self.location.href:typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),r&&(h=r),h.startsWith("blob:")?h="":h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1),y=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(null),s.responseText},c&&(E=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),b=(n,s,i)=>{var m=new XMLHttpRequest;m.open("GET",n,!0),m.responseType="arraybuffer",m.onload=()=>{m.status==200||m.status==0&&m.response?s(m.response):i()},m.onerror=i,m.send(null)});var L=console.log.bind(console),x=console.error.bind(console);Object.assign(t,u),u=null;var P,k=!1,H,z,T,N,ve;function K(){var n=P.buffer;t.HEAP8=H=new Int8Array(n),t.HEAP16=new Int16Array(n),t.HEAPU8=z=new Uint8Array(n),t.HEAPU16=new Uint16Array(n),t.HEAP32=T=new Int32Array(n),t.HEAPU32=N=new Uint32Array(n),t.HEAPF32=new Float32Array(n),t.HEAPF64=ve=new Float64Array(n)}var Te=[],Oe=[],Ce=[],se=0,ne=null,B=null;function ae(n){throw n="Aborted("+n+")",x(n),k=!0,n=new WebAssembly.RuntimeError(n+". Build with -sASSERTIONS for more info."),o(n),n}var Ae=n=>n.startsWith("data:application/octet-stream;base64,"),Z=n=>n.startsWith("file://"),te;if(te="ort-wasm.wasm",!Ae(te)){var j=te;te=t.locateFile?t.locateFile(j,h):h+j}function Q(n){if(E)return E(n);throw"both async and sync fetching of the wasm failed"}function mt(n){if(f||c){if(typeof fetch=="function"&&!Z(n))return fetch(n,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw`failed to load wasm binary file at '${n}'`;return s.arrayBuffer()}).catch(()=>Q(n));if(b)return new Promise((s,i)=>{b(n,m=>s(new Uint8Array(m)),i)})}return Promise.resolve().then(()=>Q(n))}function ce(n,s,i){return mt(n).then(m=>WebAssembly.instantiate(m,s)).then(i,m=>{x(`failed to asynchronously prepare wasm: ${m}`),ae(m)})}function _e(n,s){var i=te;return typeof WebAssembly.instantiateStreaming!="function"||Ae(i)||Z(i)||w||typeof fetch!="function"?ce(i,n,s):fetch(i,{credentials:"same-origin"}).then(m=>WebAssembly.instantiateStreaming(m,n).then(s,function(g){return x(`wasm streaming compile failed: ${g}`),x("falling back to ArrayBuffer instantiation"),ce(i,n,s)}))}var oe,qe={798088:(n,s,i,m)=>{if(typeof t>"u"||!t.ya)return 1;if(n=ee(n>>>0),n.startsWith("./")&&(n=n.substring(2)),n=t.ya.get(n),!n)return 2;if(s>>>=0,i>>>=0,s+i>n.byteLength)return 3;try{return z.set(n.subarray(s,s+i),m>>>0>>>0),0}catch{return 4}}};class de{constructor(s){this.wa=s-24}}var ie=0,De=0,G=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,$=(n,s,i)=>{s>>>=0;var m=s+i;for(i=s;n[i]&&!(i>=m);)++i;if(16<i-s&&n.buffer&&G)return G.decode(n.subarray(s,i));for(m="";s<i;){var g=n[s++];if(g&128){var v=n[s++]&63;if((g&224)==192)m+=String.fromCharCode((g&31)<<6|v);else{var I=n[s++]&63;g=(g&240)==224?(g&15)<<12|v<<6|I:(g&7)<<18|v<<12|I<<6|n[s++]&63,65536>g?m+=String.fromCharCode(g):(g-=65536,m+=String.fromCharCode(55296|g>>10,56320|g&1023))}}else m+=String.fromCharCode(g)}return m},ee=(n,s)=>(n>>>=0)?$(z,n,s):"",Se=n=>{for(var s=0,i=0;i<n.length;++i){var m=n.charCodeAt(i);127>=m?s++:2047>=m?s+=2:55296<=m&&57343>=m?(s+=4,++i):s+=3}return s},ue=(n,s,i,m)=>{if(i>>>=0,!(0<m))return 0;var g=i;m=i+m-1;for(var v=0;v<n.length;++v){var I=n.charCodeAt(v);if(55296<=I&&57343>=I){var Y=n.charCodeAt(++v);I=65536+((I&1023)<<10)|Y&1023}if(127>=I){if(i>=m)break;s[i++>>>0]=I}else{if(2047>=I){if(i+1>=m)break;s[i++>>>0]=192|I>>6}else{if(65535>=I){if(i+2>=m)break;s[i++>>>0]=224|I>>12}else{if(i+3>=m)break;s[i++>>>0]=240|I>>18,s[i++>>>0]=128|I>>12&63}s[i++>>>0]=128|I>>6&63}s[i++>>>0]=128|I&63}}return s[i>>>0]=0,i-g},we=n=>n%4===0&&(n%100!==0||n%400===0),ht=[0,31,60,91,121,152,182,213,244,274,305,335],yt=[0,31,59,90,120,151,181,212,243,273,304,334],Ve=[],Xe={},wt=()=>{if(!Je){var n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"},s;for(s in Xe)Xe[s]===void 0?delete n[s]:n[s]=Xe[s];var i=[];for(s in n)i.push(`${s}=${n[s]}`);Je=i}return Je},Je,Yr=[null,[],[]],gt=[31,29,31,30,31,30,31,31,30,31,30,31],bt=[31,28,31,30,31,30,31,31,30,31,30,31];function qr(n){var s=Array(Se(n)+1);return ue(n,s,0,s.length),s}function Et(n,s,i,m){function g(p,_,F){for(p=typeof p=="number"?p.toString():p||"";p.length<_;)p=F[0]+p;return p}function v(p,_){return g(p,_,"0")}function I(p,_){function F(Pt){return 0>Pt?-1:0<Pt?1:0}var pe;return(pe=F(p.getFullYear()-_.getFullYear()))===0&&(pe=F(p.getMonth()-_.getMonth()))===0&&(pe=F(p.getDate()-_.getDate())),pe}function Y(p){switch(p.getDay()){case 0:return new Date(p.getFullYear()-1,11,29);case 1:return p;case 2:return new Date(p.getFullYear(),0,3);case 3:return new Date(p.getFullYear(),0,2);case 4:return new Date(p.getFullYear(),0,1);case 5:return new Date(p.getFullYear()-1,11,31);case 6:return new Date(p.getFullYear()-1,11,30)}}function re(p){var _=p.sa;for(p=new Date(new Date(p.ta+1900,0,1).getTime());0<_;){var F=p.getMonth(),pe=(we(p.getFullYear())?gt:bt)[F];if(_>pe-p.getDate())_-=pe-p.getDate()+1,p.setDate(1),11>F?p.setMonth(F+1):(p.setMonth(0),p.setFullYear(p.getFullYear()+1));else{p.setDate(p.getDate()+_);break}}return F=new Date(p.getFullYear()+1,0,4),_=Y(new Date(p.getFullYear(),0,4)),F=Y(F),0>=I(_,p)?0>=I(F,p)?p.getFullYear()+1:p.getFullYear():p.getFullYear()-1}n>>>=0,s>>>=0,i>>>=0,m>>>=0;var V=N[m+40>>>2>>>0];m={Ba:T[m>>>2>>>0],Aa:T[m+4>>>2>>>0],ua:T[m+8>>>2>>>0],xa:T[m+12>>>2>>>0],va:T[m+16>>>2>>>0],ta:T[m+20>>>2>>>0],na:T[m+24>>>2>>>0],sa:T[m+28>>>2>>>0],Da:T[m+32>>>2>>>0],za:T[m+36>>>2>>>0],Ca:V?ee(V):""},i=ee(i),V={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var X in V)i=i.replace(new RegExp(X,"g"),V[X]);var xt="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),It="January February March April May June July August September October November December".split(" ");V={"%a":p=>xt[p.na].substring(0,3),"%A":p=>xt[p.na],"%b":p=>It[p.va].substring(0,3),"%B":p=>It[p.va],"%C":p=>v((p.ta+1900)/100|0,2),"%d":p=>v(p.xa,2),"%e":p=>g(p.xa,2," "),"%g":p=>re(p).toString().substring(2),"%G":re,"%H":p=>v(p.ua,2),"%I":p=>(p=p.ua,p==0?p=12:12<p&&(p-=12),v(p,2)),"%j":p=>{for(var _=0,F=0;F<=p.va-1;_+=(we(p.ta+1900)?gt:bt)[F++]);return v(p.xa+_,3)},"%m":p=>v(p.va+1,2),"%M":p=>v(p.Aa,2),"%n":()=>`
`,"%p":p=>0<=p.ua&&12>p.ua?"AM":"PM","%S":p=>v(p.Ba,2),"%t":()=>"	","%u":p=>p.na||7,"%U":p=>v(Math.floor((p.sa+7-p.na)/7),2),"%V":p=>{var _=Math.floor((p.sa+7-(p.na+6)%7)/7);if(2>=(p.na+371-p.sa-2)%7&&_++,_)_==53&&(F=(p.na+371-p.sa)%7,F==4||F==3&&we(p.ta)||(_=1));else{_=52;var F=(p.na+7-p.sa-1)%7;(F==4||F==5&&we(p.ta%400-1))&&_++}return v(_,2)},"%w":p=>p.na,"%W":p=>v(Math.floor((p.sa+7-(p.na+6)%7)/7),2),"%y":p=>(p.ta+1900).toString().substring(2),"%Y":p=>p.ta+1900,"%z":p=>{p=p.za;var _=0<=p;return p=Math.abs(p)/60,(_?"+":"-")+("0000"+(p/60*100+p%60)).slice(-4)},"%Z":p=>p.Ca,"%%":()=>"%"},i=i.replace(/%%/g,"\0\0");for(X in V)i.includes(X)&&(i=i.replace(new RegExp(X,"g"),V[X](m)));return i=i.replace(/\0\0/g,"%"),X=qr(i),X.length>s?0:(H.set(X,n>>>0),X.length-1)}var Vr={a:function(n,s,i){n>>>=0;var m=new de(n);throw N[m.wa+16>>>2>>>0]=0,N[m.wa+4>>>2>>>0]=s>>>0,N[m.wa+8>>>2>>>0]=i>>>0,ie=n,De++,ie},e:function(){return 0},H:function(){},x:function(){},z:function(){},J:function(){return 0},F:function(){},A:function(){},E:function(){},g:function(){},y:function(){},v:function(){},G:function(){},w:function(){},k:()=>1,I:function(n,s,i){return s>>>=0,z.copyWithin(n>>>0>>>0,s>>>0,s+(i>>>0)>>>0)},n:function(n,s,i){n=s+2097152>>>0<4194305-!!n?(n>>>0)+4294967296*s:NaN,i>>>=0,n=new Date(1e3*n),T[i>>>2>>>0]=n.getUTCSeconds(),T[i+4>>>2>>>0]=n.getUTCMinutes(),T[i+8>>>2>>>0]=n.getUTCHours(),T[i+12>>>2>>>0]=n.getUTCDate(),T[i+16>>>2>>>0]=n.getUTCMonth(),T[i+20>>>2>>>0]=n.getUTCFullYear()-1900,T[i+24>>>2>>>0]=n.getUTCDay(),T[i+28>>>2>>>0]=(n.getTime()-Date.UTC(n.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},o:function(n,s,i){n=s+2097152>>>0<4194305-!!n?(n>>>0)+4294967296*s:NaN,i>>>=0,n=new Date(1e3*n),T[i>>>2>>>0]=n.getSeconds(),T[i+4>>>2>>>0]=n.getMinutes(),T[i+8>>>2>>>0]=n.getHours(),T[i+12>>>2>>>0]=n.getDate(),T[i+16>>>2>>>0]=n.getMonth(),T[i+20>>>2>>>0]=n.getFullYear()-1900,T[i+24>>>2>>>0]=n.getDay(),T[i+28>>>2>>>0]=(we(n.getFullYear())?ht:yt)[n.getMonth()]+n.getDate()-1|0,T[i+36>>>2>>>0]=-(60*n.getTimezoneOffset()),s=new Date(n.getFullYear(),6,1).getTimezoneOffset();var m=new Date(n.getFullYear(),0,1).getTimezoneOffset();T[i+32>>>2>>>0]=(s!=m&&n.getTimezoneOffset()==Math.min(m,s))|0},p:function(n){n>>>=0;var s=new Date(T[n+20>>>2>>>0]+1900,T[n+16>>>2>>>0],T[n+12>>>2>>>0],T[n+8>>>2>>>0],T[n+4>>>2>>>0],T[n>>>2>>>0],0),i=T[n+32>>>2>>>0],m=s.getTimezoneOffset(),g=new Date(s.getFullYear(),6,1).getTimezoneOffset(),v=new Date(s.getFullYear(),0,1).getTimezoneOffset(),I=Math.min(v,g);return 0>i?T[n+32>>>2>>>0]=+(g!=v&&I==m):0<i!=(I==m)&&(g=Math.max(v,g),s.setTime(s.getTime()+6e4*((0<i?I:g)-m))),T[n+24>>>2>>>0]=s.getDay(),T[n+28>>>2>>>0]=(we(s.getFullYear())?ht:yt)[s.getMonth()]+s.getDate()-1|0,T[n>>>2>>>0]=s.getSeconds(),T[n+4>>>2>>>0]=s.getMinutes(),T[n+8>>>2>>>0]=s.getHours(),T[n+12>>>2>>>0]=s.getDate(),T[n+16>>>2>>>0]=s.getMonth(),T[n+20>>>2>>>0]=s.getYear(),n=s.getTime(),n=isNaN(n)?-1:n/1e3,vt((oe=n,1<=+Math.abs(oe)?0<oe?+Math.floor(oe/4294967296)>>>0:~~+Math.ceil((oe-+(~~oe>>>0))/4294967296)>>>0:0)),n>>>0},l:function(){return-52},m:function(){},t:function(n,s,i,m){i>>>=0,m>>>=0;var g=new Date().getFullYear(),v=new Date(g,0,1),I=new Date(g,6,1);g=v.getTimezoneOffset();var Y=I.getTimezoneOffset();N[n>>>0>>>2>>>0]=60*Math.max(g,Y),T[s>>>0>>>2>>>0]=+(g!=Y),n=re=>re.toLocaleTimeString(void 0,{hour12:!1,timeZoneName:"short"}).split(" ")[1],v=n(v),I=n(I),Y<g?(ue(v,z,i,17),ue(I,z,m,17)):(ue(v,z,m,17),ue(I,z,i,17))},d:()=>{ae("")},B:function(n,s,i){n>>>=0,s>>>=0,i>>>=0,Ve.length=0;for(var m;m=z[s++>>>0];){var g=m!=105;g&=m!=112,i+=g&&i%8?4:0,Ve.push(m==112?N[i>>>2>>>0]:m==105?T[i>>>2>>>0]:ve[i>>>3>>>0]),i+=g?8:4}return qe[n](...Ve)},h:()=>Date.now(),u:function(){return 4294901760},b:()=>performance.now(),s:function(n){n>>>=0;var s=z.length;if(4294901760<n)return!1;for(var i=1;4>=i;i*=2){var m=s*(1+.2/i);m=Math.min(m,n+100663296);var g=Math;m=Math.max(n,m);e:{g=(g.min.call(g,4294901760,m+(65536-m%65536)%65536)-P.buffer.byteLength+65535)/65536;try{P.grow(g),K();var v=1;break e}catch{}v=void 0}if(v)return!0}return!1},C:function(n,s){n>>>=0,s>>>=0;var i=0;return wt().forEach((m,g)=>{var v=s+i;for(g=N[n+4*g>>>2>>>0]=v,v=0;v<m.length;++v)H[g++>>>0]=m.charCodeAt(v);H[g>>>0]=0,i+=m.length+1}),0},D:function(n,s){n>>>=0,s>>>=0;var i=wt();N[n>>>2>>>0]=i.length;var m=0;return i.forEach(g=>m+=g.length+1),N[s>>>2>>>0]=m,0},f:()=>52,j:function(){return 52},q:function(){return 70},i:function(n,s,i,m){s>>>=0,i>>>=0,m>>>=0;for(var g=0,v=0;v<i;v++){var I=N[s>>>2>>>0],Y=N[s+4>>>2>>>0];s+=8;for(var re=0;re<Y;re++){var V=z[I+re>>>0],X=Yr[n];V===0||V===10?((n===1?L:x)($(X,0)),X.length=0):X.push(V)}g+=Y}return N[m>>>2>>>0]=g,0},r:Et,c:function(n,s,i,m){return Et(n>>>0,s>>>0,i>>>0,m>>>0)}},S=function(){function n(i){return S=i.exports,S=Xr(),P=S.K,K(),Oe.unshift(S.L),se--,se==0&&(ne!==null&&(clearInterval(ne),ne=null),B&&(i=B,B=null,i())),S}var s={a:Vr};if(se++,t.instantiateWasm)try{return t.instantiateWasm(s,n)}catch(i){x(`Module.instantiateWasm callback failed with error: ${i}`),o(i)}return _e(s,function(i){n(i.instance)}).catch(o),{}}();t._OrtInit=(n,s)=>(t._OrtInit=S.M)(n,s),t._OrtGetLastError=(n,s)=>(t._OrtGetLastError=S.N)(n,s),t._OrtCreateSessionOptions=(n,s,i,m,g,v,I,Y,re,V)=>(t._OrtCreateSessionOptions=S.O)(n,s,i,m,g,v,I,Y,re,V),t._OrtAppendExecutionProvider=(n,s)=>(t._OrtAppendExecutionProvider=S.P)(n,s),t._OrtAddFreeDimensionOverride=(n,s,i)=>(t._OrtAddFreeDimensionOverride=S.Q)(n,s,i),t._OrtAddSessionConfigEntry=(n,s,i)=>(t._OrtAddSessionConfigEntry=S.R)(n,s,i),t._OrtReleaseSessionOptions=n=>(t._OrtReleaseSessionOptions=S.S)(n),t._OrtCreateSession=(n,s,i)=>(t._OrtCreateSession=S.T)(n,s,i),t._OrtReleaseSession=n=>(t._OrtReleaseSession=S.U)(n),t._OrtGetInputOutputCount=(n,s,i)=>(t._OrtGetInputOutputCount=S.V)(n,s,i),t._OrtGetInputName=(n,s)=>(t._OrtGetInputName=S.W)(n,s),t._OrtGetOutputName=(n,s)=>(t._OrtGetOutputName=S.X)(n,s),t._OrtFree=n=>(t._OrtFree=S.Y)(n),t._OrtCreateTensor=(n,s,i,m,g,v)=>(t._OrtCreateTensor=S.Z)(n,s,i,m,g,v),t._OrtGetTensorData=(n,s,i,m,g)=>(t._OrtGetTensorData=S._)(n,s,i,m,g),t._OrtReleaseTensor=n=>(t._OrtReleaseTensor=S.$)(n),t._OrtCreateRunOptions=(n,s,i,m)=>(t._OrtCreateRunOptions=S.aa)(n,s,i,m),t._OrtAddRunConfigEntry=(n,s,i)=>(t._OrtAddRunConfigEntry=S.ba)(n,s,i),t._OrtReleaseRunOptions=n=>(t._OrtReleaseRunOptions=S.ca)(n),t._OrtCreateBinding=n=>(t._OrtCreateBinding=S.da)(n),t._OrtBindInput=(n,s,i)=>(t._OrtBindInput=S.ea)(n,s,i),t._OrtBindOutput=(n,s,i,m)=>(t._OrtBindOutput=S.fa)(n,s,i,m),t._OrtClearBoundOutputs=n=>(t._OrtClearBoundOutputs=S.ga)(n),t._OrtReleaseBinding=n=>(t._OrtReleaseBinding=S.ha)(n),t._OrtRunWithBinding=(n,s,i,m,g)=>(t._OrtRunWithBinding=S.ia)(n,s,i,m,g),t._OrtRun=(n,s,i,m,g,v,I,Y)=>(t._OrtRun=S.ja)(n,s,i,m,g,v,I,Y),t._OrtEndProfiling=n=>(t._OrtEndProfiling=S.ka)(n),t._malloc=n=>(t._malloc=S.la)(n),t._free=n=>(t._free=S.ma)(n);var vt=n=>(vt=S.oa)(n),Tt=n=>(Tt=S.pa)(n),Ot=n=>(Ot=S.qa)(n),At=()=>(At=S.ra)();function Xr(){var n=S;n=Object.assign({},n);var s=i=>m=>i(m)>>>0;return n.la=s(n.la),n.qa=s(n.qa),n.ra=(i=>()=>i()>>>0)(n.ra),n}t.stackSave=()=>At(),t.stackRestore=n=>Tt(n),t.stackAlloc=n=>Ot(n),t.UTF8ToString=ee,t.stringToUTF8=(n,s,i)=>ue(n,z,s,i),t.lengthBytesUTF8=Se;var Ue;B=function n(){Ue||St(),Ue||(B=n)};function St(){if(!(0<se)){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;){var n=t.preRun.shift();Te.unshift(n)}for(;0<Te.length;)Te.shift()(t);if(!(0<se||Ue||(Ue=!0,t.calledRun=!0,k))){for(;0<Oe.length;)Oe.shift()(t);for(a(t);0<Ce.length;)Ce.shift()(t)}}}return St(),d}})();typeof dr=="object"&&typeof nt=="object"?nt.exports=cr:typeof define=="function"&&define.amd&&define([],()=>cr)});var at,an,ot,st,$e,mr,un,fn,ln,hr,M,be=C(()=>{"use strict";at=pr();an=at,st=!1,$e=!1,mr=!1,un=r=>{if(r===1)return!1;if(typeof SharedArrayBuffer>"u")return typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+r+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),!1;typeof process<"u"&&process.versions&&process.versions.node&&console.warn("env.wasm.numThreads is set to "+r+", however, currently onnxruntime-web does not support multi-threads in Node.js. Please consider using onnxruntime-node for performance critical scenarios.");try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},fn=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ln=(r,e)=>r?e?"ort-wasm-simd-threaded.wasm":"ort-wasm-simd.wasm":e?"ort-wasm-threaded.wasm":"ort-wasm.wasm",hr=async r=>{if(st)return Promise.resolve();if($e)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(mr)throw new Error("previous call to 'initializeWebAssembly()' failed.");$e=!0;let e=r.initTimeout,t=r.numThreads,a=r.simd,o=un(t),d=a&&fn(),u=r.wasmPaths,l=typeof u=="string"?u:void 0,f=ln(d,o),c=typeof u=="object"?u[f]:void 0,w=!1,h=[];if(e>0&&h.push(new Promise(y=>{setTimeout(()=>{w=!0,y()},e)})),h.push(new Promise((y,b)=>{(o?an:at)({locateFile:(A,L)=>A.endsWith(".wasm")?c||(l??L)+f:L+A}).then(A=>{$e=!1,st=!0,ot=A,y()},A=>{$e=!1,mr=!0,b(A)})})),await Promise.race(h),w)throw new Error(`WebAssembly backend initializing failed due to timeout: ${e}ms`)},M=()=>{if(st&&ot)return ot;throw new Error("WebAssembly is not initialized yet.")}});var U,Pe,R,He=C(()=>{"use strict";be();U=(r,e)=>{let t=M(),a=t.lengthBytesUTF8(r)+1,o=t._malloc(a);return t.stringToUTF8(r,o,a),e.push(o),o},Pe=(r,e,t,a)=>{if(typeof r=="object"&&r!==null){if(t.has(r))throw new Error("Circular reference in options");t.add(r)}Object.entries(r).forEach(([o,d])=>{let u=e?e+o:o;if(typeof d=="object")Pe(d,u+".",t,a);else if(typeof d=="string"||typeof d=="number")a(u,d.toString());else if(typeof d=="boolean")a(u,d?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof d}`)})},R=r=>{let e=M(),t=e.stackSave();try{let a=e.stackAlloc(8);e._OrtGetLastError(a,a+4);let o=e.HEAP32[a/4],d=e.HEAPU32[a/4+1],u=d?e.UTF8ToString(d):"";throw new Error(`${r} ERROR_CODE: ${o}, ERROR_MESSAGE: ${u}`)}finally{e.stackRestore(t)}}});var yr,wr=C(()=>{"use strict";be();He();yr=r=>{let e=M(),t=0,a=[],o=r||{};try{if(r?.logSeverityLevel===void 0)o.logSeverityLevel=2;else if(typeof r.logSeverityLevel!="number"||!Number.isInteger(r.logSeverityLevel)||r.logSeverityLevel<0||r.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${r.logSeverityLevel}`);if(r?.logVerbosityLevel===void 0)o.logVerbosityLevel=0;else if(typeof r.logVerbosityLevel!="number"||!Number.isInteger(r.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${r.logVerbosityLevel}`);r?.terminate===void 0&&(o.terminate=!1);let d=0;return r?.tag!==void 0&&(d=U(r.tag,a)),t=e._OrtCreateRunOptions(o.logSeverityLevel,o.logVerbosityLevel,!!o.terminate,d),t===0&&R("Can't create run options."),r?.extra!==void 0&&Pe(r.extra,"",new WeakSet,(u,l)=>{let f=U(u,a),c=U(l,a);e._OrtAddRunConfigEntry(t,f,c)!==0&&R(`Can't set a run config entry: ${u} - ${l}.`)}),[t,a]}catch(d){throw t!==0&&e._OrtReleaseRunOptions(t),a.forEach(u=>e._free(u)),d}}});var cn,dn,pn,mn,gr,br=C(()=>{"use strict";be();He();cn=r=>{switch(r){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${r}`)}},dn=r=>{switch(r){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${r}`)}},pn=r=>{r.extra||(r.extra={}),r.extra.session||(r.extra.session={});let e=r.extra.session;e.use_ort_model_bytes_directly||(e.use_ort_model_bytes_directly="1"),r.executionProviders&&r.executionProviders.some(t=>(typeof t=="string"?t:t.name)==="webgpu")&&(r.enableMemPattern=!1)},mn=(r,e,t)=>{for(let a of e){let o=typeof a=="string"?a:a.name;switch(o){case"webnn":if(o="WEBNN",typeof a!="string"){let u=a;if(u?.deviceType){let l=U("deviceType",t),f=U(u.deviceType,t);M()._OrtAddSessionConfigEntry(r,l,f)!==0&&R(`Can't set a session config entry: 'deviceType' - ${u.deviceType}.`)}if(u?.numThreads){let l=u.numThreads;(typeof l!="number"||!Number.isInteger(l)||l<0)&&(l=0);let f=U("numThreads",t),c=U(l.toString(),t);M()._OrtAddSessionConfigEntry(r,f,c)!==0&&R(`Can't set a session config entry: 'numThreads' - ${u.numThreads}.`)}if(u?.powerPreference){let l=U("powerPreference",t),f=U(u.powerPreference,t);M()._OrtAddSessionConfigEntry(r,l,f)!==0&&R(`Can't set a session config entry: 'powerPreference' - ${u.powerPreference}.`)}}break;case"webgpu":if(o="JS",typeof a!="string"){let u=a;if(u?.preferredLayout){if(u.preferredLayout!=="NCHW"&&u.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${u.preferredLayout}`);let l=U("preferredLayout",t),f=U(u.preferredLayout,t);M()._OrtAddSessionConfigEntry(r,l,f)!==0&&R(`Can't set a session config entry: 'preferredLayout' - ${u.preferredLayout}.`)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${o}`)}let d=U(o,t);M()._OrtAppendExecutionProvider(r,d)!==0&&R(`Can't append execution provider: ${o}.`)}},gr=r=>{let e=M(),t=0,a=[],o=r||{};pn(o);try{let d=cn(o.graphOptimizationLevel??"all"),u=dn(o.executionMode??"sequential"),l=typeof o.logId=="string"?U(o.logId,a):0,f=o.logSeverityLevel??2;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log serverity level is not valid: ${f}`);let c=o.logVerbosityLevel??0;if(!Number.isInteger(c)||c<0||c>4)throw new Error(`log verbosity level is not valid: ${c}`);let w=typeof o.optimizedModelFilePath=="string"?U(o.optimizedModelFilePath,a):0;if(t=e._OrtCreateSessionOptions(d,!!o.enableCpuMemArena,!!o.enableMemPattern,u,!!o.enableProfiling,0,l,f,c,w),t===0&&R("Can't create session options."),o.executionProviders&&mn(t,o.executionProviders,a),o.enableGraphCapture!==void 0){if(typeof o.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${o.enableGraphCapture}`);let h=U("enableGraphCapture",a),y=U(o.enableGraphCapture.toString(),a);e._OrtAddSessionConfigEntry(t,h,y)!==0&&R(`Can't set a session config entry: 'enableGraphCapture' - ${o.enableGraphCapture}.`)}if(o.freeDimensionOverrides)for(let[h,y]of Object.entries(o.freeDimensionOverrides)){if(typeof h!="string")throw new Error(`free dimension override name must be a string: ${h}`);if(typeof y!="number"||!Number.isInteger(y)||y<0)throw new Error(`free dimension override value must be a non-negative integer: ${y}`);let b=U(h,a);e._OrtAddFreeDimensionOverride(t,b,y)!==0&&R(`Can't set a free dimension override: ${h} - ${y}.`)}return o.extra!==void 0&&Pe(o.extra,"",new WeakSet,(h,y)=>{let b=U(h,a),E=U(y,a);e._OrtAddSessionConfigEntry(t,b,E)!==0&&R(`Can't set a session config entry: ${h} - ${y}.`)}),[t,a]}catch(d){throw t!==0&&e._OrtReleaseSessionOptions(t),a.forEach(u=>e._free(u)),d}}});var it,Er,ut,vr,Tr,ze,Or,ft=C(()=>{"use strict";it=r=>{switch(r){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;default:throw new Error(`unsupported data type: ${r}`)}},Er=r=>{switch(r){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";default:throw new Error(`unsupported data type: ${r}`)}},ut=r=>[void 0,4,1,1,2,2,4,8,void 0,1,2,8,4,8,void 0,void 0,void 0][r],vr=r=>{switch(r){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${r}`)}},Tr=r=>{switch(r){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${r}`)}},ze=r=>r==="float32"||r==="float16"||r==="int32"||r==="int64"||r==="uint32"||r==="uint8"||r==="bool",Or=r=>{switch(r){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;default:throw new Error(`unsupported data location: ${r}`)}}});var Be,lt=C(()=>{"use strict";Be=async r=>{if(typeof r=="string")if(typeof process<"u"&&process.versions&&process.versions.node)try{return new Uint8Array(await(void 0)(r))}catch(e){if(e.code==="ERR_FS_FILE_TOO_LARGE"){let t=(void 0)(r),a=[];for await(let o of t)a.push(o);return new Uint8Array(Buffer.concat(a))}throw e}else{let e=await fetch(r);if(!e.ok)throw new Error(`failed to load external data file: ${r}`);let t=e.headers.get("Content-Length"),a=t?parseInt(t,10):0;if(a<1073741824)return new Uint8Array(await e.arrayBuffer());{if(!e.body)throw new Error(`failed to load external data file: ${r}, no response body.`);let o=e.body.getReader(),d;try{d=new ArrayBuffer(a)}catch(l){if(l instanceof RangeError){let f=Math.ceil(a/65536);d=new WebAssembly.Memory({initial:f,maximum:f}).buffer}else throw l}let u=0;for(;;){let{done:l,value:f}=await o.read();if(l)break;let c=f.byteLength;new Uint8Array(d,u,c).set(f),u+=c}return new Uint8Array(d,0,a)}}else return r instanceof Blob?new Uint8Array(await r.arrayBuffer()):r instanceof Uint8Array?r:new Uint8Array(r)}});var hn,Sr,xr,Ee,yn,ct,Ir,Pr,Ar,Br,Cr,_r=C(()=>{"use strict";wr();br();ft();be();He();lt();hn=(r,e)=>{M()._OrtInit(r,e)!==0&&R("Can't initialize onnxruntime.")},Sr=async r=>{hn(r.wasm.numThreads,Tr(r.logLevel))},xr=async(r,e)=>{},Ee=new Map,yn=r=>{let e=M(),t=e.stackSave();try{let a=e.stackAlloc(8);return e._OrtGetInputOutputCount(r,a,a+4)!==0&&R("Can't get session input/output count."),[e.HEAP32[a/4],e.HEAP32[a/4+1]]}finally{e.stackRestore(t)}},ct=r=>{let e=M(),t=e._malloc(r.byteLength);if(t===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${r.byteLength}.`);return e.HEAPU8.set(r,t),[t,r.byteLength]},Ir=async(r,e)=>{let t,a,o=M();Array.isArray(r)?[t,a]=r:r.buffer===o.HEAPU8.buffer?[t,a]=[r.byteOffset,r.byteLength]:[t,a]=ct(r);let d=0,u=0,l=0,f=[],c=[],w=[];try{if([u,f]=gr(e),e?.externalData&&o.mountExternalData){let x=[];for(let P of e.externalData){let k=typeof P=="string"?P:P.path;x.push(Be(typeof P=="string"?P:P.data).then(H=>{o.mountExternalData(k,H)}))}await Promise.all(x)}d=await o._OrtCreateSession(t,a,u),d===0&&R("Can't create a session.");let[h,y]=yn(d),b=!!e?.enableGraphCapture,E=[],O=[],A=[];for(let x=0;x<h;x++){let P=o._OrtGetInputName(d,x);P===0&&R("Can't get an input name."),c.push(P),E.push(o.UTF8ToString(P))}for(let x=0;x<y;x++){let P=o._OrtGetOutputName(d,x);P===0&&R("Can't get an output name."),w.push(P);let k=o.UTF8ToString(P);O.push(k)}let L=null;return Ee.set(d,[d,c,w,L,b,!1]),[d,E,O]}catch(h){throw c.forEach(y=>o._OrtFree(y)),w.forEach(y=>o._OrtFree(y)),l!==0&&o._OrtReleaseBinding(l),d!==0&&o._OrtReleaseSession(d),h}finally{o._free(t),u!==0&&o._OrtReleaseSessionOptions(u),f.forEach(h=>o._free(h)),o.unmountExternalData?.()}},Pr=r=>{let e=M(),t=Ee.get(r);if(!t)throw new Error(`cannot release session. invalid session id: ${r}`);let[a,o,d,u,l]=t;u&&(l&&e._OrtClearBoundOutputs(u.handle),e._OrtReleaseBinding(u.handle)),e.jsepOnReleaseSession?.(r),o.forEach(f=>e._OrtFree(f)),d.forEach(f=>e._OrtFree(f)),e._OrtReleaseSession(a),Ee.delete(r)},Ar=(r,e,t,a,o,d=!1)=>{if(!r){e.push(0);return}let u=M(),l=r[0],f=r[1],c=r[3],w,h;if(l==="string"&&c==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");if(d&&c!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${o} when enableGraphCapture is true.`);if(c==="gpu-buffer"){let E=r[2].gpuBuffer,O=ut(it(l));h=f.reduce((L,x)=>L*x,1)*O;let A=u.jsepRegisterBuffer;if(!A)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');w=A(a,o,E,h)}else{let E=r[2];if(Array.isArray(E)){h=4*E.length,w=u._malloc(h),t.push(w);let O=w/4;for(let A=0;A<E.length;A++){if(typeof E[A]!="string")throw new TypeError(`tensor data at index ${A} is not a string`);u.HEAPU32[O++]=U(E[A],t)}}else h=E.byteLength,w=u._malloc(h),t.push(w),u.HEAPU8.set(new Uint8Array(E.buffer,E.byteOffset,h),w)}let y=u.stackSave(),b=u.stackAlloc(4*f.length);try{let E=b/4;f.forEach(A=>u.HEAP32[E++]=A);let O=u._OrtCreateTensor(it(l),w,h,b,f.length,Or(c));O===0&&R(`Can't create tensor for input/output. session=${a}, index=${o}.`),e.push(O)}finally{u.stackRestore(y)}},Br=async(r,e,t,a,o,d)=>{let u=M(),l=Ee.get(r);if(!l)throw new Error(`cannot run inference. invalid session id: ${r}`);let f=l[0],c=l[1],w=l[2],h=l[3],y=l[4],b=l[5],E=e.length,O=a.length,A=0,L=[],x=[],P=[],k=[],H=u.stackSave(),z=u.stackAlloc(E*4),T=u.stackAlloc(E*4),N=u.stackAlloc(O*4),ve=u.stackAlloc(O*4);try{[A,L]=yr(d);for(let B=0;B<E;B++)Ar(t[B],x,k,r,e[B],y);for(let B=0;B<O;B++)Ar(o[B],P,k,r,E+a[B],y);let K=z/4,Te=T/4,Oe=N/4,Ce=ve/4;for(let B=0;B<E;B++)u.HEAPU32[K++]=x[B],u.HEAPU32[Te++]=c[e[B]];for(let B=0;B<O;B++)u.HEAPU32[Oe++]=P[B],u.HEAPU32[Ce++]=w[a[B]];u.jsepOnRunStart?.(f);let se;se=await u._OrtRun(f,T,z,E,ve,O,N,A),se!==0&&R("failed to call OrtRun().");let ne=[];for(let B=0;B<O;B++){let ae=u.HEAPU32[N/4+B];if(ae===P[B]){ne.push(o[B]);continue}let Ae=u.stackSave(),Z=u.stackAlloc(4*4),te=!1,j,Q=0;try{u._OrtGetTensorData(ae,Z,Z+4,Z+8,Z+12)!==0&&R(`Can't access output tensor data on index ${B}.`);let ce=Z/4,_e=u.HEAPU32[ce++];Q=u.HEAPU32[ce++];let oe=u.HEAPU32[ce++],qe=u.HEAPU32[ce++],de=[];for(let G=0;G<qe;G++)de.push(u.HEAPU32[oe/4+G]);u._OrtFree(oe);let ie=de.reduce((G,$)=>G*$,1);j=Er(_e);let De=h?.outputPreferredLocations[a[B]];if(j==="string"){if(De==="gpu-buffer")throw new Error("String tensor is not supported on GPU.");let G=[],$=Q/4;for(let ee=0;ee<ie;ee++){let Se=u.HEAPU32[$++],ue=ee===ie-1?void 0:u.HEAPU32[$]-Se;G.push(u.UTF8ToString(Se,ue))}ne.push([j,de,G,"cpu"])}else if(De==="gpu-buffer"&&ie>0){let G=u.jsepGetBuffer;if(!G)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let $=G(Q),ee=ut(_e);if(ee===void 0||!ze(j))throw new Error(`Unsupported data type: ${j}`);te=!0,ne.push([j,de,{gpuBuffer:$,download:u.jsepCreateDownloader($,ie*ee,j),dispose:()=>{u._OrtReleaseTensor(ae)}},"gpu-buffer"])}else{let G=vr(j),$=new G(ie);new Uint8Array($.buffer,$.byteOffset,$.byteLength).set(u.HEAPU8.subarray(Q,Q+$.byteLength)),ne.push([j,de,$,"cpu"])}}finally{u.stackRestore(Ae),j==="string"&&Q&&u._free(Q),te||u._OrtReleaseTensor(ae)}}return h&&!y&&(u._OrtClearBoundOutputs(h.handle),Ee.set(r,[f,c,w,h,y,!1])),ne}finally{u.stackRestore(H),x.forEach(K=>u._OrtReleaseTensor(K)),P.forEach(K=>u._OrtReleaseTensor(K)),k.forEach(K=>u._free(K)),A!==0&&u._OrtReleaseRunOptions(A),L.forEach(K=>u._free(K))}},Cr=r=>{let e=M(),t=Ee.get(r);if(!t)throw new Error("invalid session id");let a=t[0],o=e._OrtEndProfiling(a);o===0&&R("Can't get an profile file name."),e._OrtFree(o)}});var dt,Dr,Ur,ko,Rr,Lr,Fr,Mr,kr,Nr,Wr,pt=C(()=>{"use strict";ye();_r();be();dt=!1,Dr=!1,Ur=!1,ko=typeof document<"u"?document?.currentScript?.src:void 0,Rr=async()=>{if(!Dr){if(dt)throw new Error("multiple calls to 'initWasm()' detected.");if(Ur)throw new Error("previous call to 'initWasm()' failed.");dt=!0;try{await hr(D.wasm),await Sr(D),Dr=!0}catch(r){throw Ur=!0,r}finally{dt=!1}}},Lr=async r=>{await xr(D,r)},Fr=async r=>ct(r),Mr=async(r,e)=>Ir(r,e),kr=async r=>{Pr(r)},Nr=async(r,e,t,a,o,d)=>Br(r,e,t,a,o,d),Wr=async r=>{Cr(r)}});var Gr,gn,je,$r=C(()=>{"use strict";ye();pt();ft();lt();Gr=(r,e)=>{switch(r.location){case"cpu":return[r.type,r.dims,r.data,"cpu"];case"gpu-buffer":return[r.type,r.dims,{gpuBuffer:r.gpuBuffer},"gpu-buffer"];default:throw new Error(`invalid data location: ${r.location} for ${e()}`)}},gn=r=>{switch(r[3]){case"cpu":return new W(r[0],r[2],r[1]);case"gpu-buffer":{let e=r[0];if(!ze(e))throw new Error(`not supported data type: ${e} for deserializing GPU tensor`);let{gpuBuffer:t,download:a,dispose:o}=r[2];return W.fromGpuBuffer(t,{dataType:e,dims:r[1],download:a,dispose:o})}default:throw new Error(`invalid data location: ${r[3]}`)}},je=class{async fetchModelAndCopyToWasmMemory(e){return Fr(await Be(e))}async loadModel(e,t){fe();let a;typeof e=="string"?typeof process<"u"&&process.versions&&process.versions.node?a=await Be(e):a=await this.fetchModelAndCopyToWasmMemory(e):a=e,[this.sessionId,this.inputNames,this.outputNames]=await Mr(a,t),le()}async dispose(){return kr(this.sessionId)}async run(e,t,a){fe();let o=[],d=[];Object.entries(e).forEach(y=>{let b=y[0],E=y[1],O=this.inputNames.indexOf(b);if(O===-1)throw new Error(`invalid input '${b}'`);o.push(E),d.push(O)});let u=[],l=[];Object.entries(t).forEach(y=>{let b=y[0],E=y[1],O=this.outputNames.indexOf(b);if(O===-1)throw new Error(`invalid output '${b}'`);u.push(E),l.push(O)});let f=o.map((y,b)=>Gr(y,()=>`input "${this.inputNames[d[b]]}"`)),c=u.map((y,b)=>y?Gr(y,()=>`output "${this.outputNames[l[b]]}"`):null),w=await Nr(this.sessionId,d,f,l,c,a),h={};for(let y=0;y<w.length;y++)h[this.outputNames[l[y]]]=u[y]??gn(w[y]);return le(),h}startProfiling(){}endProfiling(){Wr(this.sessionId)}}});var bn,Ye,Hr=C(()=>{"use strict";ye();pt();$r();bn=()=>{if((typeof D.wasm.initTimeout!="number"||D.wasm.initTimeout<0)&&(D.wasm.initTimeout=0),typeof D.wasm.simd!="boolean"&&(D.wasm.simd=!0),typeof D.wasm.proxy!="boolean"&&(D.wasm.proxy=!1),typeof D.wasm.trace!="boolean"&&(D.wasm.trace=!1),typeof D.wasm.numThreads!="number"||!Number.isInteger(D.wasm.numThreads)||D.wasm.numThreads<=0){(typeof self<"u"&&!self.crossOriginIsolated||typeof process<"u"&&process.versions&&process.versions.node)&&(D.wasm.numThreads=1);let r=typeof navigator>"u"?(void 0)().length:navigator.hardwareConcurrency;D.wasm.numThreads=Math.min(4,Math.ceil((r||1)/2))}},Ye=class{async init(e){bn(),await Rr(),await Lr(e)}async createInferenceSessionHandler(e,t){let a=new je;return await a.loadModel(e,t),Promise.resolve(a)}}});var zr={};xe(zr,{wasmBackend:()=>En});var En,jr=C(()=>{"use strict";Hr();En=new Ye});var Tn={};xe(Tn,{InferenceSession:()=>Jt,TRACE:()=>et,TRACE_FUNC_BEGIN:()=>fe,TRACE_FUNC_END:()=>le,Tensor:()=>W,TrainingSession:()=>nr,default:()=>vn,env:()=>D,registerBackend:()=>ge});module.exports=Re(Tn);ye();ye();ye();var sr="1.18.0";var vn=rt;{let r=(jr(),Re(zr)).wasmBackend;ge("cpu",r,10),ge("wasm",r,10)}Object.defineProperty(D.versions,"web",{value:sr,enumerable:!0});
//# sourceMappingURL=ort.wasm-core.min.js.map
